
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Pydantic And Hydra &#8212; Omniverse</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css?v=4c969af8" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=87e54e7c" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=bb35926c" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script src="../../_static/tabs.js?v=3ee01567"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-MYW5YKC2WF"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-MYW5YKC2WF');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-MYW5YKC2WF');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'software_engineering/config_management/01-pydra';</script>
    <link rel="canonical" href="https://www.gaohongnan.com/software_engineering/config_management/01-pydra.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="State And Metadata Management" href="02-state.html" />
    <link rel="prev" title="Configuration Management" href="concept.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo.png" class="logo__image only-light" alt="Omniverse - Home"/>
    <script>document.write(`<img src="../../_static/logo.png" class="logo__image only-dark" alt="Omniverse - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    ðŸŒŒ Omniverse: A Journey Through Knowledge
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Notations</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../notations/machine_learning.html">Machine Learning Notations</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Influential Ideas and Papers</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../influential/generative_pretrained_transformer/01_intro.html">Generative Pre-trained Transformers</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../influential/generative_pretrained_transformer/02_notations.html">Notations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../influential/generative_pretrained_transformer/03_concept.html">The Concept of Generative Pre-trained Transformers (GPT)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../influential/generative_pretrained_transformer/04_implementation.html">The Implementation of Generative Pre-trained Transformers (GPT)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../influential/generative_pretrained_transformer/05_adder.html">Training a Mini-GPT to Learn Two-Digit Addition</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../influential/low_rank_adaptation/01_intro.html">Low-Rank Adaptation Of Large Language Models</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../influential/low_rank_adaptation/02_concept.html">Concept</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../influential/kmeans/01_intro.html">K-Means</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../influential/kmeans/02_concept.html">Concept: K-Means Clustering</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../influential/kmeans/03_implementation.html">Implementation: K-Means (Lloyd)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../influential/kmeans/04_image_segmentation.html">Application: Image Compression and Segmentation</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Playbook</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../playbook/how_to_calculate_flops_in_transformer_based_models.html">How to Calculate the Number of FLOPs in Transformer Based Models?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../playbook/how_to_inspect_function_and_class_signatures.html">How to Inspect Function and Class Signatures in Python?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../playbook/why_cosine_annealing_warmup_stabilize_training.html">Why Does Cosine Annealing With Warmup Stabilize Training?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../playbook/why_softmax_preserves_order_translation_invariant_not_invariant_scaling.html">Softmax Preserves Order, Is Translation Invariant But Not Invariant Under Scaling.</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../playbook/how_to_finetune_decoder_with_last_token_pooling.html">How To Fine-Tune Decoder-Only Models For Sequence Classification Using Last Token Pooling?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../playbook/how_to_finetune_decoder_with_cross_attention.html">How To Fine-Tune Decoder-Only Models For Sequence Classification With Cross-Attention?</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Operations</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../operations/machine_learning_lifecycle/00_intro.html">The Lifecycle of an AIOps System</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../operations/machine_learning_lifecycle/01_problem_formulation.html">Stage 1. Problem Formulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../operations/machine_learning_lifecycle/02_project_scoping.html">Stage 2. Project Scoping And Framing The Problem</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../operations/machine_learning_lifecycle/03_dataops_pipeline/03_dataops_pipeline.html">Stage 3. Data Pipeline (Data Engineering and DataOps)</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../operations/machine_learning_lifecycle/03_dataops_pipeline/031_data_source_and_format.html">Stage 3.1. Data Source and Formats</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../operations/machine_learning_lifecycle/03_dataops_pipeline/032_data_model_and_storage.html">Stage 3.2. Data Model and Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../operations/machine_learning_lifecycle/03_dataops_pipeline/033_etl.html">Stage 3.3. Extract, Transform, Load (ETL)</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../../operations/machine_learning_lifecycle/04_mlops_data_pipeline.html">Stage 4. Data Extraction (MLOps), Data Analysis (Data Science), Data Preparation (Data Science)</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../operations/machine_learning_lifecycle/05_model_development_selection_and_training/05_ml_training_pipeline.html">Stage 5. Model Development and Training (MLOps)</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../operations/machine_learning_lifecycle/05_model_development_selection_and_training/051_model_selection.html">Stage 5.1. Model Selection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../operations/machine_learning_lifecycle/05_model_development_selection_and_training/052_metric_selection.html">Stage 5.2. Metric Selection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../operations/machine_learning_lifecycle/05_model_development_selection_and_training/053_experiment_tracking.html">Stage 5.3. Experiment Tracking And Versioning</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../operations/machine_learning_lifecycle/05_model_development_selection_and_training/054_model_testing.html">Stage 5.4. Model Testing</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../operations/distributed/intro.html">Distributed Systems</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../operations/distributed/01_notations.html">Notations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../operations/distributed/02_basics.html">Basics Of Distributed Data Parallelism</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../operations/distributed/03_how_to_setup_slurm_in_aws.html">How to Setup SLURM and ParallelCluster in AWS</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Software Engineering</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="concept.html">Configuration Management</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Pydantic And Hydra</a></li>
<li class="toctree-l2"><a class="reference internal" href="02-state.html">State And Metadata Management</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../devops/continuous-integration/concept.html">Continuous Integration (CI) Workflow</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../devops/continuous-integration/styling.html">Styling, Formatting, and Linting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../devops/continuous-integration/testing.html">Testing</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../design_patterns/dependency-inversion-principle.html">Dependency Inversion Principle</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../concurrency_parallelism_asynchronous/intro.html">Concurrency, Parallelism and Asynchronous Programming</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../concurrency_parallelism_asynchronous/generator_yield.html">A Rudimentary Introduction to Generator and Yield in Python</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../serving/restful_api/intro.html">RESTful API</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../serving/restful_api/application_banking.html">Application: Designing a RESTful Banking API with FastAPI and SQLAlchemy</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Computer Science</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../computer_science/type_theory/intro.html">Type Theory, A Very Rudimentary Introduction</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../computer_science/type_theory/01-subtypes.html">Subtypes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../computer_science/type_theory/02-type-safety.html">Type Safety</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../computer_science/type_theory/03-subsumption.html">Subsumption</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../computer_science/type_theory/04-generics.html">Generics and Type Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../computer_science/type_theory/05-typevar-bound-constraints.html">Bound and Constraint in Generics and Type Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../computer_science/type_theory/06-invariance-covariance-contravariance.html">Invariance, Covariance and Contravariance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../computer_science/type_theory/07-pep-3124-overloading.html">Function Overloading</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../computer_science/type_theory/08-pep-661-sentinel-values.html">Sentinel Types</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Data Structures and Algorithms</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../dsa/complexity_analysis/intro.html">Complexity Analysis</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../dsa/complexity_analysis/master_theorem.html">Master Theorem </a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../dsa/stack/intro.html">Stack</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../dsa/stack/concept.html">Concept</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../dsa/searching_algorithms/linear_search/intro.html">Linear Search</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../dsa/searching_algorithms/linear_search/concept.html">Concept</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../dsa/searching_algorithms/binary_search/intro.html">Binary Search</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../dsa/searching_algorithms/binary_search/concept.html">Concept</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dsa/searching_algorithms/binary_search/problems/875-koko-eating-bananas.html">Koko Eating Bananas</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Linear Algebra</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../linear_algebra/01_preliminaries/intro.html">Preliminaries</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../linear_algebra/01_preliminaries/01-fields.html">Fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../linear_algebra/01_preliminaries/02-systems-of-linear-equations.html">Systems of Linear Equations</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../linear_algebra/02_vectors/intro.html">Vectors</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../linear_algebra/02_vectors/01-vector-definition.html">Vector and Its Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../linear_algebra/02_vectors/02-vector-operation.html">Vector and Its Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../linear_algebra/02_vectors/03-vector-norm.html">Vector Norm and Distance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../linear_algebra/02_vectors/04-vector-products.html">A First Look at Vector Products</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">References, Resources and Roadmap</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../bibliography.html">Bibliography</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../citations.html">IEEE (Style) Citations</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../api/reproducibility.html">API Reference</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/gao-hongnan/omniverse/blob/main/omniverse/software_engineering/config_management/01-pydra.md" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/gao-hongnan/omniverse" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/gao-hongnan/omniverse/issues/new?title=Issue%20on%20page%20%2Fsoftware_engineering/config_management/01-pydra.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/software_engineering/config_management/01-pydra.ipynb" target="_blank"
   class="btn btn-sm btn-download-notebook-button dropdown-item"
   title="Download notebook file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-code"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li><a href="../../_sources/software_engineering/config_management/01-pydra.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Pydantic And Hydra</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#hydra">Hydra</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#yaml-driven-configuration">YAML Driven Configuration</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pros">Pros</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#structured-config">Structured Config</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cons">Cons</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#instantiating">Instantiating</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#composition-order">Composition Order</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pydantic">Pydantic</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pydantic-schema">Pydantic Schema</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Pros</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pydra">Pydra</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references-and-further-readings">References and Further Readings</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="pydantic-and-hydra">
<h1>Pydantic And Hydra<a class="headerlink" href="#pydantic-and-hydra" title="Link to this heading">#</a></h1>
<p><a class="reference external" href="https://twitter.com/gaohongnan"><img alt="Twitter Handle" src="https://img.shields.io/badge/Twitter-&#64;gaohongnan-blue?style=social&amp;logo=twitter" /></a>
<a class="reference external" href="https://linkedin.com/in/gao-hongnan"><img alt="LinkedIn Profile" src="https://img.shields.io/badge/&#64;gaohongnan-blue?style=social&amp;logo=linkedin" /></a>
<a class="reference external" href="https://github.com/gao-hongnan"><img alt="GitHub Profile" src="https://img.shields.io/badge/GitHub-gao--hongnan-lightgrey?style=social&amp;logo=github" /></a>
<img alt="Tag" src="https://img.shields.io/badge/Tag-Brain_Dump-red" />
<img alt="Tag" src="https://img.shields.io/badge/Level-Beginner-green" />
<a class="reference external" href="https://github.com/gao-hongnan/omniverse/tree/4c886c6735b3164325bf9ebbd360ef42bbd71769/omnixamples/software_engineering/config_management"><img alt="Code" src="https://img.shields.io/badge/View-Code-blue?style=flat-square&amp;logo=github" /></a></p>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#hydra" id="id2">Hydra</a></p>
<ul>
<li><p><a class="reference internal" href="#yaml-driven-configuration" id="id3">YAML Driven Configuration</a></p></li>
<li><p><a class="reference internal" href="#pros" id="id4">Pros</a></p></li>
<li><p><a class="reference internal" href="#structured-config" id="id5">Structured Config</a></p></li>
<li><p><a class="reference internal" href="#cons" id="id6">Cons</a></p></li>
<li><p><a class="reference internal" href="#instantiating" id="id7">Instantiating</a></p></li>
<li><p><a class="reference internal" href="#composition-order" id="id8">Composition Order</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#pydantic" id="id9">Pydantic</a></p>
<ul>
<li><p><a class="reference internal" href="#pydantic-schema" id="id10">Pydantic Schema</a></p></li>
<li><p><a class="reference internal" href="#id1" id="id11">Pros</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#pydra" id="id12">Pydra</a></p></li>
<li><p><a class="reference internal" href="#references-and-further-readings" id="id13">References and Further Readings</a></p></li>
</ul>
</nav>
<p>This post is heavily inspired by
<a class="reference external" href="https://suneeta-mall.github.io/2022/03/15/hydra-pydantic-config-management-for-training-application.html">Pydra - Pydantic and Hydra for configuration management of model training experiments</a>
which talks about combining Pydantic and Hydra for configuration management.</p>
<section id="hydra">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Hydra</a><a class="headerlink" href="#hydra" title="Link to this heading">#</a></h2>
<p>We wonâ€™t go into the details of what <a class="reference external" href="https://hydra.cc/docs/intro/">Hydra</a> is,
as the documentation covers the it very well. We will show a working example on
how to use Hydra for configuration management.</p>
<section id="yaml-driven-configuration">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">YAML Driven Configuration</a><a class="headerlink" href="#yaml-driven-configuration" title="Link to this heading">#</a></h3>
<p>First we need to define the configuration files in <code class="docutils literal notranslate"><span class="pre">yaml</span></code> format.</p>
<div class="tab-set docutils">
<input checked="True" class="tab-input" id="tab-set--0-input--1" name="tab-set--0" type="radio"><label class="tab-label" for="tab-set--0-input--1"><strong>model.yaml</strong></label><div class="tab-content docutils">
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">model_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;resnet18&quot;</span>
<span class="nt">pretrained</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="nt">in_chans</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="nt">num_classes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${train.num_classes}</span>
<span class="nt">global_pool</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;avg&quot;</span>
<span class="c1"># You typically want _self_ somewhere after the schema (base_config)</span>
</pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--0-input--2" name="tab-set--0" type="radio"><label class="tab-label" for="tab-set--0-input--2"><strong>optimizer.yaml</strong></label><div class="tab-content docutils">
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">optimizer_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;AdamW&quot;</span>
<span class="nt">optimizer_params</span><span class="p">:</span>
<span class="w">    </span><span class="nt">lr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0003</span><span class="w">  </span><span class="c1"># bs: 32 -&gt; lr = 3e-4</span>
<span class="w">    </span><span class="nt">betas</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">0.9</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0.999</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">amsgrad</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="w">    </span><span class="nt">weight_decay</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.000001</span>
<span class="w">    </span><span class="nt">eps</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.00000001</span>
</pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--0-input--3" name="tab-set--0" type="radio"><label class="tab-label" for="tab-set--0-input--3"><strong>stores.yaml</strong></label><div class="tab-content docutils">
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">project_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${train.project_name}</span>
<span class="nt">unique_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${now:%Y%m%d_%H%M%S}</span><span class="w"> </span><span class="c1"># in sync with hydra output dir</span>
<span class="nt">logs_dir</span><span class="p">:</span><span class="w"> </span><span class="kt">!!python/object/apply:pathlib.PosixPath</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;./logs&quot;</span><span class="p p-Indicator">]</span>
<span class="nt">model_artifacts_dir</span><span class="p">:</span><span class="w"> </span><span class="kt">!!python/object/apply:pathlib.PosixPath</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;./artifacts&quot;</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--0-input--4" name="tab-set--0" type="radio"><label class="tab-label" for="tab-set--0-input--4"><strong>transform.yaml</strong></label><div class="tab-content docutils">
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">image_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">256</span>
<span class="nt">mean</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">0.485</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0.456</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0.406</span><span class="p p-Indicator">]</span>
<span class="nt">std</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">0.229</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0.224</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0.225</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--0-input--5" name="tab-set--0" type="radio"><label class="tab-label" for="tab-set--0-input--5"><strong>datamodule.yaml</strong></label><div class="tab-content docutils">
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">data_dir</span><span class="p">:</span><span class="w"> </span><span class="kt">!!python/object/apply:pathlib.PosixPath</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;./data&quot;</span><span class="p p-Indicator">]</span>
<span class="nt">batch_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">32</span>
<span class="nt">num_workers</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="nt">shuffle</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--0-input--6" name="tab-set--0" type="radio"><label class="tab-label" for="tab-set--0-input--6"><strong>config.yaml</strong></label><div class="tab-content docutils">
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">defaults</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_self_</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">model</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">base</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">datamodule</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">base</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">transform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">base</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">stores</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">base</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">optimizer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">base</span>

<span class="nt">train</span><span class="p">:</span>
<span class="w">  </span><span class="nt">num_classes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">  </span><span class="nt">device</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;cpu&quot;</span>
<span class="w">  </span><span class="nt">project_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;cifar10&quot;</span>
<span class="w">  </span><span class="nt">debug</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">seed</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1992</span>
<span class="w">  </span><span class="nt">num_epochs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>

<span class="nt">hydra</span><span class="p">:</span>
<span class="w">  </span><span class="nt">run</span><span class="p">:</span>
<span class="w">    </span><span class="nt">dir</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${stores.model_artifacts_dir}/${train.project_name}/${stores.unique_id}&quot;</span><span class="w"> </span><span class="c1"># in sync with stores</span>
</pre></div>
</div>
</div>
</div>
<p>Then we define an entrypoint to run, along with a simple <code class="docutils literal notranslate"><span class="pre">train</span></code> function.</p>
<div class="tab-set docutils">
<input checked="True" class="tab-input" id="tab-set--1-input--1" name="tab-set--1" type="radio"><label class="tab-label" for="tab-set--1-input--1"><strong><a class="reference external" href="http://main.py">main.py</a></strong></label><div class="tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">import</span> <span class="nn">hydra</span>
<span class="kn">from</span> <span class="nn">hydra.core.hydra_config</span> <span class="kn">import</span> <span class="n">HydraConfig</span>
<span class="kn">from</span> <span class="nn">omegaconf</span> <span class="kn">import</span> <span class="n">DictConfig</span><span class="p">,</span> <span class="n">OmegaConf</span>

<span class="kn">from</span> <span class="nn">omnixamples.software_engineering.config_management.train</span> <span class="kn">import</span> <span class="n">train</span>

<span class="n">LOGGER</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="nd">@hydra</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">version_base</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">config_path</span><span class="o">=</span><span class="s2">&quot;configs&quot;</span><span class="p">,</span> <span class="n">config_name</span><span class="o">=</span><span class="s2">&quot;config&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="n">DictConfig</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run the main function.&quot;&quot;&quot;</span>
    <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Type of config is: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">config</span><span class="p">))</span>
    <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Merged Yaml:</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">OmegaConf</span><span class="o">.</span><span class="n">to_yaml</span><span class="p">(</span><span class="n">config</span><span class="p">))</span>
    <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">HydraConfig</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">job</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="n">train</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--1-input--2" name="tab-set--1" type="radio"><label class="tab-label" for="tab-set--1-input--2"><strong><a class="reference external" href="http://train.py">train.py</a></strong></label><div class="tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span>

<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torchvision</span>  <span class="c1"># type: ignore[import-untyped]</span>
<span class="kn">from</span> <span class="nn">rich.pretty</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="kn">from</span> <span class="nn">torch</span> <span class="kn">import</span> <span class="n">nn</span>
<span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">DataLoader</span>
<span class="kn">from</span> <span class="nn">torchvision</span> <span class="kn">import</span> <span class="n">datasets</span><span class="p">,</span> <span class="n">transforms</span>  <span class="c1"># type: ignore[import-untyped]</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>


<span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run the training pipeline, however, the code below can be further</span>
<span class="sd">    modularized into functions for better readability and maintainability.&quot;&quot;&quot;</span>
    <span class="n">pprint</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

    <span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>

    <span class="n">transform</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">Compose</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">transforms</span><span class="o">.</span><span class="n">Resize</span><span class="p">((</span><span class="n">config</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">image_size</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">image_size</span><span class="p">)),</span>
            <span class="n">transforms</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">(),</span>
            <span class="n">transforms</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">std</span><span class="p">),</span>
        <span class="p">]</span>
    <span class="p">)</span>

    <span class="n">dataset</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">CIFAR10</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="n">train</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">dataloader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span>
        <span class="n">dataset</span><span class="p">,</span>
        <span class="n">batch_size</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span>
        <span class="n">num_workers</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">num_workers</span><span class="p">,</span>
        <span class="n">shuffle</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">shuffle</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">model</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">torchvision</span><span class="o">.</span><span class="n">models</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">model_name</span><span class="p">)(</span><span class="n">pretrained</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">pretrained</span><span class="p">)</span>
    <span class="n">num_features</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fc</span><span class="o">.</span><span class="n">in_features</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fc</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">num_features</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">num_classes</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>

    <span class="n">optimizer</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">optimizer_name</span><span class="p">)(</span>
        <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="o">**</span><span class="n">config</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">optimizer_params</span>
    <span class="p">)</span>

    <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">num_epochs</span><span class="p">):</span>
        <span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
        <span class="k">with</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">dataloader</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Epoch [</span><span class="si">{</span><span class="n">epoch</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">num_epochs</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;batch&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tepoch</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">images</span><span class="p">,</span> <span class="n">labels</span> <span class="ow">in</span> <span class="n">tepoch</span><span class="p">:</span>
                <span class="n">images</span> <span class="o">=</span> <span class="n">images</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
                <span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>

                <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
                <span class="n">logits</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">images</span><span class="p">)</span>
                <span class="n">loss</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">CrossEntropyLoss</span><span class="p">()(</span><span class="n">logits</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
                <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
                <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>

                <span class="n">tepoch</span><span class="o">.</span><span class="n">set_postfix</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>

    <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">state_dict</span><span class="p">(),</span> <span class="n">config</span><span class="o">.</span><span class="n">stores</span><span class="o">.</span><span class="n">model_artifacts_dir</span> <span class="o">/</span> <span class="s2">&quot;model.pth&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">&#64;hydra.main</span></code> decorator is used to initialize the hydra application. We
specify <code class="docutils literal notranslate"><span class="pre">config_path</span></code> to tell hydra where to look for the base configuration
files. We also specify <code class="docutils literal notranslate"><span class="pre">config_name</span></code> to tell hydra which file is the main
controller of the hierarchy. In this case, it is <code class="docutils literal notranslate"><span class="pre">config.yaml</span></code>. Running the
<code class="docutils literal notranslate"><span class="pre">main.py</span></code> file will create an <code class="docutils literal notranslate"><span class="pre">artifacts</span></code> folder hosting useful information from
hydra. Note the <code class="docutils literal notranslate"><span class="pre">artifacts</span></code> folder is a configurable name, the default is
actually <code class="docutils literal notranslate"><span class="pre">outputs</span></code>. Letâ€™s see what we have inside this folder!</p>
<p>Running <code class="docutils literal notranslate"><span class="pre">tree</span> <span class="pre">-a</span> <span class="pre">artifacts/</span></code> will show the following:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>artifacts
â””â”€â”€ cifar10
    â””â”€â”€ 20240509_155331
        â”œâ”€â”€ .hydra
        â”‚   â”œâ”€â”€ config.yaml
        â”‚   â”œâ”€â”€ hydra.yaml
        â”‚   â””â”€â”€ overrides.yaml
        â””â”€â”€ main.log

4 directories, 4 files
</pre></div>
</div>
<p>And the content is as follows:</p>
<div class="tab-set docutils">
<input checked="True" class="tab-input" id="tab-set--2-input--1" name="tab-set--2" type="radio"><label class="tab-label" for="tab-set--2-input--1"><strong>.hydra/config.yaml</strong></label><div class="tab-content docutils">
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">train</span><span class="p">:</span>
<span class="w">    </span><span class="nt">num_classes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">    </span><span class="nt">device</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cpu</span>
<span class="w">    </span><span class="nt">project_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cifar10</span>
<span class="w">    </span><span class="nt">debug</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">seed</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1992</span>
<span class="w">    </span><span class="nt">num_epochs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="nt">model</span><span class="p">:</span>
<span class="w">    </span><span class="nt">model_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">resnet18</span>
<span class="w">    </span><span class="nt">pretrained</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">in_chans</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="w">    </span><span class="nt">num_classes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${train.num_classes}</span>
<span class="w">    </span><span class="nt">global_pool</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">avg</span>
<span class="nt">datamodule</span><span class="p">:</span>
<span class="w">    </span><span class="nt">data_dir</span><span class="p">:</span><span class="w"> </span><span class="kt">!!python/object/apply:pathlib.PosixPath</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">data</span>
<span class="w">    </span><span class="nt">batch_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">32</span>
<span class="w">    </span><span class="nt">num_workers</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">    </span><span class="nt">shuffle</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="nt">transform</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">256</span>
<span class="w">    </span><span class="nt">mean</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.485</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.456</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.406</span>
<span class="w">    </span><span class="nt">std</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.229</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.224</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.225</span>
<span class="nt">stores</span><span class="p">:</span>
<span class="w">    </span><span class="nt">project_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${train.project_name}</span>
<span class="w">    </span><span class="nt">unique_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${now:%Y%m%d_%H%M%S}</span>
<span class="w">    </span><span class="nt">logs_dir</span><span class="p">:</span><span class="w"> </span><span class="kt">!!python/object/apply:pathlib.PosixPath</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">logs</span>
<span class="w">    </span><span class="nt">model_artifacts_dir</span><span class="p">:</span><span class="w"> </span><span class="kt">!!python/object/apply:pathlib.PosixPath</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">artifacts</span>
<span class="nt">optimizer</span><span class="p">:</span>
<span class="w">    </span><span class="nt">optimizer_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AdamW</span>
<span class="w">    </span><span class="nt">optimizer_params</span><span class="p">:</span>
<span class="w">        </span><span class="nt">lr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0003</span>
<span class="w">        </span><span class="nt">betas</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.9</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.999</span>
<span class="w">        </span><span class="nt">amsgrad</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">        </span><span class="nt">weight_decay</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.0e-06</span>
<span class="w">        </span><span class="nt">eps</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.0e-08</span>
</pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--2-input--2" name="tab-set--2" type="radio"><label class="tab-label" for="tab-set--2-input--2"><strong>.hydra/hydra.yaml</strong></label><div class="tab-content docutils">
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">hydra</span><span class="p">:</span>
<span class="w">  </span><span class="nt">run</span><span class="p">:</span>
<span class="w">    </span><span class="nt">dir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${stores.model_artifacts_dir}/${train.project_name}/${stores.unique_id}</span>
<span class="w">  </span><span class="nt">sweep</span><span class="p">:</span>
<span class="w">    </span><span class="nt">dir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">multirun/${now:%Y-%m-%d}/${now:%H-%M-%S}</span>
<span class="w">    </span><span class="nt">subdir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${hydra.job.num}</span>
<span class="w">  </span><span class="nt">launcher</span><span class="p">:</span>
<span class="w">    </span><span class="nt">_target_</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hydra._internal.core_plugins.basic_launcher.BasicLauncher</span>
<span class="w">  </span><span class="nt">sweeper</span><span class="p">:</span>
<span class="w">    </span><span class="nt">_target_</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hydra._internal.core_plugins.basic_sweeper.BasicSweeper</span>
<span class="w">    </span><span class="nt">max_batch_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class="w">    </span><span class="nt">params</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class="w">  </span><span class="nt">help</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${hydra.job.name}</span>
<span class="w">    </span><span class="nt">header</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;${hydra.help.app_name}</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">powered</span><span class="nv"> </span><span class="s">by</span><span class="nv"> </span><span class="s">Hydra.</span>

<span class="w">      </span><span class="s">&#39;</span>
<span class="w">    </span><span class="nt">footer</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Powered</span><span class="nv"> </span><span class="s">by</span><span class="nv"> </span><span class="s">Hydra</span><span class="nv"> </span><span class="s">(https://hydra.cc)</span>

<span class="w">      </span><span class="s">Use</span><span class="nv"> </span><span class="s">--hydra-help</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">view</span><span class="nv"> </span><span class="s">Hydra</span><span class="nv"> </span><span class="s">specific</span><span class="nv"> </span><span class="s">help</span>

<span class="w">      </span><span class="s">&#39;</span>
<span class="w">    </span><span class="nt">template</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;${hydra.help.header}</span>

<span class="w">      </span><span class="s">==</span><span class="nv"> </span><span class="s">Configuration</span><span class="nv"> </span><span class="s">groups</span><span class="nv"> </span><span class="s">==</span>

<span class="w">      </span><span class="s">Compose</span><span class="nv"> </span><span class="s">your</span><span class="nv"> </span><span class="s">configuration</span><span class="nv"> </span><span class="s">from</span><span class="nv"> </span><span class="s">those</span><span class="nv"> </span><span class="s">groups</span><span class="nv"> </span><span class="s">(group=option)</span>


<span class="w">      </span><span class="s">$APP_CONFIG_GROUPS</span>


<span class="w">      </span><span class="s">==</span><span class="nv"> </span><span class="s">Config</span><span class="nv"> </span><span class="s">==</span>

<span class="w">      </span><span class="s">Override</span><span class="nv"> </span><span class="s">anything</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">config</span><span class="nv"> </span><span class="s">(foo.bar=value)</span>


<span class="w">      </span><span class="s">$CONFIG</span>


<span class="w">      </span><span class="s">${hydra.help.footer}</span>

<span class="w">      </span><span class="s">&#39;</span>
<span class="w">  </span><span class="nt">hydra_help</span><span class="p">:</span>
<span class="w">    </span><span class="nt">template</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Hydra</span><span class="nv"> </span><span class="s">(${hydra.runtime.version})</span>

<span class="w">      </span><span class="s">See</span><span class="nv"> </span><span class="s">https://hydra.cc</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">more</span><span class="nv"> </span><span class="s">info.</span>


<span class="w">      </span><span class="s">==</span><span class="nv"> </span><span class="s">Flags</span><span class="nv"> </span><span class="s">==</span>

<span class="w">      </span><span class="s">$FLAGS_HELP</span>


<span class="w">      </span><span class="s">==</span><span class="nv"> </span><span class="s">Configuration</span><span class="nv"> </span><span class="s">groups</span><span class="nv"> </span><span class="s">==</span>

<span class="w">      </span><span class="s">Compose</span><span class="nv"> </span><span class="s">your</span><span class="nv"> </span><span class="s">configuration</span><span class="nv"> </span><span class="s">from</span><span class="nv"> </span><span class="s">those</span><span class="nv"> </span><span class="s">groups</span><span class="nv"> </span><span class="s">(For</span><span class="nv"> </span><span class="s">example,</span><span class="nv"> </span><span class="s">append</span><span class="nv"> </span><span class="s">hydra/job_logging=disabled</span>
<span class="w">      </span><span class="s">to</span><span class="nv"> </span><span class="s">command</span><span class="nv"> </span><span class="s">line)</span>


<span class="w">      </span><span class="s">$HYDRA_CONFIG_GROUPS</span>


<span class="w">      </span><span class="s">Use</span><span class="nv"> </span><span class="se">&#39;&#39;</span><span class="s">--cfg</span><span class="nv"> </span><span class="s">hydra</span><span class="se">&#39;&#39;</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">Show</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">Hydra</span><span class="nv"> </span><span class="s">config.</span>

<span class="w">      </span><span class="s">&#39;</span>
<span class="w">    </span><span class="nt">hydra_help</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">???</span>
<span class="w">  </span><span class="nt">hydra_logging</span><span class="p">:</span>
<span class="w">    </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">    </span><span class="nt">formatters</span><span class="p">:</span>
<span class="w">      </span><span class="nt">simple</span><span class="p">:</span>
<span class="w">        </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;[%(asctime)s][HYDRA]</span><span class="nv"> </span><span class="s">%(message)s&#39;</span>
<span class="w">    </span><span class="nt">handlers</span><span class="p">:</span>
<span class="w">      </span><span class="nt">console</span><span class="p">:</span>
<span class="w">        </span><span class="nt">class</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">logging.StreamHandler</span>
<span class="w">        </span><span class="nt">formatter</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">simple</span>
<span class="w">        </span><span class="nt">stream</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ext://sys.stdout</span>
<span class="w">    </span><span class="nt">root</span><span class="p">:</span>
<span class="w">      </span><span class="nt">level</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">INFO</span>
<span class="w">      </span><span class="nt">handlers</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">console</span>
<span class="w">    </span><span class="nt">loggers</span><span class="p">:</span>
<span class="w">      </span><span class="nt">logging_example</span><span class="p">:</span>
<span class="w">        </span><span class="nt">level</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DEBUG</span>
<span class="w">    </span><span class="nt">disable_existing_loggers</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">  </span><span class="nt">job_logging</span><span class="p">:</span>
<span class="w">    </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">    </span><span class="nt">formatters</span><span class="p">:</span>
<span class="w">      </span><span class="nt">simple</span><span class="p">:</span>
<span class="w">        </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;[%(asctime)s][%(name)s][%(levelname)s]</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">%(message)s&#39;</span>
<span class="w">    </span><span class="nt">handlers</span><span class="p">:</span>
<span class="w">      </span><span class="nt">console</span><span class="p">:</span>
<span class="w">        </span><span class="nt">class</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">logging.StreamHandler</span>
<span class="w">        </span><span class="nt">formatter</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">simple</span>
<span class="w">        </span><span class="nt">stream</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ext://sys.stdout</span>
<span class="w">      </span><span class="nt">file</span><span class="p">:</span>
<span class="w">        </span><span class="nt">class</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">logging.FileHandler</span>
<span class="w">        </span><span class="nt">formatter</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">simple</span>
<span class="w">        </span><span class="nt">filename</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${hydra.runtime.output_dir}/${hydra.job.name}.log</span>
<span class="w">    </span><span class="nt">root</span><span class="p">:</span>
<span class="w">      </span><span class="nt">level</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">INFO</span>
<span class="w">      </span><span class="nt">handlers</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">console</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">file</span>
<span class="w">    </span><span class="nt">disable_existing_loggers</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">  </span><span class="nt">env</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<span class="w">  </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RUN</span>
<span class="w">  </span><span class="nt">searchpath</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
<span class="w">  </span><span class="nt">callbacks</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<span class="w">  </span><span class="nt">output_subdir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.hydra</span>
<span class="w">  </span><span class="nt">overrides</span><span class="p">:</span>
<span class="w">    </span><span class="nt">hydra</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hydra.mode=RUN</span>
<span class="w">    </span><span class="nt">task</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
<span class="w">  </span><span class="nt">job</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">main</span>
<span class="w">    </span><span class="nt">chdir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class="w">    </span><span class="nt">override_dirname</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;&#39;</span>
<span class="w">    </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">???</span>
<span class="w">    </span><span class="nt">num</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">???</span>
<span class="w">    </span><span class="nt">config_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">config</span>
<span class="w">    </span><span class="nt">env_set</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<span class="w">    </span><span class="nt">env_copy</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
<span class="w">    </span><span class="nt">config</span><span class="p">:</span>
<span class="w">      </span><span class="nt">override_dirname</span><span class="p">:</span>
<span class="w">        </span><span class="nt">kv_sep</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;=&#39;</span>
<span class="w">        </span><span class="nt">item_sep</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;,&#39;</span>
<span class="w">        </span><span class="nt">exclude_keys</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
<span class="w">  </span><span class="nt">runtime</span><span class="p">:</span>
<span class="w">    </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.3.2</span>
<span class="w">    </span><span class="nt">version_base</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;1.3&#39;</span>
<span class="w">    </span><span class="nt">cwd</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/Users/gaohn/gaohn/omniverse</span>
<span class="w">    </span><span class="nt">config_sources</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hydra.conf</span>
<span class="w">      </span><span class="nt">schema</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pkg</span>
<span class="w">      </span><span class="nt">provider</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hydra</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/Users/gaohn/gaohn/omniverse/omnixamples/software_engineering/config_management/hydra/configs</span>
<span class="w">      </span><span class="nt">schema</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">file</span>
<span class="w">      </span><span class="nt">provider</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">main</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;&#39;</span>
<span class="w">      </span><span class="nt">schema</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">structured</span>
<span class="w">      </span><span class="nt">provider</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">schema</span>
<span class="w">    </span><span class="nt">output_dir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/Users/gaohn/gaohn/omniverse/artifacts/cifar10/20240509_155331</span>
<span class="w">    </span><span class="nt">choices</span><span class="p">:</span>
<span class="w">      </span><span class="nt">optimizer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">base</span>
<span class="w">      </span><span class="nt">stores</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">base</span>
<span class="w">      </span><span class="nt">transform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">base</span>
<span class="w">      </span><span class="nt">datamodule</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">base</span>
<span class="w">      </span><span class="nt">model</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">base</span>
<span class="w">      </span><span class="nt">hydra/env</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">      </span><span class="nt">hydra/callbacks</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class="w">      </span><span class="nt">hydra/job_logging</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">      </span><span class="nt">hydra/hydra_logging</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">      </span><span class="nt">hydra/hydra_help</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">      </span><span class="nt">hydra/help</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">      </span><span class="nt">hydra/sweeper</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">basic</span>
<span class="w">      </span><span class="nt">hydra/launcher</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">basic</span>
<span class="w">      </span><span class="nt">hydra/output</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">  </span><span class="nt">verbose</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--2-input--3" name="tab-set--2" type="radio"><label class="tab-label" for="tab-set--2-input--3"><strong>.hydra/overrides.yaml</strong></label><div class="tab-content docutils">
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">[]</span>
</pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--2-input--4" name="tab-set--2" type="radio"><label class="tab-label" for="tab-set--2-input--4"><strong>main.log</strong></label><div class="tab-content docutils">
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>[2024-05-09 15:53:31,713][__main__][INFO] - Type of config is: &lt;class &#39;omegaconf.dictconfig.DictConfig&#39;&gt;
[2024-05-09 15:53:31,715][__main__][INFO] - Merged Yaml:
train:
  num_classes: 10
  device: cpu
  project_name: cifar10
  debug: true
  seed: 1992
  num_epochs: 3
model:
  model_name: resnet18
  pretrained: true
  in_chans: 3
  num_classes: ${train.num_classes}
  global_pool: avg
datamodule:
  data_dir: !!python/object/apply:pathlib.PosixPath
  - data
  batch_size: 32
  num_workers: 0
  shuffle: true
transform:
  image_size: 256
  mean:
  - 0.485
  - 0.456
  - 0.406
  std:
  - 0.229
  - 0.224
  - 0.225
stores:
  project_name: ${train.project_name}
  unique_id: ${now:%Y%m%d_%H%M%S}
  logs_dir: !!python/object/apply:pathlib.PosixPath
  - logs
  model_artifacts_dir: !!python/object/apply:pathlib.PosixPath
  - artifacts
optimizer:
  optimizer_name: AdamW
  optimizer_params:
    lr: 0.0003
    betas:
    - 0.9
    - 0.999
    amsgrad: false
    weight_decay: 1.0e-06
    eps: 1.0e-08

[2024-05-09 15:53:31,715][__main__][INFO] - main
</pre></div>
</div>
</div>
</div>
<p>One highlight is we can override this configuration file with command line
arguments. So if you tend to have many config folders, then this can come in
handy.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>main.py<span class="w"> </span>train.num_epochs<span class="o">=</span><span class="m">5</span>
</pre></div>
</div>
<p>and now in <code class="docutils literal notranslate"><span class="pre">overrides.yaml</span></code> you will see</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">train.num_epochs=5</span>
</pre></div>
</div>
</section>
<section id="pros">
<h3><a class="toc-backref" href="#id4" role="doc-backlink">Pros</a><a class="headerlink" href="#pros" title="Link to this heading">#</a></h3>
<ol class="arabic">
<li><p>Once you load the configuration, you can access the configuration values
using the dot (chain) notation. This is because <code class="docutils literal notranslate"><span class="pre">config</span></code> is loaded as
<a class="reference external" href="https://github.com/omry/omegaconf">OmegaConf</a>â€™s <code class="docutils literal notranslate"><span class="pre">DictConfig</span></code> object. They
inherit from <code class="docutils literal notranslate"><span class="pre">dict</span></code> and <code class="docutils literal notranslate"><span class="pre">MutableMapping</span></code> so you can access the values using
the dot notation access pattern. This is better than using
<code class="docutils literal notranslate"><span class="pre">config[&quot;train&quot;][&quot;num_classes&quot;]</span></code> because it is more readable and less error
prone, and also allow you to manipulate the object. One other reason is
using dictionary is a bit hard to do type checking.</p></li>
<li><p>Allow command line overrides. For example, you can override the <code class="docutils literal notranslate"><span class="pre">model_name</span></code>
from <code class="docutils literal notranslate"><span class="pre">model</span></code> by</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>main.py<span class="w"> </span>model.model_name<span class="o">=</span>resnet50
</pre></div>
</div>
<p>and the <code class="docutils literal notranslate"><span class="pre">model_name</span></code> will change during runtime. This is very useful when
you want to run multiple experiments with different configurations. You
wonâ€™t need to create multiple config files for each experiment just to
change a single/few value(s).</p>
</li>
<li><p>A natural follow-up question is about persistence. If I can easily override
the configuration, then how do I make sure the configuration is saved
somewhere? Versioning the configs is just as important as versioning your
code in Machine Learning. Usually I would dump these config to a registry or
store in code.</p>
<p>The highlight here is Hydra also saves the final configuration to an output
folder. By default, it is stored in
<code class="docutils literal notranslate"><span class="pre">outputs/YYYY-MM-DD/HH-MM-SS/.hydra/config.yaml</span></code>. Now you can revert back to
this exact run by specifying the directory.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>main.py<span class="w"> </span>--config_path<span class="w"> </span>outputs/2022-01-12/12-00-00/.hydra/config.yaml
</pre></div>
</div>
<p>to recover your run. Here <code class="docutils literal notranslate"><span class="pre">YYYY-MM-DD/HH-MM-SS</span></code> is like your unique <code class="docutils literal notranslate"><span class="pre">run_id</span></code>
for each run. You can also change it as follows in <code class="docutils literal notranslate"><span class="pre">config.yaml</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">hydra</span><span class="p">:</span>
<span class="nt">run</span><span class="p">:</span>
<span class="w">    </span><span class="nt">dir</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${stores.model_artifacts_dir}/${train.project_name}/${stores.unique_id}&quot;</span><span class="w"> </span><span class="c1"># in sync with stores</span>
</pre></div>
</div>
</li>
<li><p>One more good to have feature is overriding hydraâ€™s own default settings,
such as the <code class="docutils literal notranslate"><span class="pre">job</span></code> and <code class="docutils literal notranslate"><span class="pre">run</span></code> settings. You can either do it via <code class="docutils literal notranslate"><span class="pre">config.yaml</span></code>
or manually create a folder called <code class="docutils literal notranslate"><span class="pre">hydra</span></code> and put the specifics inside. See
<a class="reference external" href="https://github.com/suneeta-mall/hydra_pydantic_config_management/tree/master/hydra/conf_custom_hydra/hydra">here</a>
for an example.</p></li>
<li><p>Multi-run. Hydra allows you to run multiple experiments in parallel. This is
very useful when you want to run multiple experiments with different
configurations. You can specify the number of runs and the configuration to
use. See
<a class="reference external" href="https://hydra.cc/docs/tutorials/basic/running_your_app/multi-run/">here</a>
for more examples.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>main.py<span class="w"> </span>model.model_name<span class="o">=</span>resnet18,resnet50<span class="w"> </span>--multirun
</pre></div>
</div>
<p>This will run two experiments in parallel, one with <code class="docutils literal notranslate"><span class="pre">resnet18</span></code> and the other
with <code class="docutils literal notranslate"><span class="pre">resnet50</span></code>. We see the true power of it if you want to do
hyperparameter search, where you want to sweep over multiple values for a
single parameter.</p>
<p>Now in the same directory, an <code class="docutils literal notranslate"><span class="pre">multirun</span></code> folder will be created and inside
it, you will see two runs, one with <code class="docutils literal notranslate"><span class="pre">resnet18</span></code> and the other with
<code class="docutils literal notranslate"><span class="pre">resnet50</span></code>. Each process is indexed by an integer. For example, <code class="docutils literal notranslate"><span class="pre">resnet18</span></code>
is indexed by <code class="docutils literal notranslate"><span class="pre">0</span></code> and <code class="docutils literal notranslate"><span class="pre">resnet50</span></code> is indexed by <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p>
<p>It is also worth noting that since the hydraâ€™s creator is from facebook, it
is very easy to integrate with PyTorchâ€™s
<a class="reference external" href="https://pytorch.org/tutorials/intermediate/dist_tuto.html">distributed trainings</a>.</p>
</li>
</ol>
<ul class="simple">
<li><p>Interpolation: This is an extremely highlighted feature of hydra. For
example, we have <code class="docutils literal notranslate"><span class="pre">num_classes</span></code> defined under the <code class="docutils literal notranslate"><span class="pre">train</span></code> schema. However,
this parameter is also used in the <code class="docutils literal notranslate"><span class="pre">model</span></code> schema, defining the number of
output neurons. It can also be used in the <code class="docutils literal notranslate"><span class="pre">datamodule</span></code> schema (not shown
here), where we need to know the number of classes to create certain <code class="docutils literal notranslate"><span class="pre">class</span></code>
mapping. Repeatedly defining the same parameter over different config schema
is prone to mistake. This is like hardcoding the same value <code class="docutils literal notranslate"><span class="pre">NUM_CLASSES</span></code> in
different python scripts. Here we use the idea of <strong>polymorphism</strong> to define
the <code class="docutils literal notranslate"><span class="pre">num_classes</span></code> in the <code class="docutils literal notranslate"><span class="pre">train</span></code> schema and use interpolation to <strong>inject</strong>
this all around with <code class="docutils literal notranslate"><span class="pre">${train.num_classes}</span></code>.</p></li>
</ul>
</section>
<section id="structured-config">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">Structured Config</a><a class="headerlink" href="#structured-config" title="Link to this heading">#</a></h3>
<p><a class="reference external" href="https://hydra.cc/docs/tutorials/structured_config/schema/">Structured Config</a>,
this is what Hydra call when your config is complex enough to warrant object
representations. For example, our <code class="docutils literal notranslate"><span class="pre">config.yaml</span></code> is currently just a Yaml
representation. But under the hood, you can think of it as <strong>composed</strong> of
<code class="docutils literal notranslate"><span class="pre">model</span></code>, <code class="docutils literal notranslate"><span class="pre">optimizer</span></code>, <code class="docutils literal notranslate"><span class="pre">store</span></code> and other schemas.</p>
<p>For each of these objects, you can define its own schema. This is very useful
when you want to validate the configuration.</p>
<p>In hydra, you can define the schema using
<a class="reference external" href="https://docs.python.org/3/library/dataclasses.html">dataclasses</a>.</p>
<div class="tab-set docutils">
<input checked="True" class="tab-input" id="tab-set--3-input--1" name="tab-set--3" type="radio"><label class="tab-label" for="tab-set--3-input--1"><strong><a class="reference external" href="http://base.py">base.py</a></strong></label><div class="tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">TransformConfig</span><span class="p">:</span>
    <span class="n">image_size</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">mean</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>
    <span class="n">std</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">ModelConfig</span><span class="p">:</span>
    <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">pretrained</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">in_chans</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;ge&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>  <span class="c1"># in_channels must be greater than or equal to 1</span>
    <span class="n">num_classes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;ge&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>  <span class="c1"># num_classes must be greater than or equal to 1</span>
    <span class="n">global_pool</span><span class="p">:</span> <span class="nb">str</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">StoresConfig</span><span class="p">:</span>
    <span class="n">project_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">unique_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">logs_dir</span><span class="p">:</span> <span class="n">Path</span>
    <span class="n">model_artifacts_dir</span><span class="p">:</span> <span class="n">Path</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">TrainConfig</span><span class="p">:</span>
    <span class="n">device</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">project_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">num_epochs</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">num_classes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">OptimizerConfig</span><span class="p">:</span>
    <span class="n">optimizer</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">optimizer_params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">DataConfig</span><span class="p">:</span>
    <span class="n">data_dir</span><span class="p">:</span> <span class="n">Path</span>
    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">num_workers</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">shuffle</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Config</span><span class="p">:</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">ModelConfig</span>
    <span class="n">augmentations</span><span class="p">:</span> <span class="n">TransformConfig</span>
    <span class="n">datamodule</span><span class="p">:</span> <span class="n">DataConfig</span>
    <span class="n">optimizer</span><span class="p">:</span> <span class="n">OptimizerConfig</span>
    <span class="n">stores</span><span class="p">:</span> <span class="n">StoresConfig</span>
    <span class="n">train</span><span class="p">:</span> <span class="n">TrainConfig</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Config</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">model</span><span class="o">=</span><span class="n">ModelConfig</span><span class="p">(</span><span class="o">**</span><span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]),</span>
            <span class="n">augmentations</span><span class="o">=</span><span class="n">TransformConfig</span><span class="p">(</span><span class="o">**</span><span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;augmentations&quot;</span><span class="p">]),</span>
            <span class="n">datamodule</span><span class="o">=</span><span class="n">DataConfig</span><span class="p">(</span><span class="o">**</span><span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;datamodule&quot;</span><span class="p">]),</span>
            <span class="n">optimizer</span><span class="o">=</span><span class="n">OptimizerConfig</span><span class="p">(</span><span class="o">**</span><span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;optimizer&quot;</span><span class="p">]),</span>
            <span class="n">stores</span><span class="o">=</span><span class="n">StoresConfig</span><span class="p">(</span><span class="o">**</span><span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;stores&quot;</span><span class="p">]),</span>
            <span class="n">train</span><span class="o">=</span><span class="n">TrainConfig</span><span class="p">(</span><span class="o">**</span><span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">]),</span>
        <span class="p">)</span>
</pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--3-input--2" name="tab-set--3" type="radio"><label class="tab-label" for="tab-set--3-input--2"><strong>main_structured.py</strong></label><div class="tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">import</span> <span class="nn">hydra</span>
<span class="kn">from</span> <span class="nn">hydra.core.config_store</span> <span class="kn">import</span> <span class="n">ConfigStore</span>
<span class="kn">from</span> <span class="nn">hydra.core.hydra_config</span> <span class="kn">import</span> <span class="n">HydraConfig</span>
<span class="kn">from</span> <span class="nn">omegaconf</span> <span class="kn">import</span> <span class="n">OmegaConf</span>

<span class="kn">from</span> <span class="nn">omnixamples.software_engineering.config_management.hydra.configs.base</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Config</span><span class="p">,</span>
    <span class="n">DataConfig</span><span class="p">,</span>
    <span class="n">ModelConfig</span><span class="p">,</span>
    <span class="n">OptimizerConfig</span><span class="p">,</span>
    <span class="n">StoresConfig</span><span class="p">,</span>
    <span class="n">TrainConfig</span><span class="p">,</span>
    <span class="n">TransformConfig</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">omnixamples.software_engineering.config_management.train</span> <span class="kn">import</span> <span class="n">train</span>

<span class="n">LOGGER</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">cs</span> <span class="o">=</span> <span class="n">ConfigStore</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span>
<span class="n">cs</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;base_config&quot;</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="n">Config</span><span class="p">)</span>
<span class="n">cs</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="n">ModelConfig</span><span class="p">)</span>
<span class="n">cs</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;optimizer&quot;</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="n">OptimizerConfig</span><span class="p">)</span>
<span class="n">cs</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;stores&quot;</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="n">StoresConfig</span><span class="p">)</span>
<span class="n">cs</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="n">TrainConfig</span><span class="p">)</span>
<span class="n">cs</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;transform&quot;</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="n">TransformConfig</span><span class="p">)</span>
<span class="n">cs</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;datamodule&quot;</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="n">DataConfig</span><span class="p">)</span>


<span class="nd">@hydra</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">version_base</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">config_path</span><span class="o">=</span><span class="s2">&quot;configs&quot;</span><span class="p">,</span> <span class="n">config_name</span><span class="o">=</span><span class="s2">&quot;config&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="n">Config</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run the main function.&quot;&quot;&quot;</span>
    <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Type of config is: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">config</span><span class="p">))</span>
    <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Merged Yaml:</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">OmegaConf</span><span class="o">.</span><span class="n">to_yaml</span><span class="p">(</span><span class="n">config</span><span class="p">))</span>
    <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">HydraConfig</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">job</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="n">config_obj</span> <span class="o">=</span> <span class="n">OmegaConf</span><span class="o">.</span><span class="n">to_object</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
    <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Type of config is: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">config_obj</span><span class="p">))</span>
    <span class="n">train</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>More details <a class="reference external" href="https://hydra.cc/docs/tutorials/structured_config/schema/">here</a>.
You can find how groups can be used to indicate inheritance.</p>
<p>The dependency injection here is merely a change of the type of the <code class="docutils literal notranslate"><span class="pre">config</span></code>
argument, from <code class="docutils literal notranslate"><span class="pre">DictConfig</span></code> to <code class="docutils literal notranslate"><span class="pre">Config</span></code>. The rest of the code remains the same.
The command line arguments are still the same.</p>
<p>Having dataclass representation also offers more flexibility from manipulating
the object to type hint. But validation still remains a problem as using
<code class="docutils literal notranslate"><span class="pre">__post_init__</span></code> method is
<a class="reference external" href="https://github.com/facebookresearch/hydra/issues/981">not well supported</a> when
working with hydra. However, you can decouple the usage of dataclass from
hydrasâ€™ dependency injection. For example, you can load the config from hydra
and instantiate through the dataclass without the use of <code class="docutils literal notranslate"><span class="pre">ConfigStore</span></code>. This
idea is made better when used together with Pydantic since it offers validation
and serialization. As we shall see later, Pydantic is a better version of
dataclass where it offers more features like pre-post validation, type checking,
constraints and better serialization. Just watch Jason Liuâ€™s
<a class="reference external" href="https://www.youtube.com/watch?v=yj-wSRJwrrc">Pydantic Is All You Need</a> to get a
sense how good pydantic is. In fact, with the rise of LLM, we can see most big
libraries built around it are leveraging pydantic.</p>
</section>
<section id="cons">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">Cons</a><a class="headerlink" href="#cons" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Serializing/Deserializing canonical or complex python objects are not well
supported. In earlier versions, objects like <code class="docutils literal notranslate"><span class="pre">pathlib.Path</span></code> are not
supported.</p></li>
<li><p>Structured config is only limited to <code class="docutils literal notranslate"><span class="pre">dataclass</span></code>. This means that you cannot
create your own custom abstraction. For example, you cannot create a <code class="docutils literal notranslate"><span class="pre">Model</span></code>
class without invoking <code class="docutils literal notranslate"><span class="pre">dataclass</span></code> decorator, and still be able to interact
with hydra.</p></li>
<li><p>No type checking. This is a big problem. You can define <code class="docutils literal notranslate"><span class="pre">num_classes</span></code> as an
<code class="docutils literal notranslate"><span class="pre">int</span></code> but user passes in a <code class="docutils literal notranslate"><span class="pre">str</span></code> of <code class="docutils literal notranslate"><span class="pre">&quot;10&quot;</span></code> instead of <code class="docutils literal notranslate"><span class="pre">10</span></code>, but hydra will
not complain. This means that you have to do type checking yourself (i.e. do
checks all over the application/business logic code).</p></li>
<li><p>No validation support. This means that if your global pooling methods
support only <code class="docutils literal notranslate"><span class="pre">avg</span></code> and <code class="docutils literal notranslate"><span class="pre">max</span></code>, you have to do the validation yourself. This
is a big problem because you have to do the validation all over the place.</p></li>
<li><p>Interpolation is really good, but the inability to simple manipulation over
it caused a lot of
<a class="reference external" href="https://github.com/omry/omegaconf/issues/91">complaints</a>. Like if you
defined a learning rate as <code class="docutils literal notranslate"><span class="pre">lr:</span> <span class="pre">0.001</span></code> and you want to multiply it by 10 in
another config file, you cannot do <code class="docutils literal notranslate"><span class="pre">10</span> <span class="pre">*</span> <span class="pre">${lr}</span></code>.</p></li>
</ul>
</section>
<section id="instantiating">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">Instantiating</a><a class="headerlink" href="#instantiating" title="Link to this heading">#</a></h3>
<p>You can also
<a class="reference external" href="https://hydra.cc/docs/advanced/instantiate_objects/overview/">instantiate</a>
objects with hydra.</p>
</section>
<section id="composition-order">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">Composition Order</a><a class="headerlink" href="#composition-order" title="Link to this heading">#</a></h3>
<p>By default, Hydra 1.1 appends <code class="docutils literal notranslate"><span class="pre">_self_</span></code> to the end of the Defaults List. This
behavior is new in Hydra 1.1 and different from previous Hydra versions. As such
Hydra 1.1 issues a warning if <code class="docutils literal notranslate"><span class="pre">_self_</span></code> is not specified in the primary config,
asking you to add <code class="docutils literal notranslate"><span class="pre">_self_</span></code> and thus indicate the desired composition order. To
address the warning while maintaining the new behavior, append <code class="docutils literal notranslate"><span class="pre">_self_</span></code> to the
end of the Defaults List. Note that in some cases it may instead be desirable to
add <code class="docutils literal notranslate"><span class="pre">_self_</span></code> directly after the schema and before other Defaults List elements.</p>
<p>See
<a class="reference external" href="https://hydra.cc/docs/advanced/defaults_list/#composition-order">Composition Order</a>
for more information.</p>
</section>
</section>
<section id="pydantic">
<h2><a class="toc-backref" href="#id9" role="doc-backlink">Pydantic</a><a class="headerlink" href="#pydantic" title="Link to this heading">#</a></h2>
<p>Pydantic is all you need and it solves all the aforementioned problems. We still
leverage yaml based configuration with easy command line overrides, but this
time, we also pass the compiled configuration from hydra to pydantic for
validation and serialization during runtime.</p>
<section id="pydantic-schema">
<h3><a class="toc-backref" href="#id10" role="doc-backlink">Pydantic Schema</a><a class="headerlink" href="#pydantic-schema" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Type</span>

<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">Field</span><span class="p">,</span> <span class="n">field_validator</span>
<span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Annotated</span>


<span class="k">class</span> <span class="nc">TransformConfig</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">image_size</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">mean</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>
    <span class="n">std</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">ModelConfig</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">pretrained</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">in_chans</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>  <span class="c1"># in_channels must be greater than or equal to 1</span>
    <span class="n">num_classes</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>  <span class="c1"># num_classes must be greater than or equal to 1</span>
    <span class="n">global_pool</span><span class="p">:</span> <span class="nb">str</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;global_pool&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">validate_global_pool</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">ModelConfig</span><span class="p">],</span> <span class="n">global_pool</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validates global_pool is in [&quot;avg&quot;, &quot;max&quot;].&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">global_pool</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;avg&quot;</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;global_pool must be avg or max&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">global_pool</span>

    <span class="k">class</span> <span class="nc">Config</span><span class="p">:</span>
        <span class="n">protected_namespaces</span> <span class="o">=</span> <span class="p">()</span>


<span class="k">class</span> <span class="nc">StoresConfig</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">project_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">unique_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">logs_dir</span><span class="p">:</span> <span class="n">Path</span>
    <span class="n">model_artifacts_dir</span><span class="p">:</span> <span class="n">Path</span>

    <span class="k">class</span> <span class="nc">Config</span><span class="p">:</span>
        <span class="n">protected_namespaces</span> <span class="o">=</span> <span class="p">()</span>


<span class="k">class</span> <span class="nc">TrainConfig</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">device</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">project_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">num_epochs</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">num_classes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span>


<span class="k">class</span> <span class="nc">OptimizerConfig</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">optimizer_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">optimizer_params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">DataConfig</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">data_dir</span><span class="p">:</span> <span class="n">Path</span>
    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">num_workers</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">shuffle</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>


<span class="k">class</span> <span class="nc">Config</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">ModelConfig</span>
    <span class="n">transform</span><span class="p">:</span> <span class="n">TransformConfig</span>
    <span class="n">datamodule</span><span class="p">:</span> <span class="n">DataConfig</span>
    <span class="n">optimizer</span><span class="p">:</span> <span class="n">OptimizerConfig</span>
    <span class="n">stores</span><span class="p">:</span> <span class="n">StoresConfig</span>
    <span class="n">train</span><span class="p">:</span> <span class="n">TrainConfig</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Config</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates Config object from a dictionary.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">config_dict</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id1">
<h3><a class="toc-backref" href="#id11" role="doc-backlink">Pros</a><a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<ul>
<li><p>Able to serialize and deserialize objects to and from DICT, JSON, YAML, and
other formats. For example, the following code will serialize a <code class="docutils literal notranslate"><span class="pre">Dict</span></code>
object to Pydanticsâ€™ <code class="docutils literal notranslate"><span class="pre">Model</span></code> object. It can also convert back to <code class="docutils literal notranslate"><span class="pre">Dict</span></code>
object.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ModelConfig</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">pretrained</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">in_chans</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>  <span class="c1"># in_channels must be greater than or equal to 1</span>
    <span class="n">num_classes</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>  <span class="c1"># num_classes must be greater than or equal to 1</span>
    <span class="n">global_pool</span><span class="p">:</span> <span class="nb">str</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;global_pool&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">validate_global_pool</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">ModelConfig</span><span class="p">],</span> <span class="n">global_pool</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validates global_pool is in [&quot;avg&quot;, &quot;max&quot;].&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">global_pool</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;avg&quot;</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;global_pool must be avg or max&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">global_pool</span>

    <span class="k">class</span> <span class="nc">Config</span><span class="p">:</span>
        <span class="n">protected_namespaces</span> <span class="o">=</span> <span class="p">()</span>

<span class="n">model_config_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;model_name&quot;</span><span class="p">:</span> <span class="s2">&quot;resnet18&quot;</span><span class="p">,</span>
    <span class="s2">&quot;pretrained&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s2">&quot;in_chans&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s2">&quot;num_classes&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="s2">&quot;global_pool&quot;</span><span class="p">:</span> <span class="s2">&quot;avg&quot;</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="o">**</span><span class="n">model_config_dict</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">model</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span> <span class="o">==</span> <span class="n">model_config_dict</span>
</pre></div>
</div>
</li>
<li><p>Validation of data types and values. For a large and complex configuration,
you either validate the sanity of config at the config level, or check at
the code level (i.e. sprinkled throughout your codebase). -
<a class="reference external" href="https://pydantic-docs.helpmanual.io/usage/types/#constrained-types">Constrained types</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span>
    <span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;resnet18&quot;</span><span class="p">,</span>
    <span class="n">pretrained</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">in_chans</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">num_classes</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">global_pool</span><span class="o">=</span><span class="s2">&quot;avg&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>This will raise an error because <code class="docutils literal notranslate"><span class="pre">in_chans</span></code> is less than 1. Pydantic offers
a wide range of constrained types out of the box for you to use. If that is
not enough, then the custom validators can be used to validate the data with
custom needs.</p>
</li>
<li><p><a class="reference external" href="https://pydantic-docs.helpmanual.io/usage/validators/#custom-validators">Custom Validators</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span>
    <span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;resnet18&quot;</span><span class="p">,</span>
    <span class="n">pretrained</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">in_chans</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">num_classes</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">global_pool</span><span class="o">=</span><span class="s2">&quot;average&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>This will raise an error because <code class="docutils literal notranslate"><span class="pre">global_pool</span></code> is not <code class="docutils literal notranslate"><span class="pre">avg</span></code> or <code class="docutils literal notranslate"><span class="pre">max</span></code>. We
implemented this custom checks in the <code class="docutils literal notranslate"><span class="pre">validate_global_pool</span></code> method where we
decorated it with <code class="docutils literal notranslate"><span class="pre">&#64;field_validator(&quot;global_pool&quot;)</span></code>.</p>
</li>
</ul>
<p>There are many other good things like in-built type checking, and coercion. In
the next section we see how we combine Hydra and Pydantic together.</p>
</section>
</section>
<section id="pydra">
<h2><a class="toc-backref" href="#id12" role="doc-backlink">Pydra</a><a class="headerlink" href="#pydra" title="Link to this heading">#</a></h2>
<p>The provided code shows a way to merge Hydra and Pydantic in a machine learning
training pipeline, using Hydra for hierarchical configuration and command-line
interface, and Pydantic for data validation and type checking.</p>
<p>A Hydra-based application entry point is created using the <code class="docutils literal notranslate"><span class="pre">&#64;hydra.main()</span></code>
decorator. This will use the Hydra library to manage configuration files and
command-line arguments. Hydraâ€™s <code class="docutils literal notranslate"><span class="pre">config_path</span></code> and <code class="docutils literal notranslate"><span class="pre">config_name</span></code> are specified to
tell Hydra where to find the configuration files.</p>
<p>This <code class="docutils literal notranslate"><span class="pre">hydra_to_pydantic</span></code> will take in a <code class="docutils literal notranslate"><span class="pre">hydra</span></code>â€™s <code class="docutils literal notranslate"><span class="pre">DictConfig</span></code> and convert it to
a pydanticâ€™s <code class="docutils literal notranslate"><span class="pre">Config</span></code> object.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span>

<span class="kn">import</span> <span class="nn">hydra</span>
<span class="kn">from</span> <span class="nn">hydra.core.hydra_config</span> <span class="kn">import</span> <span class="n">HydraConfig</span>
<span class="kn">from</span> <span class="nn">omegaconf</span> <span class="kn">import</span> <span class="n">DictConfig</span><span class="p">,</span> <span class="n">OmegaConf</span>
<span class="kn">from</span> <span class="nn">rich.pretty</span> <span class="kn">import</span> <span class="n">pprint</span>

<span class="kn">from</span> <span class="nn">omnixamples.software_engineering.config_management.pydantic.config</span> <span class="kn">import</span> <span class="n">Config</span>
<span class="kn">from</span> <span class="nn">omnixamples.software_engineering.config_management.train</span> <span class="kn">import</span> <span class="n">train</span>

<span class="n">LOGGER</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">hydra_to_pydantic</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="n">DictConfig</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Config</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts Hydra config to Pydantic config.&quot;&quot;&quot;</span>
    <span class="c1"># use to_container to resolve</span>
    <span class="n">config_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">OmegaConf</span><span class="o">.</span><span class="n">to_object</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>  <span class="c1"># type: ignore[assignment]</span>
    <span class="k">return</span> <span class="n">Config</span><span class="p">(</span><span class="o">**</span><span class="n">config_dict</span><span class="p">)</span>


<span class="nd">@hydra</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">version_base</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">config_path</span><span class="o">=</span><span class="s2">&quot;../hydra/configs&quot;</span><span class="p">,</span> <span class="n">config_name</span><span class="o">=</span><span class="s2">&quot;config&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="n">DictConfig</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run the main function.&quot;&quot;&quot;</span>
    <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Type of config is: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">config</span><span class="p">))</span>
    <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Merged Yaml:</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">OmegaConf</span><span class="o">.</span><span class="n">to_yaml</span><span class="p">(</span><span class="n">config</span><span class="p">))</span>
    <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">HydraConfig</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">job</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="n">config_pydantic</span> <span class="o">=</span> <span class="n">hydra_to_pydantic</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
    <span class="n">pprint</span><span class="p">(</span><span class="n">config_pydantic</span><span class="p">)</span>
    <span class="n">train</span><span class="p">(</span><span class="n">config_pydantic</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="references-and-further-readings">
<h2><a class="toc-backref" href="#id13" role="doc-backlink">References and Further Readings</a><a class="headerlink" href="#references-and-further-readings" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://hydra.cc/">Hydra</a></p></li>
<li><p><a class="reference external" href="https://pydantic-docs.helpmanual.io/">Pydantic</a></p></li>
<li><p><a class="reference external" href="https://suneeta-mall.github.io/2022/03/15/hydra-pydantic-config-management-for-training-application.html">Pydra - Pydantic and Hydra for configuration management of model training experiments</a></p></li>
<li><p><a class="reference external" href="https://github.com/suneeta-mall/hydra_pydantic_config_management/tree/master">hydra_pydantic_config_management</a></p></li>
<li><p><a class="reference external" href="https://github.com/gao-hongnan/pytorch-lightning-pipeline/tree/main">PyTorch Lightning Pipeline</a></p></li>
<li><p><a class="reference external" href="https://martinfowler.com/articles/injection.html">Inversion of Control Containers and the Dependency Injection pattern</a></p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./software_engineering/config_management"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="concept.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Configuration Management</p>
      </div>
    </a>
    <a class="right-next"
       href="02-state.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">State And Metadata Management</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#hydra">Hydra</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#yaml-driven-configuration">YAML Driven Configuration</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pros">Pros</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#structured-config">Structured Config</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cons">Cons</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#instantiating">Instantiating</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#composition-order">Composition Order</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pydantic">Pydantic</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pydantic-schema">Pydantic Schema</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Pros</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pydra">Pydra</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references-and-further-readings">References and Further Readings</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Gao Hongnan
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      Â© Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>