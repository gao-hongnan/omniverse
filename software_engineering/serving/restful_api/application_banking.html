
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Application: Designing a RESTful Banking API with FastAPI and SQLAlchemy &#8212; Omniverse</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../../_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/tabs.css?v=4c969af8" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css?v=bb35926c" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script src="../../../_static/tabs.js?v=3ee01567"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-MYW5YKC2WF"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-MYW5YKC2WF');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-MYW5YKC2WF');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'software_engineering/serving/restful_api/application_banking';</script>
    <link rel="canonical" href="https://www.gaohongnan.com/software_engineering/serving/restful_api/application_banking.html" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Type Theory, A Very Rudimentary Introduction" href="../../../computer_science/type_theory/intro.html" />
    <link rel="prev" title="RESTful API" href="intro.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/logo.png" class="logo__image only-light" alt="Omniverse - Home"/>
    <script>document.write(`<img src="../../../_static/logo.png" class="logo__image only-dark" alt="Omniverse - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../intro.html">
                    🌌 Omniverse: A Journey Through Knowledge
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Notations</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../notations/machine_learning.html">Machine Learning Notations</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Influential Ideas and Papers</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../influential/generative_pretrained_transformer/01_intro.html">Generative Pre-trained Transformers</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../influential/generative_pretrained_transformer/02_notations.html">Notations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../influential/generative_pretrained_transformer/03_concept.html">The Concept of Generative Pre-trained Transformers (GPT)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../influential/generative_pretrained_transformer/04_implementation.html">The Implementation of Generative Pre-trained Transformers (GPT)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../influential/generative_pretrained_transformer/05_adder.html">Training a Mini-GPT to Learn Two-Digit Addition</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../influential/low_rank_adaptation/01_intro.html">Low-Rank Adaptation Of Large Language Models</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../influential/low_rank_adaptation/02_concept.html">Concept</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../influential/low_rank_adaptation/03_implementation.html">Implementation</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../influential/kmeans_clustering/01_intro.html">K-Means</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../influential/kmeans_clustering/02_concept.html">Concept: K-Means Clustering</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../influential/kmeans_clustering/03_implementation.html">Implementation: K-Means (Lloyd)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../influential/kmeans_clustering/04_image_segmentation.html">Application: Image Compression and Segmentation</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Playbook</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../playbook/how_to_calculate_flops_in_transformer_based_models.html">How to Calculate the Number of FLOPs in Transformer Based Models?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../playbook/how_to_inspect_function_and_class_signatures.html">How to Inspect Function and Class Signatures in Python?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../playbook/why_cosine_annealing_warmup_stabilize_training.html">Why Does Cosine Annealing With Warmup Stabilize Training?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../playbook/why_softmax_preserves_order_translation_invariant_not_invariant_scaling.html">Softmax Preserves Order, Is Translation Invariant But Not Invariant Under Scaling.</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../playbook/how_to_finetune_decoder_with_last_token_pooling.html">How To Fine-Tune Decoder-Only Models For Sequence Classification Using Last Token Pooling?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../playbook/how_to_finetune_decoder_with_cross_attention.html">How To Fine-Tune Decoder-Only Models For Sequence Classification With Cross-Attention?</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Operations</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../operations/machine_learning_lifecycle/00_intro.html">The Lifecycle of an AIOps System</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../operations/machine_learning_lifecycle/01_problem_formulation.html">Stage 1. Problem Formulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../operations/machine_learning_lifecycle/02_project_scoping.html">Stage 2. Project Scoping And Framing The Problem</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../operations/machine_learning_lifecycle/03_dataops_pipeline/03_dataops_pipeline.html">Stage 3. Data Pipeline (Data Engineering and DataOps)</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../operations/machine_learning_lifecycle/03_dataops_pipeline/031_data_source_and_format.html">Stage 3.1. Data Source and Formats</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../operations/machine_learning_lifecycle/03_dataops_pipeline/032_data_model_and_storage.html">Stage 3.2. Data Model and Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../operations/machine_learning_lifecycle/03_dataops_pipeline/033_etl.html">Stage 3.3. Extract, Transform, Load (ETL)</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../../../operations/machine_learning_lifecycle/04_mlops_data_pipeline.html">Stage 4. Data Extraction (MLOps), Data Analysis (Data Science), Data Preparation (Data Science)</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../operations/machine_learning_lifecycle/05_model_development_selection_and_training/05_ml_training_pipeline.html">Stage 5. Model Development and Training (MLOps)</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../operations/machine_learning_lifecycle/05_model_development_selection_and_training/051_model_selection.html">Stage 5.1. Model Selection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../operations/machine_learning_lifecycle/05_model_development_selection_and_training/052_metric_selection.html">Stage 5.2. Metric Selection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../operations/machine_learning_lifecycle/05_model_development_selection_and_training/053_experiment_tracking.html">Stage 5.3. Experiment Tracking And Versioning</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../operations/machine_learning_lifecycle/05_model_development_selection_and_training/054_model_testing.html">Stage 5.4. Model Testing</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../operations/distributed/intro.html">Distributed Systems</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../operations/distributed/01_notations.html">Notations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../operations/distributed/02_basics.html">Basics Of Distributed Data Parallelism</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../operations/distributed/03_how_to_setup_slurm_in_aws.html">How to Setup SLURM and ParallelCluster in AWS</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Software Engineering</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../config_management/concept.html">Configuration Management</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../config_management/01-pydra.html">Pydantic And Hydra</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../config_management/02-state.html">State And Metadata Management</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../devops/continuous-integration/concept.html">Continuous Integration (CI) Workflow</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../devops/continuous-integration/styling.html">Styling, Formatting, and Linting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../devops/continuous-integration/testing.html">Testing</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../design_patterns/dependency-inversion-principle.html">Dependency Inversion Principle</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../concurrency_parallelism_asynchronous/intro.html">Concurrency, Parallelism and Asynchronous Programming</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../concurrency_parallelism_asynchronous/generator_yield.html">A Rudimentary Introduction to Generator and Yield in Python</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="intro.html">RESTful API</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Application: Designing a RESTful Banking API with FastAPI and SQLAlchemy</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Computer Science</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../computer_science/type_theory/intro.html">Type Theory, A Very Rudimentary Introduction</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../computer_science/type_theory/01-subtypes.html">Subtypes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../computer_science/type_theory/02-type-safety.html">Type Safety</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../computer_science/type_theory/03-subsumption.html">Subsumption</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../computer_science/type_theory/04-generics.html">Generics and Type Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../computer_science/type_theory/05-typevar-bound-constraints.html">Bound and Constraint in Generics and Type Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../computer_science/type_theory/06-invariance-covariance-contravariance.html">Invariance, Covariance and Contravariance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../computer_science/type_theory/07-pep-3124-overloading.html">Function Overloading</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../computer_science/type_theory/08-pep-661-sentinel-values.html">Sentinel Types</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Data Structures and Algorithms</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../dsa/complexity_analysis/intro.html">Complexity Analysis</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../dsa/complexity_analysis/master_theorem.html">Master Theorem </a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../dsa/stack/intro.html">Stack</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../dsa/stack/concept.html">Concept</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../dsa/searching_algorithms/linear_search/intro.html">Linear Search</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../dsa/searching_algorithms/linear_search/concept.html">Concept</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../dsa/searching_algorithms/binary_search/intro.html">Binary Search</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../dsa/searching_algorithms/binary_search/concept.html">Concept</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dsa/searching_algorithms/binary_search/problems/875-koko-eating-bananas.html">Koko Eating Bananas</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Linear Algebra</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../linear_algebra/01_preliminaries/intro.html">Preliminaries</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../linear_algebra/01_preliminaries/01-fields.html">Fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../linear_algebra/01_preliminaries/02-systems-of-linear-equations.html">Systems of Linear Equations</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../linear_algebra/02_vectors/intro.html">Vectors</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../linear_algebra/02_vectors/01-vector-definition.html">Vector and Its Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../linear_algebra/02_vectors/02-vector-operation.html">Vector and Its Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../linear_algebra/02_vectors/03-vector-norm.html">Vector Norm and Distance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../linear_algebra/02_vectors/04-vector-products.html">A First Look at Vector Products</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">References, Resources and Roadmap</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../bibliography.html">Bibliography</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../citations.html">IEEE (Style) Citations</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../api/reproducibility.html">API Reference</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/gao-hongnan/omniverse" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/gao-hongnan/omniverse/issues/new?title=Issue%20on%20page%20%2Fsoftware_engineering/serving/restful_api/application_banking.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/software_engineering/serving/restful_api/application_banking.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Application: Designing a RESTful Banking API with FastAPI and SQLAlchemy</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#problem-statement">Problem Statement</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#models">Models</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#account-model">Account Model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-primary-key-is-automatically-incremented">The Primary Key is Automatically Incremented</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#transaction-model">Transaction Model</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#populate-the-database">Populate the Database</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#querying-the-database">Querying the Database</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-engine-session-and-base">The Engine, Session, and Base</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-relationship-defined-in-sqlalchemy">What is relationship defined in SQLAlchemy?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#session-vs-sessionlocal">Session vs. SessionLocal</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#object-relational-mapping-orm">Object-Relational Mapping (ORM)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#definition-and-intuition">Definition and Intuition</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analogy">Analogy</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example">Example</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-role-of-base-in-sqlalchemy-s-orm-system">The Role of Base in SQLAlchemy’s ORM System</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#moving-on-from-data-models-to-restful-api-endpoints">Moving on from Data (Models) to RESTful API (Endpoints)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#endpoints">Endpoints</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#running-the-fastapi-application">Running the FastAPI Application</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-s-async">What’s Async?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#request">Request</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#intuition">Intuition</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#uri">URI</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#http-methods">HTTP Methods</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#get-read">GET (Read)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#post-create">POST (Create)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#put-update">PUT (Update)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#delete-delete">DELETE (Delete)</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#headers">Headers</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#authorization-authentication">Authorization/Authentication</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#body">Body</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#response">Response</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#filter">Filter</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#model-view-controller-mvc">Model-View-Controller (MVC)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#understanding-the-model-view-controller-mvc-framework">Understanding the Model-View-Controller (MVC) Framework</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#database-session-management">Database Session Management</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#the-engine">1. The Engine</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#session-factory">2. Session Factory</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#dependency-to-get-a-session">3. Dependency to get a Session</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#singleton-pattern">Singleton Pattern</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Models</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#sqlalchemy-models">SQLAlchemy Models</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#relationships-in-sqlalchemy">Relationships in SQLAlchemy</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#views-or-controllers">Views (or Controllers)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#endpoints-or-route-functions">Endpoints (or Route Functions)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apirouter">APIRouter</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#response-model-and-depends">Response Model and Depends</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references-and-further-readings">References and Further Readings</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="application-designing-a-restful-banking-api-with-fastapi-and-sqlalchemy">
<h1>Application: Designing a RESTful Banking API with FastAPI and SQLAlchemy<a class="headerlink" href="#application-designing-a-restful-banking-api-with-fastapi-and-sqlalchemy" title="Link to this heading">#</a></h1>
<p><a class="reference external" href="https://twitter.com/gaohongnan"><img alt="Twitter Handle" src="https://img.shields.io/badge/Twitter-&#64;gaohongnan-blue?style=social&amp;logo=twitter" /></a>
<a class="reference external" href="https://linkedin.com/in/gao-hongnan"><img alt="LinkedIn Profile" src="https://img.shields.io/badge/&#64;gaohongnan-blue?style=social&amp;logo=linkedin" /></a></p>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#introduction" id="id2">Introduction</a></p></li>
<li><p><a class="reference internal" href="#problem-statement" id="id3">Problem Statement</a></p></li>
<li><p><a class="reference internal" href="#models" id="id4">Models</a></p>
<ul>
<li><p><a class="reference internal" href="#account-model" id="id5">Account Model</a></p></li>
<li><p><a class="reference internal" href="#the-primary-key-is-automatically-incremented" id="id6">The Primary Key is Automatically Incremented</a></p></li>
<li><p><a class="reference internal" href="#transaction-model" id="id7">Transaction Model</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#populate-the-database" id="id8">Populate the Database</a></p></li>
<li><p><a class="reference internal" href="#querying-the-database" id="id9">Querying the Database</a></p></li>
<li><p><a class="reference internal" href="#the-engine-session-and-base" id="id10">The Engine, Session, and Base</a></p></li>
<li><p><a class="reference internal" href="#what-is-relationship-defined-in-sqlalchemy" id="id11">What is relationship defined in SQLAlchemy?</a></p></li>
<li><p><a class="reference internal" href="#session-vs-sessionlocal" id="id12">Session vs. SessionLocal</a></p></li>
<li><p><a class="reference internal" href="#object-relational-mapping-orm" id="id13">Object-Relational Mapping (ORM)</a></p>
<ul>
<li><p><a class="reference internal" href="#definition-and-intuition" id="id14">Definition and Intuition</a></p></li>
<li><p><a class="reference internal" href="#analogy" id="id15">Analogy</a></p></li>
<li><p><a class="reference internal" href="#example" id="id16">Example</a></p></li>
<li><p><a class="reference internal" href="#the-role-of-base-in-sqlalchemy-s-orm-system" id="id17">The Role of Base in SQLAlchemy’s ORM System</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#moving-on-from-data-models-to-restful-api-endpoints" id="id18">Moving on from Data (Models) to RESTful API (Endpoints)</a></p></li>
<li><p><a class="reference internal" href="#endpoints" id="id19">Endpoints</a></p>
<ul>
<li><p><a class="reference internal" href="#running-the-fastapi-application" id="id20">Running the FastAPI Application</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#what-s-async" id="id21">What’s Async?</a></p></li>
<li><p><a class="reference internal" href="#request" id="id22">Request</a></p>
<ul>
<li><p><a class="reference internal" href="#intuition" id="id23">Intuition</a></p></li>
<li><p><a class="reference internal" href="#uri" id="id24">URI</a></p></li>
<li><p><a class="reference internal" href="#http-methods" id="id25">HTTP Methods</a></p>
<ul>
<li><p><a class="reference internal" href="#get-read" id="id26">GET (Read)</a></p></li>
<li><p><a class="reference internal" href="#post-create" id="id27">POST (Create)</a></p></li>
<li><p><a class="reference internal" href="#put-update" id="id28">PUT (Update)</a></p></li>
<li><p><a class="reference internal" href="#delete-delete" id="id29">DELETE (Delete)</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#headers" id="id30">Headers</a></p>
<ul>
<li><p><a class="reference internal" href="#authorization-authentication" id="id31">Authorization/Authentication</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#body" id="id32">Body</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#response" id="id33">Response</a></p></li>
<li><p><a class="reference internal" href="#filter" id="id34">Filter</a></p></li>
<li><p><a class="reference internal" href="#model-view-controller-mvc" id="id35">Model-View-Controller (MVC)</a></p>
<ul>
<li><p><a class="reference internal" href="#understanding-the-model-view-controller-mvc-framework" id="id36">Understanding the Model-View-Controller (MVC) Framework</a></p></li>
<li><p><a class="reference internal" href="#database-session-management" id="id37">Database Session Management</a></p>
<ul>
<li><p><a class="reference internal" href="#the-engine" id="id38">1. The Engine</a></p></li>
<li><p><a class="reference internal" href="#session-factory" id="id39">2. Session Factory</a></p></li>
<li><p><a class="reference internal" href="#dependency-to-get-a-session" id="id40">3. Dependency to get a Session</a></p></li>
<li><p><a class="reference internal" href="#singleton-pattern" id="id41">Singleton Pattern</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id1" id="id42">Models</a></p>
<ul>
<li><p><a class="reference internal" href="#sqlalchemy-models" id="id43">SQLAlchemy Models</a></p></li>
<li><p><a class="reference internal" href="#relationships-in-sqlalchemy" id="id44">Relationships in SQLAlchemy</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#views-or-controllers" id="id45">Views (or Controllers)</a></p>
<ul>
<li><p><a class="reference internal" href="#endpoints-or-route-functions" id="id46">Endpoints (or Route Functions)</a></p></li>
<li><p><a class="reference internal" href="#apirouter" id="id47">APIRouter</a></p></li>
<li><p><a class="reference internal" href="#response-model-and-depends" id="id48">Response Model and Depends</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#references-and-further-readings" id="id49">References and Further Readings</a></p></li>
</ul>
</nav>
<section id="introduction">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Introduction</a><a class="headerlink" href="#introduction" title="Link to this heading">#</a></h2>
<p>In the rapidly evolving landscape of technology, the demand for efficient,
reliable, and scalable solutions is ever increasing. The banking sector, being
one of the most critical parts of the economy, is no exception to this trend.
The days of traditional banking, characterized by long queues and time-consuming
processes, are quickly being replaced by digital solutions that offer
convenience, speed, and broad accessibility. This digital transformation has
necessitated the development of robust and reliable banking systems that can
handle a wide range of operations, from account management to complex
transactions.</p>
<p>One of the key components of a modern banking system is an
<a class="reference external" href="https://en.wikipedia.org/wiki/API"><strong>Application Programming Interface (API)</strong></a>,
which serves as the backbone for enabling internal and external communication
and integration. In this context, Python’s
<a class="reference external" href="https://fastapi.tiangolo.com/"><strong>FastAPI</strong></a> framework has emerged as a popular
choice for creating RESTful APIs, thanks to its simplicity, speed, and
scalability.</p>
</section>
<section id="problem-statement">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Problem Statement</a><a class="headerlink" href="#problem-statement" title="Link to this heading">#</a></h2>
<p>Modern banking systems require robust and secure APIs to manage accounts and
facilitate various transactions. These APIs need to handle a variety of
operations, ranging from account creation to complex transactions such as
deposits, withdrawals, and transfers between accounts. Each of these operations
involves specific requests and responses that must be accurately processed to
ensure reliable functionality and data integrity.</p>
<p>In our simplified banking API system, we need to design and implement the
following operations:</p>
<ol class="arabic simple">
<li><p><strong>Account Creation</strong>: A request to create a new account should include
necessary information such as the account holder’s name and email. The
response should confirm successful account creation and return the details of
the created account, including a unique account ID.</p></li>
<li><p><strong>Account Retrieval</strong>: A request to retrieve an account should include the
unique account ID. The response should return the details of the requested
account, or an error if no such account exists.</p></li>
<li><p><strong>Account Update</strong>: A request to update an account should include the unique
account ID and the new data. The response should confirm successful account
update and return the details of the updated account, or an error if no such
account exists.</p></li>
<li><p><strong>Account Deletion</strong>: A request to delete an account should include the
unique account ID. The response should confirm successful account deletion,
or an error if no such account exists.</p></li>
<li><p><strong>Deposit</strong>: A request to deposit money should include the account ID and the
amount to be deposited. The response should confirm the successful deposit
and return the details of the transaction.</p></li>
<li><p><strong>Withdrawal</strong>: A request to withdraw money should include the account ID and
the amount to be withdrawn. The response should confirm the successful
withdrawal and return the details of the transaction, or an error if the
account has insufficient funds.</p></li>
<li><p><strong>Transfer</strong>: A request to transfer money should include the source account
ID, the destination account ID, and the amount to be transferred. The
response should confirm the successful transfer and return the details of the
transaction, or an error if the source account has insufficient funds or if
either account does not exist.</p></li>
</ol>
</section>
<section id="models">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Models</a><a class="headerlink" href="#models" title="Link to this heading">#</a></h2>
<p>In the context of designing a RESTful API using FastAPI and SQLAlchemy, models
refer to Python classes that represent the database entities (or tables) in our
system. These models will serve as an abstraction layer for interacting with the
database. They define the schema of the tables, the data types of each column,
and any constraints such as primary and foreign keys.</p>
<p>FastAPI uses Pydantic models to validate incoming data, while SQLAlchemy models
represent the database schema and enable interaction with the database. In the
context of our banking system, we have two models: <code class="docutils literal notranslate"><span class="pre">Account</span></code> and <code class="docutils literal notranslate"><span class="pre">Transaction</span></code>.</p>
<ol class="arabic simple">
<li><p><strong>Account</strong>: This model represents a bank account. It might include fields
like <code class="docutils literal notranslate"><span class="pre">id</span></code> (a unique identifier for each account), <code class="docutils literal notranslate"><span class="pre">name</span></code> (the account
holder’s name), <code class="docutils literal notranslate"><span class="pre">email</span></code> (the account holder’s email), and <code class="docutils literal notranslate"><span class="pre">balance</span></code> (the
current balance of the account).</p></li>
<li><p><strong>Transaction</strong>: This model represents a transaction that can occur on an
account. It might include fields like <code class="docutils literal notranslate"><span class="pre">id</span></code> (a unique identifier for each
transaction), <code class="docutils literal notranslate"><span class="pre">account_id</span></code> (a foreign key that links the transaction to an
account), <code class="docutils literal notranslate"><span class="pre">amount</span></code> (the amount of money involved in the transaction), <code class="docutils literal notranslate"><span class="pre">type</span></code>
(the type of transaction, such as deposit, withdrawal, or transfer), and
<code class="docutils literal notranslate"><span class="pre">timestamp</span></code> (the date and time when the transaction occurred).</p></li>
</ol>
<p>In our application, we’re using SQLAlchemy, an Object-Relational Mapping (ORM)
library for Python, to define these models. With SQLAlchemy, each model is
represented as a Python class, and instances of these classes can be directly
mapped to rows in a database table. This allows us to interact with our database
in a more Pythonic and intuitive way, as we can work with objects and classes
instead of writing raw SQL queries.</p>
<section id="account-model">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">Account Model</a><a class="headerlink" href="#account-model" title="Link to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">Account</span></code> model represents a bank account. It has four fields: <code class="docutils literal notranslate"><span class="pre">id</span></code>, <code class="docutils literal notranslate"><span class="pre">name</span></code>,
<code class="docutils literal notranslate"><span class="pre">email</span></code>, and <code class="docutils literal notranslate"><span class="pre">balance</span></code>, along with a <code class="docutils literal notranslate"><span class="pre">transactions</span></code> relationship field. The
schema is represented in table format below:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Constraint</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>id</p></td>
<td><p>Integer</p></td>
<td><p>Primary Key, Indexed</p></td>
</tr>
<tr class="row-odd"><td><p>name</p></td>
<td><p>String</p></td>
<td><p>Indexed</p></td>
</tr>
<tr class="row-even"><td><p>email</p></td>
<td><p>String</p></td>
<td><p>Unique, Indexed</p></td>
</tr>
<tr class="row-odd"><td><p>balance</p></td>
<td><p>Float</p></td>
<td><p>Default = 0.0</p></td>
</tr>
<tr class="row-even"><td><p>transactions</p></td>
<td><p>Relation</p></td>
<td><p>-</p></td>
</tr>
</tbody>
</table>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">id</span></code>: This field is the primary key, meaning it uniquely identifies each
record. In a relational database, every table must have a primary key. The
<code class="docutils literal notranslate"><span class="pre">index=True</span></code> option improves lookup performance when querying on that field.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code>: This field is indexed, meaning it’s optimized for searching. The
<code class="docutils literal notranslate"><span class="pre">index=True</span></code> option improves lookup performance when querying on that field.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">email</span></code>: This field is unique, ensuring no two accounts have the same email.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">balance</span></code>: This field has a default value of <code class="docutils literal notranslate"><span class="pre">0.0</span></code>, meaning if no value is
provided, the account’s balance will be set to <code class="docutils literal notranslate"><span class="pre">0.0</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">transactions</span></code>: This is a relationship field which provides access to all
related <code class="docutils literal notranslate"><span class="pre">Transaction</span></code> records. It doesn’t map to a specific column in the
database, but rather is a collection of <code class="docutils literal notranslate"><span class="pre">Transaction</span></code> instances associated
with an <code class="docutils literal notranslate"><span class="pre">Account</span></code>. For example, you can access the transactions for a
specific account using <code class="docutils literal notranslate"><span class="pre">account.transactions</span></code>.</p></li>
</ul>
<p>We define the corresponding <code class="docutils literal notranslate"><span class="pre">Account</span></code> model in Python using SQLAlchemy.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Account</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;accounts&quot;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">balance</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">transactions</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Transaction&quot;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s2">&quot;account&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="the-primary-key-is-automatically-incremented">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">The Primary Key is Automatically Incremented</a><a class="headerlink" href="#the-primary-key-is-automatically-incremented" title="Link to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">id</span></code> field in our <code class="docutils literal notranslate"><span class="pre">Account</span></code> model is automatically managed by SQLAlchemy and
our underlying database system.</p>
<p>When you define a table in SQLAlchemy and specify a primary key field with
<code class="docutils literal notranslate"><span class="pre">primary_key=True</span></code>, the underlying database system is set to automatically
generate a unique value for this field every time a new record is inserted. This
behavior is known as “auto-increment”.</p>
<p>In our <code class="docutils literal notranslate"><span class="pre">Account</span></code> model, you’ve specified
<code class="docutils literal notranslate"><span class="pre">id</span> <span class="pre">=</span> <span class="pre">Column(Integer,</span> <span class="pre">primary_key=True,</span> <span class="pre">index=True)</span></code>, which means that <code class="docutils literal notranslate"><span class="pre">id</span></code> is a
primary key and will auto-increment for each new account you add. When you
create a new <code class="docutils literal notranslate"><span class="pre">Account</span></code> instance and add it to the session, SQLAlchemy knows not
to include the <code class="docutils literal notranslate"><span class="pre">id</span></code> in the INSERT statement because it will be automatically
generated by the database.</p>
<p>As a result, when you commit the session after adding an account, the database
generates a unique <code class="docutils literal notranslate"><span class="pre">id</span></code> for that account and SQLAlchemy fetches and assigns that
<code class="docutils literal notranslate"><span class="pre">id</span></code> back to the <code class="docutils literal notranslate"><span class="pre">id</span></code> attribute of the <code class="docutils literal notranslate"><span class="pre">Account</span></code> instance in our Python code.</p>
<p>This is why you don’t need to manually add an <code class="docutils literal notranslate"><span class="pre">id</span></code> when creating a new
<code class="docutils literal notranslate"><span class="pre">Account</span></code>. The <code class="docutils literal notranslate"><span class="pre">id</span></code> field is automatically handled by SQLAlchemy and our
database, allowing you to focus on the other fields of our model.</p>
<p>We will see it in action later when we create a new account.</p>
</section>
<section id="transaction-model">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">Transaction Model</a><a class="headerlink" href="#transaction-model" title="Link to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">Transaction</span></code> model represents a financial transaction related to an
account. It has five fields: <code class="docutils literal notranslate"><span class="pre">id</span></code>, <code class="docutils literal notranslate"><span class="pre">account_id</span></code>, <code class="docutils literal notranslate"><span class="pre">amount</span></code>, <code class="docutils literal notranslate"><span class="pre">type</span></code>, <code class="docutils literal notranslate"><span class="pre">timestamp</span></code>,
and a <code class="docutils literal notranslate"><span class="pre">account</span></code> relationship field. The schema is represented in table format
below:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Constraint</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>id</p></td>
<td><p>Integer</p></td>
<td><p>Primary Key, Indexed</p></td>
</tr>
<tr class="row-odd"><td><p>account_id</p></td>
<td><p>Integer</p></td>
<td><p>Foreign Key</p></td>
</tr>
<tr class="row-even"><td><p>amount</p></td>
<td><p>Float</p></td>
<td><p>-</p></td>
</tr>
<tr class="row-odd"><td><p>type</p></td>
<td><p>String</p></td>
<td><p>-</p></td>
</tr>
<tr class="row-even"><td><p>timestamp</p></td>
<td><p>DateTime</p></td>
<td><p>-</p></td>
</tr>
<tr class="row-odd"><td><p>account</p></td>
<td><p>Relation</p></td>
<td><p>-</p></td>
</tr>
</tbody>
</table>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">id</span></code>: This field is the primary key, uniquely identifying each transaction
record.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">account_id</span></code>: This field is a foreign key linking the transaction to its
associated account.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">amount</span></code>: This field stores the amount involved in the transaction.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">type</span></code>: This field indicates the type of the transaction (e.g., “deposit”,
“withdrawal”, or “transfer”).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">timestamp</span></code>: This field records the date and time when the transaction took
place.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">account</span></code>: This is a relationship field that provides access to the
<code class="docutils literal notranslate"><span class="pre">Account</span></code> associated with the transaction.</p></li>
</ul>
<p>We define the corresponding <code class="docutils literal notranslate"><span class="pre">Transaction</span></code> model in Python using SQLAlchemy.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Transaction</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;transactions&quot;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">account_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;accounts.id&#39;</span><span class="p">))</span>
    <span class="n">amount</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Float</span><span class="p">)</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>
    <span class="n">timestamp</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">DateTime</span><span class="p">)</span>
    <span class="n">account</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Account&quot;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s2">&quot;transactions&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>To this end, the <code class="docutils literal notranslate"><span class="pre">Account</span></code> and <code class="docutils literal notranslate"><span class="pre">Transaction</span></code> models define the schema for the
<code class="docutils literal notranslate"><span class="pre">accounts</span></code> and <code class="docutils literal notranslate"><span class="pre">transactions</span></code> tables, respectively, in our relational database.</p>
</section>
</section>
<section id="populate-the-database">
<h2><a class="toc-backref" href="#id8" role="doc-backlink">Populate the Database</a><a class="headerlink" href="#populate-the-database" title="Link to this heading">#</a></h2>
<p>Now that we’ve set up our database models, we need to populate our database with
data. Populating the database with dummy data allows us to test our application
under more realistic conditions, even before we have actual user data. It helps
us to validate our database schema, relationships, and queries. For this
purpose, we’ll use Python’s <code class="docutils literal notranslate"><span class="pre">Faker</span></code> library to generate realistic dummy data for
our <code class="docutils literal notranslate"><span class="pre">accounts</span></code> and <code class="docutils literal notranslate"><span class="pre">transactions</span></code> tables.</p>
<p>To automate this process, we have created a script that generates a specified
number of accounts and transactions, then inserts this data into the database.
This script can be run independently or as part of a larger task (like an
application startup script), and is modular enough to be modified or extended as
necessary.</p>
<p>Here is the script that we will use to seed our database:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get the directory of the current script</span>
<span class="n">CURRENT_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)))</span>

<span class="c1"># Construct the path to the database file</span>
<span class="n">DATABASE_URL</span> <span class="o">=</span> <span class="n">CURRENT_DIR</span> <span class="o">/</span> <span class="s2">&quot;database.db&quot;</span>

<span class="c1"># Set up database URL as an environment variable for better flexibility</span>
<span class="n">SQLALCHEMY_DATABASE_URL</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;DATABASE_URL&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;sqlite:///</span><span class="si">{</span><span class="n">DATABASE_URL</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="n">SQLALCHEMY_DATABASE_URL</span><span class="p">)</span>
<span class="n">SessionLocal</span> <span class="o">=</span> <span class="n">sessionmaker</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>

<span class="n">fake</span> <span class="o">=</span> <span class="n">Faker</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">create_fake_account</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Account</span><span class="p">:</span>
    <span class="o">...</span>
<span class="k">def</span> <span class="nf">create_fake_transaction</span><span class="p">(</span><span class="n">account_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Transaction</span><span class="p">:</span>
    <span class="o">...</span>
<span class="k">def</span> <span class="nf">seed_database</span><span class="p">(</span><span class="n">num_accounts</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">min_transactions</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">max_transactions</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="o">...</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">seed_database</span><span class="p">()</span>
</pre></div>
</div>
<p>This script starts by setting up a connection to our database using SQLAlchemy.
We then define helper functions to create fake <code class="docutils literal notranslate"><span class="pre">Account</span></code> and <code class="docutils literal notranslate"><span class="pre">Transaction</span></code>
instances. The <code class="docutils literal notranslate"><span class="pre">seed_database</span></code> function creates a number of accounts and random
transactions for each account, and then commits these to the database. We wrap
the entire process in a transaction so that we can roll back if any errors
occur. This helps to keep our database in a consistent state even when errors
occur.</p>
<p>To run the script, simply execute the Python file. You can adjust the number of
accounts and transactions created by changing the parameters of the
<code class="docutils literal notranslate"><span class="pre">seed_database</span></code> function call in the <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">__name__</span> <span class="pre">==</span> <span class="pre">&quot;__main__&quot;</span></code> block.</p>
</section>
<section id="querying-the-database">
<h2><a class="toc-backref" href="#id9" role="doc-backlink">Querying the Database</a><a class="headerlink" href="#querying-the-database" title="Link to this heading">#</a></h2>
<p>Now that we’ve populated our database with dummy data, we can start querying it:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get the directory of the current script</span>
<span class="n">CURRENT_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)))</span>

<span class="c1"># Construct the path to the database file</span>
<span class="n">DATABASE_URL</span> <span class="o">=</span> <span class="n">CURRENT_DIR</span> <span class="o">/</span> <span class="s2">&quot;database.db&quot;</span>

<span class="c1"># Set up database URL as an environment variable for better flexibility</span>

<span class="n">SQLALCHEMY_DATABASE_URL</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;DATABASE_URL&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;sqlite:///</span><span class="si">{</span><span class="n">DATABASE_URL</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="n">SQLALCHEMY_DATABASE_URL</span><span class="p">)</span>
<span class="n">SessionLocal</span> <span class="o">=</span> <span class="n">sessionmaker</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">SessionLocal</span><span class="p">()</span>

<span class="n">accounts</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Account</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>  <span class="c1"># Returns a list of all Account objects</span>
<span class="k">for</span> <span class="n">account</span> <span class="ow">in</span> <span class="n">accounts</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">account</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">account</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">account</span><span class="o">.</span><span class="n">email</span><span class="p">,</span> <span class="n">account</span><span class="o">.</span><span class="n">balance</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="the-engine-session-and-base">
<h2><a class="toc-backref" href="#id10" role="doc-backlink">The Engine, Session, and Base</a><a class="headerlink" href="#the-engine-session-and-base" title="Link to this heading">#</a></h2>
<ol class="arabic">
<li><p><code class="docutils literal notranslate"><span class="pre">engine</span> <span class="pre">=</span> <span class="pre">create_engine(SQLALCHEMY_DATABASE_URL)</span></code>:</p>
<p>This line is creating a new instance of SQLAlchemy’s engine. The engine is
the starting point for any SQLAlchemy application. It’s “home base” for the
actual database and its DBAPI, which provides connectivity to a particular
database server. The SQLAlchemy engine is created by calling the
<code class="docutils literal notranslate"><span class="pre">create_engine()</span></code> function and passing the connection string of the database
to connect to. In this case, <code class="docutils literal notranslate"><span class="pre">SQLALCHEMY_DATABASE_URL</span></code> is the connection
string, which provides the details of the database server (type of database,
database name, host, user, password, etc.).</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">SessionLocal</span> <span class="pre">=</span> <span class="pre">sessionmaker(bind=engine)</span></code>:</p>
<p>This line is creating a factory for SQLAlchemy sessions, bound to our
engine. A session in SQLAlchemy is a workspace for all operations with the
database. Objects are added to that session, and they are tracked as they
are modified. Any changes made won’t be persisted into the database until
the session is committed. The session maker <code class="docutils literal notranslate"><span class="pre">SessionLocal</span></code> is used to get
new sessions when needed.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Base.metadata.create_all(bind=engine)</span></code>:</p>
<p>This line is issuing a command to the database to create all tables defined
in our SQLAlchemy models. <code class="docutils literal notranslate"><span class="pre">Base.metadata.create_all()</span></code> goes through each
SQLAlchemy model, and for each table that doesn’t exist in the database, it
generates the SQL command to create that table. The <code class="docutils literal notranslate"><span class="pre">bind=engine</span></code> parameter
is telling it where to create these tables. In this case, it’s creating the
tables in the database which the engine is connected to. It’s an idempotent
operation, meaning you can call it multiple times and it will only create
tables that don’t already exist.</p>
</li>
</ol>
<p>To summarize, these lines are setting up the connection to our database and
creating the necessary tables based on our SQLAlchemy models. They’re necessary
for our application to interact with the database using SQLAlchemy.</p>
</section>
<section id="what-is-relationship-defined-in-sqlalchemy">
<h2><a class="toc-backref" href="#id11" role="doc-backlink">What is relationship defined in SQLAlchemy?</a><a class="headerlink" href="#what-is-relationship-defined-in-sqlalchemy" title="Link to this heading">#</a></h2>
<p>We have seen earlier in both <code class="docutils literal notranslate"><span class="pre">Account</span></code> and <code class="docutils literal notranslate"><span class="pre">Transaction</span></code> models, there is a
<code class="docutils literal notranslate"><span class="pre">relationship</span></code> attribute. What does it mean?</p>
<p>The <code class="docutils literal notranslate"><span class="pre">transactions</span></code> relationship in the <code class="docutils literal notranslate"><span class="pre">Account</span></code> model is essentially a
convenience for you to access all transactions associated with a specific
account directly from the account instance. This feature is especially powerful
when dealing with relationships (foreign keys) between tables, as it simplifies
the process of querying and navigating these relations.</p>
<p>Let’s take an example:</p>
<p>Imagine you’ve got an instance of <code class="docutils literal notranslate"><span class="pre">Account</span></code> representing a particular bank
account and you’d like to know all the transactions that have occurred with this
account. Without the <code class="docutils literal notranslate"><span class="pre">transactions</span></code> relationship, you’d have to perform a
separate query on the <code class="docutils literal notranslate"><span class="pre">Transaction</span></code> table to get this information:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">session</span> <span class="o">=</span> <span class="n">SessionLocal</span><span class="p">()</span>

<span class="n">ID</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">account</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Account</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Account</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">ID</span><span class="p">)</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>
<span class="n">transactions</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Transaction</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Transaction</span><span class="o">.</span><span class="n">account_id</span> <span class="o">==</span> <span class="n">account</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</div>
<p>Printing out the above would yield</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;_sa_instance_state&quot;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">sqlalchemy</span><span class="o">.</span><span class="n">orm</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">InstanceState</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x106153820</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Lindsey Riley&quot;</span><span class="p">,</span>
    <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;nicholas55@example.com&quot;</span><span class="p">,</span>
    <span class="s2">&quot;balance&quot;</span><span class="p">:</span> <span class="mf">3557.707193831535</span><span class="p">,</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>and</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;_sa_instance_state&quot;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">sqlalchemy</span><span class="o">.</span><span class="n">orm</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">InstanceState</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x106237f40</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="s2">&quot;amount&quot;</span><span class="p">:</span> <span class="mf">383.6977248919248</span><span class="p">,</span>
    <span class="s2">&quot;account_id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">55</span><span class="p">),</span>
    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;deposit&quot;</span><span class="p">,</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>respectively.</p>
<p>However, with the <code class="docutils literal notranslate"><span class="pre">transactions</span></code> relationship established in the <code class="docutils literal notranslate"><span class="pre">Account</span></code>
model, SQLAlchemy automatically retrieves this data for you, and you can access
it like a regular attribute:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">account</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Account</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Account</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">ID</span><span class="p">)</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>
<span class="n">transactions</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">transactions</span>
</pre></div>
</div>
<p>Printing out the transactions will be exactly the same as how you did it
earlier.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">relationship</span></code> attribute provides a high-level, Pythonic way to retrieve,
add, and remove related objects, which makes it easier to write queries and
manipulate data. It’s a powerful feature of SQLAlchemy’s ORM that lets you work
with our data in a more intuitive and less error-prone way.</p>
</section>
<section id="session-vs-sessionlocal">
<h2><a class="toc-backref" href="#id12" role="doc-backlink">Session vs. SessionLocal</a><a class="headerlink" href="#session-vs-sessionlocal" title="Link to this heading">#</a></h2>
<p>The terms <code class="docutils literal notranslate"><span class="pre">SessionLocal</span></code> and <code class="docutils literal notranslate"><span class="pre">Session</span></code> refer to different concepts in
SQLAlchemy:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Session</span></code>: In SQLAlchemy, a <code class="docutils literal notranslate"><span class="pre">Session</span></code> is the primary interface for
persistence operations. It’s a class that allows you to create instances that
represent a “workspace” of operations against the database. You use a
<code class="docutils literal notranslate"><span class="pre">Session</span></code> instance to query the database and persist changes.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SessionLocal</span></code>: In the context of FastAPI and SQLAlchemy, <code class="docutils literal notranslate"><span class="pre">SessionLocal</span></code> is
often used to denote a factory function that produces SQLAlchemy <code class="docutils literal notranslate"><span class="pre">Session</span></code>
instances. It’s typically created by calling <code class="docutils literal notranslate"><span class="pre">sessionmaker()</span></code> with certain
arguments, such as the database engine or connection, and other configuration
options.</p></li>
</ol>
<p>Here’s an example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">sessionmaker</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;sqlite:///example.db&quot;</span><span class="p">)</span>
<span class="n">SessionLocal</span> <span class="o">=</span> <span class="n">sessionmaker</span><span class="p">(</span><span class="n">autocommit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">autoflush</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bind</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>
</pre></div>
</div>
<p>In this case, <code class="docutils literal notranslate"><span class="pre">SessionLocal</span></code> is a function that, when called, returns a new
SQLAlchemy <code class="docutils literal notranslate"><span class="pre">Session</span></code>. This is useful in FastAPI applications, where you want to
create a new <code class="docutils literal notranslate"><span class="pre">Session</span></code> for each request.</p>
<p>Then, in a FastAPI route, you might use <code class="docutils literal notranslate"><span class="pre">SessionLocal</span></code> to create a new
<code class="docutils literal notranslate"><span class="pre">Session</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/items/&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">read_items</span><span class="p">(</span><span class="n">db</span><span class="p">:</span> <span class="n">Session</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_db</span><span class="p">)):</span>
    <span class="n">items</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Item</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">items</span>
</pre></div>
</div>
<p>In this case, <code class="docutils literal notranslate"><span class="pre">db</span></code> is an instance of <code class="docutils literal notranslate"><span class="pre">Session</span></code> created by calling
<code class="docutils literal notranslate"><span class="pre">SessionLocal()</span></code>. This <code class="docutils literal notranslate"><span class="pre">Session</span></code> is used to query the database and is
automatically closed at the end of the request.</p>
</section>
<section id="object-relational-mapping-orm">
<h2><a class="toc-backref" href="#id13" role="doc-backlink">Object-Relational Mapping (ORM)</a><a class="headerlink" href="#object-relational-mapping-orm" title="Link to this heading">#</a></h2>
<section id="definition-and-intuition">
<h3><a class="toc-backref" href="#id14" role="doc-backlink">Definition and Intuition</a><a class="headerlink" href="#definition-and-intuition" title="Link to this heading">#</a></h3>
<p>Object-Relational Mapping, or ORM, is a programming technique for converting
data between incompatible type systems in object-oriented programming languages.
In simple terms, it’s a way to create, retrieve, update, and delete records from
a relational database using higher-level object-oriented programming languages,
not SQL.</p>
<p>An ORM acts as a translator, allowing you to work with databases using our
programming language of choice instead of writing SQL. It does this by mapping
or tying database tables to classes in a programming language. The rows in these
tables are then tied to instances (objects) of these classes, and columns in the
rows are tied to attributes of these instances.</p>
</section>
<section id="analogy">
<h3><a class="toc-backref" href="#id15" role="doc-backlink">Analogy</a><a class="headerlink" href="#analogy" title="Link to this heading">#</a></h3>
<p>Let’s imagine you speak English, and you’re trying to communicate with someone
who speaks French. You don’t know any French, and they don’t know any English.
You could try to learn French, but that might take a lot of time and effort.
Instead, you hire a translator who knows both languages. You speak in English,
the translator translates our words into French for the other person, and vice
versa. In this analogy, you are the object-oriented programming language, the
French-speaking person is the SQL database, and the translator is the ORM.</p>
</section>
<section id="example">
<h3><a class="toc-backref" href="#id16" role="doc-backlink">Example</a><a class="headerlink" href="#example" title="Link to this heading">#</a></h3>
<p>Using Python’s SQLAlchemy ORM as an example, let’s look at the previously
defined <code class="docutils literal notranslate"><span class="pre">Account</span></code> model:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Account</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;accounts&quot;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">balance</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">transactions</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Transaction&quot;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s2">&quot;account&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Here, the <code class="docutils literal notranslate"><span class="pre">Account</span></code> class is tied to the <code class="docutils literal notranslate"><span class="pre">accounts</span></code> table in the database via
the ORM. Each instance of <code class="docutils literal notranslate"><span class="pre">Account</span></code> corresponds to a row in the <code class="docutils literal notranslate"><span class="pre">accounts</span></code>
table, and each attribute of <code class="docutils literal notranslate"><span class="pre">Account</span></code> corresponds to a column in that row.</p>
<p>With an ORM like SQLAlchemy, you can perform database operations using Python,
and SQLAlchemy translates these operations into SQL for you. For example, to
insert a new account into the database, you could do:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">session</span> <span class="o">=</span> <span class="n">SessionLocal</span><span class="p">()</span>

<span class="n">new_account</span> <span class="o">=</span> <span class="n">Account</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;John Doe&quot;</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="s2">&quot;john@example.com&quot;</span><span class="p">,</span> <span class="n">balance</span><span class="o">=</span><span class="mf">100.0</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_account</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

<span class="n">account_john</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Account</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Account</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;John Doe&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">account_john</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
</pre></div>
</div>
<p>In the background, SQLAlchemy translates this into SQL and executes the SQL
commands for you:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">accounts</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="n">balance</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;John Doe&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;john@example.com&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span>
</pre></div>
</div>
<p>As you can see, the benefit of using an ORM is that you can work with databases
using the same programming language you’re using for the rest of our
application, rather than switching between that language and SQL.</p>
</section>
<section id="the-role-of-base-in-sqlalchemy-s-orm-system">
<h3><a class="toc-backref" href="#id17" role="doc-backlink">The Role of Base in SQLAlchemy’s ORM System</a><a class="headerlink" href="#the-role-of-base-in-sqlalchemy-s-orm-system" title="Link to this heading">#</a></h3>
<p>Object-Relational Mapping (ORM) is a powerful technique that connects the
objects in our code to the tables in our database. In the world of Python, one
of the popular ORMs is SQLAlchemy, and the cornerstone of this system is the
<code class="docutils literal notranslate"><span class="pre">Base</span></code> class.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Column</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">Float</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="n">declarative_base</span>

<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>
</pre></div>
</div>
<p>When we call <code class="docutils literal notranslate"><span class="pre">declarative_base()</span></code>, we’re creating a new base class from which
all of our data models will inherit. This new class, <code class="docutils literal notranslate"><span class="pre">Base</span></code>, is equipped with a
meta-database system that SQLAlchemy uses to orchestrate the communication
between our Python classes and the corresponding database tables.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Account</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>In the example above, <code class="docutils literal notranslate"><span class="pre">Account</span></code> is defined as a subclass of <code class="docutils literal notranslate"><span class="pre">Base</span></code>. By doing so,
<code class="docutils literal notranslate"><span class="pre">Account</span></code> is now recognized by SQLAlchemy as a model that corresponds to a
database table. In practice, this means that SQLAlchemy can now perform a series
of database operations on the <code class="docutils literal notranslate"><span class="pre">Account</span></code> class. These operations include creating
new records, querying existing ones, or updating and deleting records, all using
Python rather than SQL.</p>
<p>When <code class="docutils literal notranslate"><span class="pre">Account</span></code> inherits from <code class="docutils literal notranslate"><span class="pre">Base</span></code>, it’s not just inheriting an empty class.
Instead, it’s receiving SQLAlchemy’s special instrumentation system. This system
includes various methods and attributes that tie <code class="docutils literal notranslate"><span class="pre">Account</span></code> into SQLAlchemy’s API
for tasks such as querying, session tracking, and transaction handling.</p>
<p>However, the <code class="docutils literal notranslate"><span class="pre">Base</span></code> class is not a standalone feature. While it does transform
<code class="docutils literal notranslate"><span class="pre">Account</span></code> into an ORM-aware class, its full potential is realized only when used
in conjunction with other tools provided by SQLAlchemy, such as <code class="docutils literal notranslate"><span class="pre">sessionmaker</span></code>
and <code class="docutils literal notranslate"><span class="pre">create_engine</span></code>. These tools work together with <code class="docutils literal notranslate"><span class="pre">Base</span></code> to form a complete
ORM system, facilitating efficient and convenient interaction with our database.</p>
<p>To summarize, SQLAlchemy’s <code class="docutils literal notranslate"><span class="pre">Base</span></code> class is a vital piece in the ORM puzzle. It
serves as a translator between our Python classes and the underlying database
tables, simplifying data handling tasks and making our code more maintainable
and scalable. By leveraging the power of <code class="docutils literal notranslate"><span class="pre">Base</span></code> and other SQLAlchemy components,
you can focus more on the core logic of our application and less on the
intricacies of database management.</p>
<hr class="docutils" />
<p><strong>2. Defining <code class="docutils literal notranslate"><span class="pre">__tablename__</span></code></strong></p>
<p>In SQLAlchemy, <code class="docutils literal notranslate"><span class="pre">__tablename__</span></code> is a special attribute you set in our model
classes that inherit from <code class="docutils literal notranslate"><span class="pre">Base</span></code>. It defines the name of the database table the
model class corresponds to.</p>
<p>For example, in the <code class="docutils literal notranslate"><span class="pre">Account</span></code> class, <code class="docutils literal notranslate"><span class="pre">__tablename__</span> <span class="pre">=</span> <span class="pre">&quot;accounts&quot;</span></code> tells
SQLAlchemy that the <code class="docutils literal notranslate"><span class="pre">Account</span></code> class corresponds to the <code class="docutils literal notranslate"><span class="pre">accounts</span></code> table in the
database. SQLAlchemy will look for this table when performing operations related
to the <code class="docutils literal notranslate"><span class="pre">Account</span></code> class.</p>
</section>
</section>
<section id="moving-on-from-data-models-to-restful-api-endpoints">
<h2><a class="toc-backref" href="#id18" role="doc-backlink">Moving on from Data (Models) to RESTful API (Endpoints)</a><a class="headerlink" href="#moving-on-from-data-models-to-restful-api-endpoints" title="Link to this heading">#</a></h2>
<p>As the goal of the article is to guide the reader through building a FastAPI
application, it would be logical to start with setting up the database models
using SQLAlchemy. This foundational step is crucial before we move on to
defining the FastAPI application and its endpoints (requests and responses).</p>
<p>We have explained on how to define the <code class="docutils literal notranslate"><span class="pre">Account</span></code> and <code class="docutils literal notranslate"><span class="pre">Transaction</span></code> models, how
to set up the SQLite engine, and how to create a session for interacting with
the database.</p>
<p>Once the models and database setup are explained, we can then proceed to the
“Creating the FastAPI Application” section. This part would cover how to define
the routes (endpoints) for our API, how to handle incoming requests, and what
responses to return. The readers would learn how to implement all the required
operations (e.g., creating an account, depositing money, etc.) and how to use
the HTTP methods (GET, POST, PUT, DELETE) to manipulate data.</p>
</section>
<section id="endpoints">
<h2><a class="toc-backref" href="#id19" role="doc-backlink">Endpoints</a><a class="headerlink" href="#endpoints" title="Link to this heading">#</a></h2>
<p>The very first thing users should understand about RESTful APIs, especially when
dealing with web applications, is the concept of endpoints and HTTP methods. An
<strong>endpoint</strong> refers to a specific URL where an API can be accessed, and an HTTP
method defines what type of operation to perform.</p>
<p>In the context of RESTful APIs, an <strong>endpoint</strong> is a specific URL where our API
can be accessed. Each endpoint is associated with a specific function or
resource. For example, in a banking application, you might have <code class="docutils literal notranslate"><span class="pre">/accounts</span></code>
endpoint for managing accounts and a <code class="docutils literal notranslate"><span class="pre">/transactions</span></code> endpoint for managing
transactions.</p>
<p>Let’s say you’re creating a RESTful API for a simple banking application. Here
are two basic endpoints: one for managing accounts (<code class="docutils literal notranslate"><span class="pre">/accounts</span></code>), and one for
managing transactions (<code class="docutils literal notranslate"><span class="pre">/transactions</span></code>).</p>
<p>First, you need to import the necessary modules and create an instance of
<code class="docutils literal notranslate"><span class="pre">FastAPI</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">FastAPI</span><span class="p">,</span> <span class="n">HTTPException</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Union</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">()</span>
</pre></div>
</div>
<p>Then we create a variable <code class="docutils literal notranslate"><span class="pre">accounts</span></code> that is a list of dictionaries. Each
dictionary represents an account and contains the account’s <code class="docutils literal notranslate"><span class="pre">id</span></code>, <code class="docutils literal notranslate"><span class="pre">name</span></code>,
<code class="docutils literal notranslate"><span class="pre">email</span></code> and <code class="docutils literal notranslate"><span class="pre">balance</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># This list of dictionaries will act as our &quot;database&quot;</span>
<span class="n">accounts</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;John Doe&quot;</span><span class="p">,</span> <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;johndoe@gmail.com&quot;</span><span class="p">,</span> <span class="s2">&quot;balance&quot;</span><span class="p">:</span> <span class="mf">100.0</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Jane Doe&quot;</span><span class="p">,</span> <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;janedoe@gmail.com&quot;</span><span class="p">,</span> <span class="s2">&quot;balance&quot;</span><span class="p">:</span> <span class="mf">200.0</span><span class="p">},</span>
<span class="p">]</span>


<span class="k">def</span> <span class="nf">get_account_by_id</span><span class="p">(</span><span class="n">account_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the account with the given id.&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">account</span> <span class="ow">in</span> <span class="n">accounts</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">account</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">account_id</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">account</span>
    <span class="k">return</span> <span class="p">{}</span>  <span class="c1"># Return an empty dict if no account was found</span>
</pre></div>
</div>
<p>The function <code class="docutils literal notranslate"><span class="pre">get_account_by_id</span></code> takes in an <code class="docutils literal notranslate"><span class="pre">account_id</span></code> and returns the
account with the given <code class="docutils literal notranslate"><span class="pre">account_id</span></code> if it exists. If no account is found, it
returns an empty dictionary.</p>
<p>Now, let’s create a GET <strong>endpoint</strong> for <code class="docutils literal notranslate"><span class="pre">/accounts</span></code> that retrieves a list of
all accounts:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/accounts&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">get_accounts</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return all accounts.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">accounts</span>
</pre></div>
</div>
<p>Similarly, we can do the same for transactions:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">transactions</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;account_id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;amount&quot;</span><span class="p">:</span> <span class="mf">50.0</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;deposit&quot;</span><span class="p">,</span>
        <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2023-08-05T14:00:00Z&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;account_id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;amount&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">20.0</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;withdrawal&quot;</span><span class="p">,</span>
        <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2023-08-05T14:00:00Z&quot;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">]</span>

<span class="k">def</span> <span class="nf">get_transaction_by_id</span><span class="p">(</span><span class="n">transaction_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the transaction with the given id.&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">transaction</span> <span class="ow">in</span> <span class="n">transactions</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">transaction</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">transaction_id</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">transaction</span>
    <span class="k">return</span> <span class="p">{}</span>  <span class="c1"># Return an empty dict if no transaction was found</span>
</pre></div>
</div>
<p>Let’s create a GET <strong>endpoint</strong> for <code class="docutils literal notranslate"><span class="pre">/transactions</span></code> that retrieves a list of all
transactions:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/transactions&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">get_transactions</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return all transactions.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">transactions</span>
</pre></div>
</div>
<section id="running-the-fastapi-application">
<h3><a class="toc-backref" href="#id20" role="doc-backlink">Running the FastAPI Application</a><a class="headerlink" href="#running-the-fastapi-application" title="Link to this heading">#</a></h3>
<p>Once you’ve designed our models, populated our database, and defined our API
endpoints, the next step is to actually run our FastAPI application.</p>
<p>FastAPI applications are run using an ASGI server. ASGI, or Asynchronous Server
Gateway Interface, is a standard interface between ASGI web servers and Python
web applications. It is an evolution of the older WSGI standard that is built to
handle asynchronous operations and WebSockets in addition to standard HTTP
requests.</p>
<p>The most common ASGI server for FastAPI applications is <code class="docutils literal notranslate"><span class="pre">uvicorn</span></code>. Here’s how to
install it:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>uvicorn
</pre></div>
</div>
<p>Once <code class="docutils literal notranslate"><span class="pre">uvicorn</span></code> is installed, you can run our FastAPI application using the
following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>uvicorn<span class="w"> </span>&lt;APP_NAME&gt;:app<span class="w"> </span>--reload
</pre></div>
</div>
<p>In this command, the first <code class="docutils literal notranslate"><span class="pre">&lt;APP_NAME&gt;</span></code> before the colon is the name of our
Python file (i.e., if our python script that holds the app logic is named
<code class="docutils literal notranslate"><span class="pre">app.py</span></code>), without the <code class="docutils literal notranslate"><span class="pre">.py</span></code> extension. The second <code class="docutils literal notranslate"><span class="pre">app</span></code> after the colon is the
FastAPI instance you created in that file (i.e., <code class="docutils literal notranslate"><span class="pre">app</span> <span class="pre">=</span> <span class="pre">FastAPI()</span></code>). The
<code class="docutils literal notranslate"><span class="pre">--reload</span></code> flag enables hot reloading, which means the server will automatically
update whenever you make changes to our code. This is very useful during
development, but should not be used in a production environment.</p>
<p>Once the server is running, you can open our browser and visit
<code class="docutils literal notranslate"><span class="pre">http://localhost:8000</span></code> to see our application. FastAPI also automatically
generates interactive API documentation for our application. You can access this
by visiting <code class="docutils literal notranslate"><span class="pre">http://localhost:8000/docs</span></code> in our browser. The documentation
allows you to see all our API routes, and you can even try out requests directly
in our browser.</p>
<p>What <code class="docutils literal notranslate"><span class="pre">uvicorn</span></code> does is it essentially acts as the link between our FastAPI
application and the outside world. It listens for incoming HTTP requests, passes
them to our application, and then sends the responses back to the client. The
ASGI specification allows it to handle multiple requests concurrently, which is
a key feature for modern web applications.</p>
<p>Now, if you run our FastAPI application and navigate to
<code class="docutils literal notranslate"><span class="pre">http://localhost:8000/accounts</span></code> in our web browser, you would see a list of all
accounts. Similarly, navigating to <code class="docutils literal notranslate"><span class="pre">http://localhost:8000/transactions</span></code> would
show a list of all transactions. The <code class="docutils literal notranslate"><span class="pre">&#64;app.get</span></code> decorator tells FastAPI that
when a GET request is made to the <code class="docutils literal notranslate"><span class="pre">/accounts</span></code> or <code class="docutils literal notranslate"><span class="pre">/transactions</span></code> endpoint, it
should call the corresponding function (<code class="docutils literal notranslate"><span class="pre">read_accounts</span></code> or <code class="docutils literal notranslate"><span class="pre">read_transactions</span></code>).</p>
<p>So, when you run our FastAPI application and visit
<code class="docutils literal notranslate"><span class="pre">http://localhost:8000/accounts</span></code> in our browser or send a GET request to this
URL using a tool like <code class="docutils literal notranslate"><span class="pre">curl</span></code> or Postman, you’re making a request to the
<code class="docutils literal notranslate"><span class="pre">/accounts</span></code> endpoint.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>http://localhost:8000/accounts
</pre></div>
</div>
<p>This sends a GET request to the <code class="docutils literal notranslate"><span class="pre">/accounts</span></code> endpoint, and the server should
respond with the JSON data for the accounts, which in our case will be the
hardcoded list of accounts and will return me exactly what I see in the browser</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>
<span class="w">    </span><span class="o">{</span>
<span class="w">        </span><span class="s2">&quot;id&quot;</span>:<span class="w"> </span><span class="m">1</span>,
<span class="w">        </span><span class="s2">&quot;name&quot;</span>:<span class="w"> </span><span class="s2">&quot;John Doe&quot;</span>,
<span class="w">        </span><span class="s2">&quot;email&quot;</span>:<span class="w"> </span><span class="s2">&quot;johndoe@gmail.com&quot;</span>,
<span class="w">        </span><span class="s2">&quot;balance&quot;</span>:<span class="w"> </span><span class="m">100</span>.0
<span class="w">    </span><span class="o">}</span>,
<span class="w">    </span><span class="o">{</span>
<span class="w">        </span><span class="s2">&quot;id&quot;</span>:<span class="w"> </span><span class="m">2</span>,
<span class="w">        </span><span class="s2">&quot;name&quot;</span>:<span class="w"> </span><span class="s2">&quot;Jane Doe&quot;</span>,
<span class="w">        </span><span class="s2">&quot;email&quot;</span>:<span class="w"> </span><span class="s2">&quot;janedoen@gmail.com&quot;</span>,
<span class="w">        </span><span class="s2">&quot;balance&quot;</span>:<span class="w"> </span><span class="m">200</span>.0
<span class="w">    </span><span class="o">}</span>
<span class="o">]</span>
</pre></div>
</div>
<p>Similarly, you can send a GET request to the <code class="docutils literal notranslate"><span class="pre">/transactions</span></code> endpoint like so:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>http://localhost:8000/transactions
</pre></div>
</div>
<p>And the server should respond with the hardcoded list of transactions:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;account_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;amount&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">50.0</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;deposit&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2023-08-05T14:00:00Z&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;account_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;amount&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">-20.0</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;withdrawal&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2023-08-05T14:00:00Z&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>This way you are communicating with our FastAPI application through its
endpoints using <code class="docutils literal notranslate"><span class="pre">curl</span></code>.</p>
<p>In addition to the URL, each endpoint also involves an HTTP method, which
determines what type of operation is being performed. The most common methods
are GET (retrieve data), POST (send data), PUT (update data), DELETE (remove
data), among others.</p>
<p>In the code example I gave you, the <code class="docutils literal notranslate"><span class="pre">/accounts</span></code> endpoint is associated with the
GET method, meaning it’s used to retrieve data. If you wanted to create an
endpoint for sending (posting) data, you would use the <code class="docutils literal notranslate"><span class="pre">&#64;app.post()</span></code> decorator
instead.</p>
<p>Notice that the above examples are all hardcoded values and we did not use our
previously defined database. We shall slowly build up the complexity in the
section <a class="reference internal" href="#piecing-it-all-together"><span class="xref myst">piecing it all together</span></a>.</p>
</section>
</section>
<section id="what-s-async">
<h2><a class="toc-backref" href="#id21" role="doc-backlink">What’s Async?</a><a class="headerlink" href="#what-s-async" title="Link to this heading">#</a></h2>
<p>Using <code class="docutils literal notranslate"><span class="pre">async</span></code> in our <code class="docutils literal notranslate"><span class="pre">get_accounts</span></code> function declaration allows FastAPI to use
asynchronous I/O (input/output) when handling requests to this endpoint.</p>
<p>When a function is declared with <code class="docutils literal notranslate"><span class="pre">async</span></code>, it becomes a coroutine that can be
paused and resumed, allowing it to yield control while waiting for I/O
operations (like querying a database, requesting data from another server,
reading a file, etc.) to complete. This is extremely beneficial in the context
of a web server, where I/O-bound tasks are common.</p>
<p>In our <code class="docutils literal notranslate"><span class="pre">get_accounts</span></code> function, even though the function itself doesn’t perform
any I/O operations or contain any <code class="docutils literal notranslate"><span class="pre">await</span></code> expressions, declaring it as <code class="docutils literal notranslate"><span class="pre">async</span></code>
allows FastAPI to handle requests to this endpoint asynchronously. This means
that while one request is being processed, FastAPI can start processing another.</p>
<p>Here is a simplified example:</p>
<ol class="arabic simple">
<li><p>Request A comes in to get accounts. FastAPI starts processing this request by
calling our <code class="docutils literal notranslate"><span class="pre">get_accounts</span></code> function.</p></li>
<li><p>While FastAPI is waiting for the <code class="docutils literal notranslate"><span class="pre">get_accounts</span></code> function to complete for
Request A, Request B comes in.</p></li>
<li><p>Because <code class="docutils literal notranslate"><span class="pre">get_accounts</span></code> is a coroutine (declared with <code class="docutils literal notranslate"><span class="pre">async</span></code>), FastAPI can
pause its execution on Request A and start processing Request B. This is
possible even if <code class="docutils literal notranslate"><span class="pre">get_accounts</span></code> doesn’t actually contain any I/O operations
or <code class="docutils literal notranslate"><span class="pre">await</span></code> expressions.</p></li>
</ol>
<p>So, using <code class="docutils literal notranslate"><span class="pre">async</span></code> allows FastAPI to more efficiently handle multiple requests at
once, improving the overall performance of our application.</p>
</section>
<section id="request">
<h2><a class="toc-backref" href="#id22" role="doc-backlink">Request</a><a class="headerlink" href="#request" title="Link to this heading">#</a></h2>
<section id="intuition">
<h3><a class="toc-backref" href="#id23" role="doc-backlink">Intuition</a><a class="headerlink" href="#intuition" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>An
<strong><a class="reference external" href="https://www.mulesoft.com/resources/api/what-is-an-endpoint">endpoint</a></strong>
is a specific URL where an API can be accessed. For instance, <code class="docutils literal notranslate"><span class="pre">/accounts</span></code>
and <code class="docutils literal notranslate"><span class="pre">/transactions</span></code> are examples of endpoints in our application.</p></li>
<li><p>A <strong><a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Overview">request</a></strong>
involves several elements, including:</p>
<ul>
<li><p>an
<strong><a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods">HTTP method</a></strong>
(like GET, POST, PUT, or DELETE)</p></li>
<li><p>a <strong>URI</strong> (the endpoint being targeted)</p></li>
<li><p><strong><a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers">headers</a></strong>
(optional metadata about the request)</p></li>
<li><p>a <strong><a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Messages">body</a></strong>
(data being sent with the request)</p></li>
</ul>
</li>
</ul>
<p>The <strong>endpoint</strong> is the destination of a request. You send a <strong>request</strong> to a
particular <strong>endpoint</strong> to perform some operation, and the operation you’re
performing is determined by the HTTP method. So in the command
<code class="docutils literal notranslate"><span class="pre">curl</span> <span class="pre">http://localhost:8000/accounts</span></code>, <code class="docutils literal notranslate"><span class="pre">http://localhost:8000/accounts</span></code> is the
endpoint and the request is a GET request to that endpoint.</p>
<ul class="simple">
<li><p>The <strong>endpoint</strong> is indeed the “where”, the address of the resource you want
to interact with.</p></li>
<li><p>The <strong>HTTP method</strong> is the “what”, the action you want to perform on the
resource.</p></li>
<li><p>The <strong>headers</strong> can be thought of as the “extras”, providing additional
instructions or information about the request.</p></li>
<li><p>The <strong>body</strong> would be better described as the “content” or “details”,
containing the specific data you want to send or manipulate.</p></li>
</ul>
<blockquote>
<div><p>“The endpoint is the ‘where’, the HTTP method is the ‘what’, the headers are
the ‘extras’, and the body is the ‘content’.”</p>
</div></blockquote>
<p>An analogy for this could be sending a letter via post:</p>
<ul class="simple">
<li><p>The endpoint is like the address you’re sending our letter to.</p></li>
<li><p>The HTTP method is like the type of mail you’re sending (standard, express,
registered, etc.).</p></li>
<li><p>The headers are like any special instructions you give to the post office or
write on the envelope (handle with care, return receipt requested, etc.).</p></li>
<li><p>The body is like the content of our letter.</p></li>
</ul>
</section>
<section id="uri">
<h3><a class="toc-backref" href="#id24" role="doc-backlink">URI</a><a class="headerlink" href="#uri" title="Link to this heading">#</a></h3>
<p><strong>URI (Uniform Resource Identifier)</strong> is essentially the URL you’re sending a
request to. In the context of APIs, the URI often includes the base URL of the
API server, plus any endpoint-specific path. For example, in
<code class="docutils literal notranslate"><span class="pre">http://localhost:8000/accounts</span></code>, <code class="docutils literal notranslate"><span class="pre">localhost:8000</span></code> is the base URL, and
<code class="docutils literal notranslate"><span class="pre">/accounts</span></code> is the specific endpoint.</p>
<p>The below illustration is taken from
<a class="reference external" href="https://madewithml.com/courses/mlops/api/">madewithml</a>.</p>
<pre class="output ai-center-all" style="padding-left: 0rem; padding-right: 0rem; font-weight: 600;"><span style="color:#d63939">https://</span><span style="color:#206bc4">localhost:</span><span style="color: #4299e1">8000</span><span style="color:#2fb344">/models/{modelId}/</span><span style="color:#ae3ec9">?filter=passed</span><span style="color:#f76707">#details</span>
</pre>
<div class="row">
    <div class="col-md-6">
        <div class="md-typeset__table">
            <div class="md-typeset__scrollwrap">
                <table>
                    <thead>
                        <tr>
                            <th align="left">Parts of the URI</th>
                            <th align="left">Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td align="left"><span style="color: #d63939;">scheme</span></td>
                            <td align="left">protocol definition</td>
                        </tr>
                        <tr>
                            <td align="left"><span style="color: #206bc4;">domain</span></td>
                            <td align="left">address of the website</td>
                        </tr>
                        <tr>
                            <td align="left"><span style="color: #4299e1;">port</span></td>
                            <td align="left">endpoint</td>
                        </tr>
                        <tr>
                            <td align="left"><span style="color: #2fb344;">path</span></td>
                            <td align="left">location of the resource</td>
                        </tr>
                        <tr>
                            <td align="left"><span style="color: #ae3ec9;">query string</span></td>
                            <td align="left">parameters to identify resources</td>
                        </tr>
                        <tr>
                            <td align="left"><span style="color: #f76707;">anchor</span></td>
                            <td align="left">location on webpage</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="md-typeset__table">
            <div class="md-typeset__scrollwrap">
                <table>
                    <thead>
                        <tr>
                            <th align="left">Parts of the path</th>
                            <th align="left">Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td align="left"><code>/models</code></td>
                            <td align="left">collection resource of all <code>models</code></td>
                        </tr>
                        <tr>
                            <td align="left"><code>/models/{modelID}</code></td>
                            <td align="left">single resource from the <code>models</code> collection</td>
                        </tr>
                        <tr>
                            <td align="left"><code>modelId</code></td>
                            <td align="left">path parameters</td>
                        </tr>
                        <tr>
                            <td align="left"><code>filter</code></td>
                            <td align="left">query parameter</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<p>We will revisit this section later.</p>
</section>
<section id="http-methods">
<h3><a class="toc-backref" href="#id25" role="doc-backlink">HTTP Methods</a><a class="headerlink" href="#http-methods" title="Link to this heading">#</a></h3>
<p>This is the type of HTTP request you’re making. The most common methods are GET
(retrieve data), POST (send data), PUT (update data), and DELETE (remove data).
In our examples, we’re using the GET method to retrieve data from our API.</p>
<p>The four horsemen GET, POST, PUT, and DELETE are the most common HTTP methods
and are often referred to as
<a class="reference external" href="https://en.wikipedia.org/wiki/Create,_read,_update_and_delete">CRUD</a> operations
(Create, Read, Update, Delete).</p>
<section id="get-read">
<h4><a class="toc-backref" href="#id26" role="doc-backlink">GET (Read)</a><a class="headerlink" href="#get-read" title="Link to this heading">#</a></h4>
<p>The GET method is used to retrieve data from the server. In a RESTful API, a GET
request to a specific endpoint generally retrieves a list or a specific record.
For example, a GET request to <code class="docutils literal notranslate"><span class="pre">/accounts</span></code> might retrieve a list of all accounts,
while a GET request to <code class="docutils literal notranslate"><span class="pre">/accounts/{account_id}</span></code> would retrieve the details of a
specific account.</p>
<p>We have not implemented the GET request to an individual account yet.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/accounts/</span><span class="si">{account_id}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">get_account</span><span class="p">(</span><span class="n">account_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the account with the given id.&quot;&quot;&quot;</span>
    <span class="n">account</span> <span class="o">=</span> <span class="n">get_account_by_id</span><span class="p">(</span><span class="n">account_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">account</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">404</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Account not found&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">account</span>
</pre></div>
</div>
<p>Now a GET request to <code class="docutils literal notranslate"><span class="pre">/accounts/1</span></code> would return the details of the account
associated with the id 1.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;John Doe&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;johndoe@gmail.com&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;balance&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">100.0</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Revisiting the URI will yield:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>http://127.0.0.1:8000/accounts/1
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">accounts</span></code> is the “models” and <code class="docutils literal notranslate"><span class="pre">1</span></code> is the <code class="docutils literal notranslate"><span class="pre">modelId</span></code>, an unique identifier.</p>
</section>
<section id="post-create">
<h4><a class="toc-backref" href="#id27" role="doc-backlink">POST (Create)</a><a class="headerlink" href="#post-create" title="Link to this heading">#</a></h4>
<p>The POST method in HTTP is used to send data to the server to create a new
resource. In a RESTful API, a POST request to a specific endpoint generally
creates a new record.</p>
<p>Here’s an example of how to implement a POST endpoint to create a new account:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/accounts&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">create_account</span><span class="p">(</span>
    <span class="n">account</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a new account with the given details.&quot;&quot;&quot;</span>
    <span class="c1"># Here we&#39;re just adding the account to our list</span>
    <span class="c1"># In a real application, you would save the account to our database</span>
    <span class="n">account_id</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">accounts</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># Generate a new ID</span>
    <span class="n">account</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">account_id</span>
    <span class="n">accounts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">account</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">account</span>
</pre></div>
</div>
<p>In this example, we’re using the <code class="docutils literal notranslate"><span class="pre">&#64;app.post</span></code> decorator to create a new POST
endpoint at <code class="docutils literal notranslate"><span class="pre">/accounts</span></code>. The <code class="docutils literal notranslate"><span class="pre">create_account</span></code> function takes a parameter
<code class="docutils literal notranslate"><span class="pre">account</span></code> which is a dictionary representing the account to be created.</p>
<p>You can invoke this endpoint by making a POST request to
<code class="docutils literal notranslate"><span class="pre">http://127.0.0.1:8000/accounts</span></code> with a JSON body containing the account
details. Here’s how you can do it with the <code class="docutils literal notranslate"><span class="pre">curl</span></code> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span><span class="se">\</span>
<span class="w">     </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">     </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;name&quot;: &quot;Alice&quot;, &quot;email&quot;: &quot;alice@example.com&quot;, &quot;balance&quot;: 300.0}&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">     </span>http://127.0.0.1:8000/accounts
</pre></div>
</div>
<p>Here’s what each part does:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">curl</span></code>: This is the command-line tool used to send HTTP requests.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-X</span> <span class="pre">POST</span></code>: This option specifies the HTTP method of the request, which in
this case is POST.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-H</span> <span class="pre">&quot;Content-Type:</span> <span class="pre">application/json&quot;</span></code>: This option sets the Content-Type
header of the request to <code class="docutils literal notranslate"><span class="pre">application/json</span></code>, indicating that the body of the
request is formatted as JSON.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-d</span> <span class="pre">'{&quot;name&quot;:</span> <span class="pre">&quot;Alice&quot;,</span> <span class="pre">&quot;email&quot;:</span> <span class="pre">&quot;alice&#64;example.com&quot;,</span> <span class="pre">&quot;balance&quot;:</span> <span class="pre">300.0}'</span></code>:
This option specifies the body of the request. The <code class="docutils literal notranslate"><span class="pre">-d</span></code> stands for “data”.
The string following <code class="docutils literal notranslate"><span class="pre">-d</span></code> is a JSON object containing the data for the new
account.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">http://127.0.0.1:8000/accounts</span></code>: This is the URL that the request is sent
to. In this case, it’s the local address (<code class="docutils literal notranslate"><span class="pre">127.0.0.1</span></code>, also known as
<code class="docutils literal notranslate"><span class="pre">localhost</span></code>) and port <code class="docutils literal notranslate"><span class="pre">8000</span></code>, followed by the <code class="docutils literal notranslate"><span class="pre">/accounts</span></code> endpoint.</p></li>
</ul>
<p>You should get a response with the details of the created account, including its
automatically assigned ID. Note that in a real application, you would likely
want to perform data validation and error checking to ensure that the provided
account details are valid and complete.</p>
</section>
<section id="put-update">
<h4><a class="toc-backref" href="#id28" role="doc-backlink">PUT (Update)</a><a class="headerlink" href="#put-update" title="Link to this heading">#</a></h4>
<p>In a RESTful API, a PUT request is generally used to update a specific record.
For example, a PUT request to <code class="docutils literal notranslate"><span class="pre">/accounts/{id}</span></code> with the necessary data in the
request body might update the details of a specific account.</p>
<p>Let’s create a <code class="docutils literal notranslate"><span class="pre">PUT</span></code> route to update an account:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s2">&quot;/accounts/</span><span class="si">{account_id}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">update_account</span><span class="p">(</span>
    <span class="n">account_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">account_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update an existing account with the given details.&quot;&quot;&quot;</span>
    <span class="c1"># Find the account to update</span>
    <span class="k">for</span> <span class="n">account</span> <span class="ow">in</span> <span class="n">accounts</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">account</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">account_id</span><span class="p">:</span>
            <span class="c1"># Update the fields</span>
            <span class="k">if</span> <span class="s2">&quot;name&quot;</span> <span class="ow">in</span> <span class="n">account_data</span><span class="p">:</span>
                <span class="n">account</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">account_data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s2">&quot;email&quot;</span> <span class="ow">in</span> <span class="n">account_data</span><span class="p">:</span>
                <span class="n">account</span><span class="p">[</span><span class="s2">&quot;email&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">account_data</span><span class="p">[</span><span class="s2">&quot;email&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s2">&quot;balance&quot;</span> <span class="ow">in</span> <span class="n">account_data</span><span class="p">:</span>
                <span class="n">account</span><span class="p">[</span><span class="s2">&quot;balance&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">account_data</span><span class="p">[</span><span class="s2">&quot;balance&quot;</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">account</span>
    <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">404</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Account not found&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This is a simple example of how you might implement a <code class="docutils literal notranslate"><span class="pre">PUT</span></code> route to update an
account. A <code class="docutils literal notranslate"><span class="pre">PUT</span></code> request to <code class="docutils literal notranslate"><span class="pre">/accounts/{account_id}</span></code> with a JSON body containing
the new account data will update the specified account.</p>
<p>You can test this route with a <code class="docutils literal notranslate"><span class="pre">curl</span></code> command like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>PUT<span class="w"> </span><span class="se">\</span>
<span class="w">     </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">     </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;name&quot;: &quot;Alice Smith&quot;, &quot;balance&quot;: 500.0}&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">     </span>http://127.0.0.1:8000/accounts/1
</pre></div>
</div>
<p>Here’s what each part does:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">curl</span></code>: This is the command-line tool used to send HTTP requests.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-X</span> <span class="pre">PUT</span></code>: This option specifies the HTTP method of the request, which in
this case is PUT. PUT is typically used for updating an existing resource.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-H</span> <span class="pre">&quot;Content-Type:</span> <span class="pre">application/json&quot;</span></code>: This option sets the Content-Type
header of the request to <code class="docutils literal notranslate"><span class="pre">application/json</span></code>, indicating that the body of the
request is formatted as JSON.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-d</span> <span class="pre">'{&quot;name&quot;:</span> <span class="pre">&quot;Alice</span> <span class="pre">Smith&quot;,</span> <span class="pre">&quot;balance&quot;:</span> <span class="pre">500.0}'</span></code>: This option specifies the
body of the request. The <code class="docutils literal notranslate"><span class="pre">-d</span></code> stands for “data”. The string following <code class="docutils literal notranslate"><span class="pre">-d</span></code>
is a JSON object containing the new data for the account. In this case,
we’re updating the account’s name and balance.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">http://127.0.0.1:8000/accounts/1</span></code>: This is the URL that the request is sent
to. In this case, it’s the local address (<code class="docutils literal notranslate"><span class="pre">127.0.0.1</span></code>, also known as
<code class="docutils literal notranslate"><span class="pre">localhost</span></code>) and port <code class="docutils literal notranslate"><span class="pre">8000</span></code>, followed by the <code class="docutils literal notranslate"><span class="pre">/accounts/1</span></code> endpoint. This
endpoint corresponds to the account with the ID of 1.</p></li>
</ul>
<p>When you run this <code class="docutils literal notranslate"><span class="pre">curl</span></code> command, it sends an HTTP PUT request to our FastAPI
application. The application should then update the account with the ID of 1 to
have the new name and balance specified in the request body. If everything goes
as expected, the server should respond with the updated account data.</p>
</section>
<section id="delete-delete">
<h4><a class="toc-backref" href="#id29" role="doc-backlink">DELETE (Delete)</a><a class="headerlink" href="#delete-delete" title="Link to this heading">#</a></h4>
<p>In a RESTful API, a DELETE request is generally used to delete a specific
record. For example, a DELETE request to <code class="docutils literal notranslate"><span class="pre">/accounts/{id}</span></code> would delete the
specific account.</p>
<p>Let’s create a <code class="docutils literal notranslate"><span class="pre">DELETE</span></code> route to delete an account:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">&quot;/accounts/</span><span class="si">{account_id}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">delete_account</span><span class="p">(</span><span class="n">account_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Delete the account with the given id.&quot;&quot;&quot;</span>
    <span class="c1"># Find the account to delete</span>
    <span class="k">for</span> <span class="n">account</span> <span class="ow">in</span> <span class="n">accounts</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">account</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">account_id</span><span class="p">:</span>
            <span class="c1"># Remove the account from the list</span>
            <span class="n">accounts</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">account</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Account </span><span class="si">{</span><span class="n">account_id</span><span class="si">}</span><span class="s2"> deleted successfully&quot;</span><span class="p">}</span>
    <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">404</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Account not found&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This is a simple example of how you might implement a <code class="docutils literal notranslate"><span class="pre">DELETE</span></code> route to delete
an account. A DELETE request to <code class="docutils literal notranslate"><span class="pre">/accounts/{account_id}</span></code> will delete the
specified account.</p>
<p>You can test this route with a <code class="docutils literal notranslate"><span class="pre">curl</span></code> command like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>DELETE<span class="w"> </span>http://127.0.0.1:8000/accounts/1
</pre></div>
</div>
<p>Here’s what each part does:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">curl</span></code>: This is the command-line tool used to send HTTP requests.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-X</span> <span class="pre">DELETE</span></code>: This option specifies the HTTP method of the request, which in
this case is DELETE. DELETE is typically used for deleting an existing
resource.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">http://127.0.0.1:8000/accounts/1</span></code>: This is the URL that the request is sent
to. In this case, it’s the local address (<code class="docutils literal notranslate"><span class="pre">127.0.0.1</span></code>, also known as
<code class="docutils literal notranslate"><span class="pre">localhost</span></code>) and port <code class="docutils literal notranslate"><span class="pre">8000</span></code>, followed by the <code class="docutils literal notranslate"><span class="pre">/accounts/1</span></code> endpoint. This
endpoint corresponds to the account with the ID of 1.</p></li>
</ul>
<p>When you run this <code class="docutils literal notranslate"><span class="pre">curl</span></code> command, it sends an HTTP DELETE request to our FastAPI
application. The application should then delete the account with the ID of 1. If
everything goes as expected, the server should respond with a message indicating
the account was successfully deleted.</p>
</section>
</section>
<section id="headers">
<h3><a class="toc-backref" href="#id30" role="doc-backlink">Headers</a><a class="headerlink" href="#headers" title="Link to this heading">#</a></h3>
<p>These provide metadata about the request or response. For example, headers can
be used to specify the format of the data being sent or received (such as JSON),
set cookies, control caching, authenticate the user, and more.</p>
<p>HTTP headers are an important part of the HTTP protocol. They’re used to
transmit additional information about the HTTP request or response. HTTP headers
are represented as key-value pairs that are passed along with the request or
response body.</p>
<p>In the context of the curl commands that we discussed, the headers are specified
using the <code class="docutils literal notranslate"><span class="pre">-H</span></code> flag followed by the header name and its value.</p>
<p>Let’s look at the command you provided:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span><span class="s2">&quot;http://localhost:8000/accounts&quot;</span><span class="w"> </span><span class="se">\ </span><span class="c1"># method and URI</span>
<span class="w">     </span>-H<span class="w"> </span><span class="s2">&quot;accept: application/json&quot;</span><span class="w"> </span><span class="c1"># header, client expects response in JSON</span>
</pre></div>
</div>
<p>Here, <code class="docutils literal notranslate"><span class="pre">-H</span> <span class="pre">&quot;accept:</span> <span class="pre">application/json&quot;</span></code> is a header. This specific header,
<code class="docutils literal notranslate"><span class="pre">accept:</span> <span class="pre">application/json</span></code>, tells the server that the client (in this case, the
curl command) expects the response data to be in JSON format.</p>
<p>Similarly, in the command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span><span class="s2">&quot;http://localhost:8000/accounts&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">     </span>-H<span class="w"> </span><span class="s2">&quot;accept: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">     </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">     </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;name&quot;: &quot;Alice&quot;, &quot;email&quot;: &quot;alice@example.com&quot;, &quot;balance&quot;: 300.0}&#39;</span>
</pre></div>
</div>
<p>We have two headers: <code class="docutils literal notranslate"><span class="pre">accept:</span> <span class="pre">application/json</span></code> and
<code class="docutils literal notranslate"><span class="pre">Content-Type:</span> <span class="pre">application/json</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">accept:</span> <span class="pre">application/json</span></code> header, as before, tells the server that the
client expects the response data to be in JSON format.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">Content-Type:</span> <span class="pre">application/json</span></code> header tells the server that the data being
sent by the client (i.e., the request body) is in JSON format.</p>
<p>These headers help ensure that both the client and the server understand the
format of the data being exchanged.</p>
<p>This is a simplified explanation. In practice, HTTP headers can be used to
convey a wide range of information, such as user agent information,
authentication tokens, instructions for caching, and much more.</p>
<section id="authorization-authentication">
<h4><a class="toc-backref" href="#id31" role="doc-backlink">Authorization/Authentication</a><a class="headerlink" href="#authorization-authentication" title="Link to this heading">#</a></h4>
<p>If you’re implementing an authentication system, you’ll likely need to work with
headers. For example, a common pattern is to use the Authorization header to
transmit bearer tokens.</p>
</section>
</section>
<section id="body">
<h3><a class="toc-backref" href="#id32" role="doc-backlink">Body</a><a class="headerlink" href="#body" title="Link to this heading">#</a></h3>
<p>For some types of requests (like POST and PUT), you need to send additional data
along with the request. This data goes in the request body. For example, if
you’re creating a new account via a POST request, the details of the account
(like the account name and initial balance) would be sent in the request body.</p>
<p>For example, consider the following curl command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span><span class="s2">&quot;http://localhost:8000/accounts&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">     </span>-H<span class="w"> </span><span class="s2">&quot;accept: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">     </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">     </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;name&quot;: &quot;Alice&quot;, &quot;email&quot;: &quot;alice@example.com&quot;, &quot;balance&quot;: 300.0}&#39;</span>
</pre></div>
</div>
<p>In this case, the <code class="docutils literal notranslate"><span class="pre">-d</span></code> option is used to specify the body of the request. The
data is a JSON object:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Alice&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;alice@example.com&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;balance&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">300.0</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This JSON object contains the data for the new account to be created. The server
will read this data from the body of the request and use it to create the new
account.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">Content-Type:</span> <span class="pre">application/json</span></code> header tells the server that the request
body is formatted as JSON.</p>
<p>In the context of FastAPI, the body of the request is typically represented as a
Pydantic model. FastAPI will automatically parse the request body as JSON and
validate it against the Pydantic model. This provides automatic request
validation and serialization.</p>
<blockquote>
<div><p>Intuitively, body is nothing but the content after <code class="docutils literal notranslate"><span class="pre">-d</span></code> which for instance, if
I want to create a new account, is just the json content specified after <code class="docutils literal notranslate"><span class="pre">-d</span></code>.</p>
</div></blockquote>
</section>
</section>
<section id="response">
<h2><a class="toc-backref" href="#id33" role="doc-backlink">Response</a><a class="headerlink" href="#response" title="Link to this heading">#</a></h2>
<p>After the server processes the request, it sends a response back to the client.
This response contains the following components:</p>
<ul class="simple">
<li><p><strong>Status Line:</strong> This includes the HTTP version, status code, and a short
message explaining the status code.</p></li>
<li><p><strong>Headers:</strong> These provide metadata about the response, such as the content
type of the response body, set cookies, and more.</p></li>
<li><p><strong>Body:</strong> This is the actual data returned by the server. It could contain
the data requested by a GET request, a confirmation of successful processing
for a POST or PUT request, error details in case of a failure, or it could
be empty.</p></li>
</ul>
<p>The response body is where you’ll find the results of our request. For instance,
if you’re fetching data from an API, the response body will contain the
requested data. If you’re posting data to an API, the response body will usually
contain a status message or the ID of the created resource.</p>
<p>For instance:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span>http://localhost:8000/accounts/1
</pre></div>
</div>
<p>will return:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;John Doe&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;johndoe@gmail.com&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;balance&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">100.0</span>
<span class="p">}</span>
</pre></div>
</div>
<p>and this is the <strong>body response</strong> returned by the server.</p>
<p>Just like requests, responses also have headers. Response headers provide
metadata about the response itself. They can include fields like <code class="docutils literal notranslate"><span class="pre">Content-Type</span></code>
(the format of the response body), <code class="docutils literal notranslate"><span class="pre">Content-Length</span></code> (the length of the response
body in bytes), and <code class="docutils literal notranslate"><span class="pre">Set-Cookie</span></code> (to send cookies from the server to the
client).</p>
<p>If you want to see the response headers as well as the response status, you can
use the <code class="docutils literal notranslate"><span class="pre">-i</span></code> or <code class="docutils literal notranslate"><span class="pre">--include</span></code> option:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>--include<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span>http://localhost:8000/accounts/1
</pre></div>
</div>
<p>which outputs</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>HTTP/1.1 200 OK
date: Fri, 04 Aug 2023 10:03:41 GMT
server: uvicorn
content-length: 70
content-type: application/json

{&quot;id&quot;:1,&quot;name&quot;:&quot;John Doe&quot;,&quot;email&quot;:&quot;johndoe@gmail.com&quot;,&quot;balance&quot;:100.0}%
</pre></div>
</div>
<p>A key part of the response is the status code. This is a three-digit code that
indicates the result of the request. Here are some common status codes:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Status Code</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>200</p></td>
<td><p>OK - The request was successful.</p></td>
</tr>
<tr class="row-odd"><td><p>201</p></td>
<td><p>Created - The request was successful and a resource was created as a result. This is typically the response sent after POST requests.</p></td>
</tr>
<tr class="row-even"><td><p>204</p></td>
<td><p>No Content - The request was successful, but there is no representation to return (i.e. the response is empty).</p></td>
</tr>
<tr class="row-odd"><td><p>400</p></td>
<td><p>Bad Request - The request could not be understood or was missing required parameters.</p></td>
</tr>
<tr class="row-even"><td><p>401</p></td>
<td><p>Unauthorized - Authentication failed or was not provided.</p></td>
</tr>
<tr class="row-odd"><td><p>403</p></td>
<td><p>Forbidden - Authentication succeeded but the authenticated user does not have access to the requested resource.</p></td>
</tr>
<tr class="row-even"><td><p>404</p></td>
<td><p>Not Found - The requested resource could not be found.</p></td>
</tr>
<tr class="row-odd"><td><p>500</p></td>
<td><p>Internal Server Error - An error occurred on the server.</p></td>
</tr>
</tbody>
</table>
</div>
<p>The response from the server is crucial for understanding the status of our
request. It tells you whether our request was successful and provides the
requested data or helpful error messages if something went wrong. By reading the
response status, headers, and body, you can understand the result of our request
and take appropriate action in our application.</p>
</section>
<section id="filter">
<h2><a class="toc-backref" href="#id34" role="doc-backlink">Filter</a><a class="headerlink" href="#filter" title="Link to this heading">#</a></h2>
<p>Recall the URI we have seen in URI section:</p>
<pre class="output ai-center-all" style="padding-left: 0rem; padding-right: 0rem; font-weight: 600;"><span style="color:#d63939">https://</span><span style="color:#206bc4">localhost:</span><span style="color: #4299e1">8000</span><span style="color:#2fb344">/models/{modelId}/</span><span style="color:#ae3ec9">?filter=passed</span><span style="color:#f76707">#details</span>
</pre>
<p>We have seen up until <code class="docutils literal notranslate"><span class="pre">{modelId}</span></code> but have no clue what is the <code class="docutils literal notranslate"><span class="pre">?filter=passed</span></code>.</p>
<p>Consider this, let’s create a new <code class="docutils literal notranslate"><span class="pre">GET</span></code> route to filter accounts based on their
balance. We’ll return only the accounts that have a balance greater than a
specified amount. This amount will be provided as a query parameter in the URL.
In this way it is a way to filter the data.</p>
<p>Here’s the new route:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/accounts/</span><span class="si">{account_id}</span><span class="s2">/filter&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">filter_accounts</span><span class="p">(</span>
    <span class="n">min_balance</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return accounts with balance greater than the specified amount.&quot;&quot;&quot;</span>
    <span class="n">filtered_accounts</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">account</span> <span class="k">for</span> <span class="n">account</span> <span class="ow">in</span> <span class="n">accounts</span> <span class="k">if</span> <span class="n">account</span><span class="p">[</span><span class="s2">&quot;balance&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">min_balance</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="n">filtered_accounts</span>
</pre></div>
</div>
<p>With this route, you can send a <code class="docutils literal notranslate"><span class="pre">GET</span></code> request to
<code class="docutils literal notranslate"><span class="pre">/accounts/filter?min_balance=200</span></code> to get all accounts with a balance greater
than 200.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span><span class="s1">&#39;GET&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="s1">&#39;http://127.0.0.1:8000/accounts/{account_id}/filter?min_balance=10.0&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s1">&#39;accept: application/json&#39;</span>
</pre></div>
</div>
<p>This example demonstrates how you can use query parameters to filter data in a
REST API. Note that the <code class="docutils literal notranslate"><span class="pre">min_balance</span></code> parameter in the function signature is
automatically interpreted as a query parameter by FastAPI because it has a
default value.</p>
<p>One warning is that the route must be after <code class="docutils literal notranslate"><span class="pre">{account_id}</span></code>. If you put filter
after accounts, it will be interpreted as a path parameter instead of a query
parameter and you’ll get an error <code class="docutils literal notranslate"><span class="pre">422</span> <span class="pre">Unprocessable</span> <span class="pre">Entity</span></code>.</p>
</section>
<section id="model-view-controller-mvc">
<h2><a class="toc-backref" href="#id35" role="doc-backlink">Model-View-Controller (MVC)</a><a class="headerlink" href="#model-view-controller-mvc" title="Link to this heading">#</a></h2>
<p>While the code we’ve written so far works, it’s not very organized. All the
routes are in one file, and the logic for each route is mixed in with the
request and response code. This is fine for a small application, but as our
application grows, it will become harder to maintain.</p>
<section id="understanding-the-model-view-controller-mvc-framework">
<h3><a class="toc-backref" href="#id36" role="doc-backlink">Understanding the Model-View-Controller (MVC) Framework</a><a class="headerlink" href="#understanding-the-model-view-controller-mvc-framework" title="Link to this heading">#</a></h3>
<p>The Model-View-Controller (MVC) framework is a design pattern widely used in web
development. It separates the application into three interconnected components,
allowing for efficient code organization and modular development. These
components are:</p>
<ol class="arabic simple">
<li><p><strong>Model:</strong> This component handles the data logic of the application. It
interacts with the database or data storage to create, read, update, and
delete (CRUD) data. The model is oblivious to the user interface. In terms of
a FastAPI application, this could be the SQLAlchemy models defining the
structure of our data and handling data storage and retrieval.</p></li>
<li><p><strong>View:</strong> The view component presents data to the user in a human-readable
format. It’s all about the presentation and how the data is displayed. In a
traditional web application, this would be the HTML templates that get
rendered to the user. In a FastAPI application, this could be considered the
JSON responses that are returned to the client, built using Pydantic models.</p></li>
<li><p><strong>Controller:</strong> The controller acts as an intermediary between the model and
the view. It processes HTTP requests, triggers the data persistence models,
and sends a response to the client. In other words, it handles the
application’s business logic. In a FastAPI application, this would be our
route functions (also called view functions or endpoints) that process
requests and return responses.</p></li>
</ol>
<p>Here’s a simple way to understand how these components interact:</p>
<ul class="simple">
<li><p>The <strong>user</strong> interacts with the <strong>view</strong> component via the user interface.</p></li>
<li><p>The <strong>view</strong> sends the user’s actions as requests to the <strong>controller</strong>.</p></li>
<li><p>The <strong>controller</strong> processes the requests and interacts with the <strong>model</strong>
to perform CRUD operations.</p></li>
<li><p>The <strong>model</strong> returns any requested data back to the <strong>controller</strong>.</p></li>
<li><p>The <strong>controller</strong> passes this data to the <strong>view</strong>.</p></li>
<li><p>The <strong>view</strong> displays this data to the <strong>user</strong>.</p></li>
</ul>
<p>In this way, the MVC framework separates concerns into distinct components,
making it easier to manage complex applications. You can work on individual
components without affecting others, which makes debugging and testing more
straightforward and improves the application’s scalability and maintainability.</p>
<p>Now, one way we can restructure our FastAPI application is to use the MVC
framework. We can separate our application into three components: models, views,
and controllers. This will help us organize our code and make it easier to
maintain and scale.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>.
├── README.md
├── app.py
├── requirements.txt
└── app
    ├── __init__.py
    ├── main.py (this is where you create our FastAPI app instance)
    ├── models
    │   ├── __init__.py
    │   ├── account.py
    │   └── transaction.py
    ├── schemas
    │   ├── __init__.py
    │   ├── account.py
    │   └── transaction.py
    ├── views (or controllers)
    │   ├── __init__.py
    │   ├── account_views.py
    │   └── transaction_views.py
    └── database
        ├── __init__.py
        ├── database.py (this is where you manage our database session)
        └── seed_database.py
</pre></div>
</div>
<p>Here’s what each part does:</p>
<ul class="simple">
<li><p><strong>models</strong>: This is where you define our SQLAlchemy models (i.e., our data
structures). These are equivalent to the “models” in MVC or MVT.</p></li>
<li><p><strong>schemas</strong>: This is where you define our Pydantic models, which you use for
request validation and response serialization.</p></li>
<li><p><strong>views</strong> (or controllers): This is where you define our routes (i.e., our
view functions or controllers). These are the “views” in MVC or the
“controllers” in other patterns. Each file in this directory would contain
the routes related to a specific resource. For instance, <code class="docutils literal notranslate"><span class="pre">account_views.py</span></code>
might contain routes like <code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/accounts</span></code>, <code class="docutils literal notranslate"><span class="pre">POST</span> <span class="pre">/accounts</span></code>, etc.</p></li>
<li><p><strong>database</strong>: This is where you manage our database session and perform
database operations. In MVC, these operations are often included in the
models, but in many modern web applications, it’s common to separate them
out into their own layer.</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">app.py</span></code> file at the root of our project is the entry point for our
application. This is where you import and include the routers from our views and
start our ASGI server (e.g., Uvicorn).</p>
</section>
<section id="database-session-management">
<h3><a class="toc-backref" href="#id37" role="doc-backlink">Database Session Management</a><a class="headerlink" href="#database-session-management" title="Link to this heading">#</a></h3>
<p>When building an application, especially one that relies on persistent storage
like a database, it’s crucial to set up a reliable and efficient connection
mechanism. The <code class="docutils literal notranslate"><span class="pre">database.py</span></code> file typically serves as the backbone for this. Its
primary responsibilities are:</p>
<ol class="arabic simple">
<li><p><strong>Establishing a Connection</strong>: It sets up a way for our application to talk
to the database.</p></li>
<li><p><strong>Managing Sessions</strong>: Databases use sessions to encapsulate sequences of
operations. The <code class="docutils literal notranslate"><span class="pre">database.py</span></code> file sets up a mechanism to create and manage
these sessions.</p></li>
</ol>
<p>Let’s break down its components:</p>
<section id="the-engine">
<h4><a class="toc-backref" href="#id38" role="doc-backlink">1. The Engine</a><a class="headerlink" href="#the-engine" title="Link to this heading">#</a></h4>
<p>The engine is the starting point for any SQLAlchemy application. It’s the home
base for the actual database and its DBAPI, delivered to the SQLAlchemy
application through a connection pool and a Dialect.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">api.conf.base</span> <span class="kn">import</span> <span class="n">SQLALCHEMY_DATABASE_URL</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">Session</span><span class="p">,</span> <span class="n">sessionmaker</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="n">SQLALCHEMY_DATABASE_URL</span><span class="p">)</span>
<span class="n">SessionLocal</span> <span class="o">=</span> <span class="n">sessionmaker</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong><code class="docutils literal notranslate"><span class="pre">create_engine</span></code></strong>: This function initializes the connection to the
database and sets up a pool of connections. The connections in this pool are
reused whenever an operation needs to talk to the database.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">SQLALCHEMY_DATABASE_URL</span></code></strong>: It’s the connection string that tells
SQLAlchemy how to connect to our database. Its format varies depending on
the type of database you’re using (Postgres, SQLite, MySQL, etc.).</p></li>
</ul>
</section>
<section id="session-factory">
<h4><a class="toc-backref" href="#id39" role="doc-backlink">2. Session Factory</a><a class="headerlink" href="#session-factory" title="Link to this heading">#</a></h4>
<p>In SQLAlchemy, the Session is the primary interface for persistence operations.
It provides the entry point to acquire a new Session when you wish to operate on
the database.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">sessionmaker</span>

<span class="n">SessionLocal</span> <span class="o">=</span> <span class="n">sessionmaker</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong><code class="docutils literal notranslate"><span class="pre">sessionmaker</span></code></strong>: This function creates a factory that you’ll use to get
new database sessions. The <code class="docutils literal notranslate"><span class="pre">bind=engine</span></code> argument binds the session factory
to our engine, meaning sessions created with this factory will use the
connection pool from our engine.</p></li>
</ul>
</section>
<section id="dependency-to-get-a-session">
<h4><a class="toc-backref" href="#id40" role="doc-backlink">3. Dependency to get a Session</a><a class="headerlink" href="#dependency-to-get-a-session" title="Link to this heading">#</a></h4>
<p><a class="reference external" href="https://fastapi.tiangolo.com/tutorial/sql-databases/">FastAPI</a> provides a very
intuitive way to manage database sessions using dependencies. The <code class="docutils literal notranslate"><span class="pre">get_db</span></code>
function is one such dependency.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">Session</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Generator</span>

<span class="k">def</span> <span class="nf">get_db</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">Session</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
    <span class="n">db</span> <span class="o">=</span> <span class="n">SessionLocal</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">db</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<ul class="simple">
<li><p>This function uses the <code class="docutils literal notranslate"><span class="pre">SessionLocal</span></code> factory we defined earlier to get a
new session.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">yield</span></code> keyword in the function makes it a generator. When this function
is called, it sets up the database session and then yields it. Once the
request is done and the response is sent, the code after <code class="docutils literal notranslate"><span class="pre">yield</span></code> runs, which
in this case, closes the session.</p></li>
</ul>
<p>By setting up our <code class="docutils literal notranslate"><span class="pre">database.py</span></code> file in this way, you’re ensuring efficient use
of resources, a clear separation of concerns, and a structured way to access and
manage our database connections throughout our application.</p>
</section>
<section id="singleton-pattern">
<h4><a class="toc-backref" href="#id41" role="doc-backlink">Singleton Pattern</a><a class="headerlink" href="#singleton-pattern" title="Link to this heading">#</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">create_engine</span></code> and <code class="docutils literal notranslate"><span class="pre">sessionmaker</span></code> functions should generally be called once
during the lifecycle of our application. Here’s why:</p>
<ol class="arabic simple">
<li><p><strong><code class="docutils literal notranslate"><span class="pre">create_engine</span></code></strong>: This function initializes a connection pool to our
database. By calling it once, you can ensure that our application reuses
these connections, which can significantly improve performance. If you were
to call <code class="docutils literal notranslate"><span class="pre">create_engine</span></code> multiple times, you might end up creating multiple
connection pools, which would be wasteful and could lead to unexpected
behavior.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">sessionmaker</span></code></strong>: This function creates a factory for producing new
database sessions. Once you’ve bound it to an engine, you can use the
resulting factory to create new sessions as needed.</p></li>
</ol>
<p>For these reasons, it’s common to see these lines of code at the module level
(outside of any function or class) in a dedicated database configuration file.
This ensures they are called once when the module is first imported.</p>
<p>Here’s a possible structure:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>.
├── main.py  (or app.py)
├── database
│   ├── __init__.py
│   ├── session.py   (This is where you can set up our engine, SessionLocal, etc.)
│   ├── base.py  (Optional: If you&#39;re using a Base class for our ORM models)
│   └── models
│       ├── __init__.py
│       ├── account.py
│       └── transaction.py
├── schemas
│   ├── __init__.py
│   ├── account.py
│   └── transaction.py
├── views (or controllers)
│   ├── __init__.py
│   ├── account_views.py
│   └── transaction_views.py
└── ...
</pre></div>
</div>
<p>In <code class="docutils literal notranslate"><span class="pre">session.py</span></code>, you might have:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">sessionmaker</span>

<span class="n">SQLALCHEMY_DATABASE_URL</span> <span class="o">=</span> <span class="s2">&quot;your_connection_string_here&quot;</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="n">SQLALCHEMY_DATABASE_URL</span><span class="p">)</span>
<span class="n">SessionLocal</span> <span class="o">=</span> <span class="n">sessionmaker</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>
</pre></div>
</div>
<p>Then, whenever you need a session elsewhere in our code, you would import
<code class="docutils literal notranslate"><span class="pre">SessionLocal</span></code> from this module.</p>
</section>
</section>
<section id="id1">
<h3><a class="toc-backref" href="#id42" role="doc-backlink">Models</a><a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<p>In the context of software applications, particularly those following the MVC
(Model-View-Controller) or similar design patterns, a model is a representation
of a data structure. Essentially, models are blueprints for creating database
tables. They define what kind of data an application will store, how that data
is accessed, and how it relates to other data.</p>
<section id="sqlalchemy-models">
<h4><a class="toc-backref" href="#id43" role="doc-backlink">SQLAlchemy Models</a><a class="headerlink" href="#sqlalchemy-models" title="Link to this heading">#</a></h4>
<p>SQLAlchemy is an Object Relational Mapping (ORM) library for Python, which means
it allows you to work with relational databases in a more Pythonic way. Instead
of writing SQL queries, you can use Python classes and methods to interact with
our database.</p>
<p>In our provided code, you’ve defined two SQLAlchemy models: <code class="docutils literal notranslate"><span class="pre">Account</span></code> and
<code class="docutils literal notranslate"><span class="pre">Transaction</span></code>. Let’s break down what each part does:</p>
<ol class="arabic">
<li><p><strong>Base Class</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">api.database.base</span> <span class="kn">import</span> <span class="n">Base</span>
</pre></div>
</div>
<p>This <code class="docutils literal notranslate"><span class="pre">Base</span></code> class is a base class for all our models, provided by
SQLAlchemy. It’s a foundational piece that provides ORM capabilities to our
derived models.</p>
</li>
<li><p><strong>Account Model</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Account</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>Here, you’ve defined a model for an account. Each account has an <code class="docutils literal notranslate"><span class="pre">id</span></code>,
<code class="docutils literal notranslate"><span class="pre">name</span></code>, <code class="docutils literal notranslate"><span class="pre">email</span></code>, and <code class="docutils literal notranslate"><span class="pre">balance</span></code>. The <code class="docutils literal notranslate"><span class="pre">__tablename__</span></code> attribute tells
SQLAlchemy what the table’s name should be in the database.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">relationship</span></code> function defines how this model relates to others. Here,
it says that an account can have multiple transactions.</p>
</li>
<li><p><strong>Transaction Model</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Transaction</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>This model represents a transaction. Each transaction has an <code class="docutils literal notranslate"><span class="pre">id</span></code>,
<code class="docutils literal notranslate"><span class="pre">account_id</span></code>, <code class="docutils literal notranslate"><span class="pre">amount</span></code>, <code class="docutils literal notranslate"><span class="pre">type</span></code>, and <code class="docutils literal notranslate"><span class="pre">timestamp</span></code>. The <code class="docutils literal notranslate"><span class="pre">account_id</span></code> is a
foreign key that links each transaction to an account.</p>
<p>Again, the <code class="docutils literal notranslate"><span class="pre">relationship</span></code> function is used, this time to say that a
transaction is related to an account.</p>
</li>
</ol>
</section>
<section id="relationships-in-sqlalchemy">
<h4><a class="toc-backref" href="#id44" role="doc-backlink">Relationships in SQLAlchemy</a><a class="headerlink" href="#relationships-in-sqlalchemy" title="Link to this heading">#</a></h4>
<p>The relationships between <code class="docutils literal notranslate"><span class="pre">Account</span></code> and <code class="docutils literal notranslate"><span class="pre">Transaction</span></code> models are defined using
the <code class="docutils literal notranslate"><span class="pre">relationship</span></code> function. This function is powerful and provides a way to
define how different models are related in terms of the database.</p>
<p>In our models:</p>
<ul>
<li><p>An <code class="docutils literal notranslate"><span class="pre">Account</span></code> has a one-to-many relationship with <code class="docutils literal notranslate"><span class="pre">Transaction</span></code>, meaning one
account can have multiple transactions. This is represented by:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">transactions</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Transaction&quot;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s2">&quot;account&quot;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Conversely, a <code class="docutils literal notranslate"><span class="pre">Transaction</span></code> belongs to one <code class="docutils literal notranslate"><span class="pre">Account</span></code>. This is represented
by:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">account</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Account&quot;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s2">&quot;transactions&quot;</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">back_populates</span></code> argument ensures that changes to one side of the
relationship are propagated to the other side. So, if you access the
<code class="docutils literal notranslate"><span class="pre">transactions</span></code> attribute of an <code class="docutils literal notranslate"><span class="pre">Account</span></code> instance, SQLAlchemy will automatically
query and populate that attribute with the related <code class="docutils literal notranslate"><span class="pre">Transaction</span></code> instances. The
same happens in reverse when you access the <code class="docutils literal notranslate"><span class="pre">account</span></code> attribute of a
<code class="docutils literal notranslate"><span class="pre">Transaction</span></code> instance.</p>
<p>In conclusion, models play a crucial role in applications, especially in web
applications where data handling is a primary concern. They provide a structured
way to define, store, and retrieve data. With tools like SQLAlchemy, working
with models becomes intuitive and closely integrated with the programming
language, reducing the need for manual SQL queries and increasing productivity.</p>
</section>
</section>
<section id="views-or-controllers">
<h3><a class="toc-backref" href="#id45" role="doc-backlink">Views (or Controllers)</a><a class="headerlink" href="#views-or-controllers" title="Link to this heading">#</a></h3>
<p>In an MVC framework, the “view” is the component that handles the presentation
logic. However, in the context of a FastAPI application (or any API-driven
application), the term “view” might be a bit misleading. This is because APIs
generally don’t have a traditional “view” in the way that a typical web
application with HTML templates does. Instead, the “view” in a FastAPI
application could be considered the HTTP responses that the application returns
to the client.</p>
<p>However, in the scope of FastAPI (and other similar frameworks), the term
“controller” might be a better fit for this component. Controllers are
responsible for handling incoming HTTP requests and returning responses. They
contain the business logic of the application. In FastAPI, this translates to
our route functions or endpoints.</p>
<p>Let’s break down the various parts of a FastAPI controller.</p>
<section id="endpoints-or-route-functions">
<h4><a class="toc-backref" href="#id46" role="doc-backlink">Endpoints (or Route Functions)</a><a class="headerlink" href="#endpoints-or-route-functions" title="Link to this heading">#</a></h4>
<p>In FastAPI, an endpoint (also called a route function) is a Python function that
is decorated with one of the HTTP method decorators (like <code class="docutils literal notranslate"><span class="pre">&#64;app.get()</span></code>,
<code class="docutils literal notranslate"><span class="pre">&#64;app.post()</span></code>, etc.). These functions handle HTTP requests, perform the
necessary business logic, and return HTTP responses.</p>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">APIRouter</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">Session</span>
<span class="kn">from</span> <span class="nn">api.database.session</span> <span class="kn">import</span> <span class="n">get_db</span>

<span class="n">router</span> <span class="o">=</span> <span class="n">APIRouter</span><span class="p">()</span>

<span class="nd">@router</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/accounts&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_accounts</span><span class="p">(</span><span class="n">db</span><span class="p">:</span> <span class="n">Session</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_db</span><span class="p">)):</span>
    <span class="n">accounts</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Account</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">accounts</span>
</pre></div>
</div>
<p>In this example, <code class="docutils literal notranslate"><span class="pre">get_accounts</span></code> is an endpoint that handles HTTP GET requests to
the <code class="docutils literal notranslate"><span class="pre">/accounts</span></code> path. When the client makes a GET request to this path, FastAPI
calls the <code class="docutils literal notranslate"><span class="pre">get_accounts</span></code> function and returns whatever that function returns as
the HTTP response.</p>
<p>The function is using a parameter with a default value
(<code class="docutils literal notranslate"><span class="pre">db:</span> <span class="pre">Session</span> <span class="pre">=</span> <span class="pre">Depends(get_db)</span></code>). This parameter is a dependency. When FastAPI
sees this dependency, it will call the <code class="docutils literal notranslate"><span class="pre">get_db</span></code> function, get a database
session, and pass it as the argument to <code class="docutils literal notranslate"><span class="pre">get_accounts</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">get_accounts</span></code> function then uses the database session to query all accounts
and return them.</p>
</section>
<section id="apirouter">
<h4><a class="toc-backref" href="#id47" role="doc-backlink">APIRouter</a><a class="headerlink" href="#apirouter" title="Link to this heading">#</a></h4>
<p>FastAPI’s <code class="docutils literal notranslate"><span class="pre">APIRouter</span></code> is a powerful tool that allows you to separate our
endpoints into different modules, each with its own <code class="docutils literal notranslate"><span class="pre">APIRouter</span></code>. This makes our
code more modular and easier to maintain and scale. Each <code class="docutils literal notranslate"><span class="pre">APIRouter</span></code> can even
have its own dependencies, exception handlers, etc.</p>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">APIRouter</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">account_views</span><span class="p">,</span> <span class="n">transaction_views</span>

<span class="n">router</span> <span class="o">=</span> <span class="n">APIRouter</span><span class="p">()</span>

<span class="n">router</span><span class="o">.</span><span class="n">include_router</span><span class="p">(</span><span class="n">account_views</span><span class="o">.</span><span class="n">router</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;/accounts&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;accounts&quot;</span><span class="p">])</span>
<span class="n">router</span><span class="o">.</span><span class="n">include_router</span><span class="p">(</span><span class="n">transaction_views</span><span class="o">.</span><span class="n">router</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;/transactions&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;transactions&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>In this example, two different routers are included in the main router: one for
accounts and one for transactions. Each has its own prefix and tags.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">prefix</span></code> parameter adds a prefix to all the routes in the included router.
So, for the account views, all routes will start with <code class="docutils literal notranslate"><span class="pre">/accounts</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">tags</span></code> parameter groups all the routes in the included router under the
given tags. This is especially useful for interactive API docs UI like Swagger
UI or ReDoc.</p>
<p>Overall, the views (or controllers) are a crucial component of our FastAPI
application. They handle the request-response cycle and contain the business
logic of our application. FastAPI provides many powerful tools to structure and
organize our controllers, allowing for a clean and maintainable codebase.</p>
</section>
<section id="response-model-and-depends">
<h4><a class="toc-backref" href="#id48" role="doc-backlink">Response Model and Depends</a><a class="headerlink" href="#response-model-and-depends" title="Link to this heading">#</a></h4>
<p>Both <code class="docutils literal notranslate"><span class="pre">response_model</span></code> and <code class="docutils literal notranslate"><span class="pre">Depends</span></code> are important concepts in FastAPI.</p>
<p><strong><code class="docutils literal notranslate"><span class="pre">response_model</span></code></strong> is an optional parameter that you can pass to route
operations like <code class="docutils literal notranslate"><span class="pre">&#64;app.get()</span></code>, <code class="docutils literal notranslate"><span class="pre">&#64;app.post()</span></code>, etc. It’s used for:</p>
<ul class="simple">
<li><p>Output data conversion: The model’s data (e.g., a SQLAlchemy model instance)
will be publicly converted according to the <code class="docutils literal notranslate"><span class="pre">response_model</span></code>. For example,
if the data contains datetime, it will be converted to a string in ISO
format. This allows FastAPI to understand how to format the response data.</p></li>
<li><p>Output data validation: FastAPI will check the output data to make sure it’s
valid according to the model. If the data is not valid, FastAPI will raise
an error, and you can catch these errors while you’re still developing our
application.</p></li>
<li><p>API documentation: The model will be used to generate the “Response Model”
section of our API docs UI.</p></li>
</ul>
<p>For example, when you have <code class="docutils literal notranslate"><span class="pre">response_model=List[Account]</span></code>, it means that the
endpoint returns a list of Account instances, and FastAPI will handle converting
those instances to JSON.</p>
<p><strong><code class="docutils literal notranslate"><span class="pre">Depends()</span></code></strong> is a function that you use to express dependencies in FastAPI.
When you declare a parameter in a path operation function to be a
<code class="docutils literal notranslate"><span class="pre">Depends(get_db)</span></code>, FastAPI will:</p>
<ul class="simple">
<li><p>Call the <code class="docutils literal notranslate"><span class="pre">get_db</span></code> function.</p></li>
<li><p>Take the result of that call and pass it as the parameter’s value.</p></li>
</ul>
<p>This can be used for dependency injection, where you can provide necessary
resources to a function without the function needing to know where those
resources come from. In this case, <code class="docutils literal notranslate"><span class="pre">get_db</span></code> is a function that returns a
database session, so <code class="docutils literal notranslate"><span class="pre">Depends(get_db)</span></code> is a way of telling FastAPI “this
function depends on having a database session”.</p>
<p>FastAPI then knows to call <code class="docutils literal notranslate"><span class="pre">get_db</span></code> before calling our path operation function,
and to pass the database session that <code class="docutils literal notranslate"><span class="pre">get_db</span></code> returns into our function. This
can be very useful for ensuring that every request gets a fresh database
session, and for making sure that the session gets closed when the request is
finished.</p>
<p>One important note about <code class="docutils literal notranslate"><span class="pre">Depends</span></code>: it doesn’t just handle dependencies on
functions like <code class="docutils literal notranslate"><span class="pre">get_db</span></code>. You can also use it to declare dependencies on other
path operation functions. For example, if you have one path operation function
that shouldn’t run until another one has completed, you can use <code class="docutils literal notranslate"><span class="pre">Depends()</span></code> to
express that.</p>
</section>
</section>
</section>
<section id="references-and-further-readings">
<h2><a class="toc-backref" href="#id49" role="doc-backlink">References and Further Readings</a><a class="headerlink" href="#references-and-further-readings" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://fastapi.tiangolo.com/">FastAPI</a></p></li>
<li><p><a class="reference external" href="https://madewithml.com/courses/mlops/api/">Madewithml</a></p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./software_engineering/serving/restful_api"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="intro.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">RESTful API</p>
      </div>
    </a>
    <a class="right-next"
       href="../../../computer_science/type_theory/intro.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Type Theory, A Very Rudimentary Introduction</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#problem-statement">Problem Statement</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#models">Models</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#account-model">Account Model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-primary-key-is-automatically-incremented">The Primary Key is Automatically Incremented</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#transaction-model">Transaction Model</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#populate-the-database">Populate the Database</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#querying-the-database">Querying the Database</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-engine-session-and-base">The Engine, Session, and Base</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-relationship-defined-in-sqlalchemy">What is relationship defined in SQLAlchemy?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#session-vs-sessionlocal">Session vs. SessionLocal</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#object-relational-mapping-orm">Object-Relational Mapping (ORM)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#definition-and-intuition">Definition and Intuition</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analogy">Analogy</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example">Example</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-role-of-base-in-sqlalchemy-s-orm-system">The Role of Base in SQLAlchemy’s ORM System</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#moving-on-from-data-models-to-restful-api-endpoints">Moving on from Data (Models) to RESTful API (Endpoints)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#endpoints">Endpoints</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#running-the-fastapi-application">Running the FastAPI Application</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-s-async">What’s Async?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#request">Request</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#intuition">Intuition</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#uri">URI</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#http-methods">HTTP Methods</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#get-read">GET (Read)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#post-create">POST (Create)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#put-update">PUT (Update)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#delete-delete">DELETE (Delete)</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#headers">Headers</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#authorization-authentication">Authorization/Authentication</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#body">Body</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#response">Response</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#filter">Filter</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#model-view-controller-mvc">Model-View-Controller (MVC)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#understanding-the-model-view-controller-mvc-framework">Understanding the Model-View-Controller (MVC) Framework</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#database-session-management">Database Session Management</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#the-engine">1. The Engine</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#session-factory">2. Session Factory</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#dependency-to-get-a-session">3. Dependency to get a Session</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#singleton-pattern">Singleton Pattern</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Models</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#sqlalchemy-models">SQLAlchemy Models</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#relationships-in-sqlalchemy">Relationships in SQLAlchemy</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#views-or-controllers">Views (or Controllers)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#endpoints-or-route-functions">Endpoints (or Route Functions)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apirouter">APIRouter</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#response-model-and-depends">Response Model and Depends</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references-and-further-readings">References and Further Readings</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Gao Hongnan
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>