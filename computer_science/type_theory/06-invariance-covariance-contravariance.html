
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Invariance, Covariance and Contravariance &#8212; Omniverse</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css?v=4c969af8" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=87e54e7c" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=bb35926c" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script src="../../_static/tabs.js?v=3ee01567"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-MYW5YKC2WF"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-MYW5YKC2WF');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-MYW5YKC2WF');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'computer_science/type_theory/06-invariance-covariance-contravariance';</script>
    <link rel="canonical" href="https://www.gaohongnan.com/computer_science/type_theory/06-invariance-covariance-contravariance.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Function Overloading" href="07-pep-3124-overloading.html" />
    <link rel="prev" title="Bound and Constraint in Generics and Type Variables" href="05-typevar-bound-constraints.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo.png" class="logo__image only-light" alt="Omniverse - Home"/>
    <script>document.write(`<img src="../../_static/logo.png" class="logo__image only-dark" alt="Omniverse - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    🌌 Omniverse: A Journey Through Knowledge
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Notations</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../notations/machine_learning.html">Machine Learning Notations</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Influential Ideas and Papers</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../influential/generative_pretrained_transformer/01_intro.html">Generative Pre-trained Transformers</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../influential/generative_pretrained_transformer/02_notations.html">Notations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../influential/generative_pretrained_transformer/03_concept.html">The Concept of Generative Pre-trained Transformers (GPT)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../influential/generative_pretrained_transformer/04_implementation.html">The Implementation of Generative Pre-trained Transformers (GPT)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../influential/generative_pretrained_transformer/05_adder.html">Training a Mini-GPT to Learn Two-Digit Addition</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../influential/low_rank_adaptation/01_intro.html">Low-Rank Adaptation Of Large Language Models</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../influential/low_rank_adaptation/02_concept.html">Concept</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../influential/low_rank_adaptation/03_implementation.html">Implementation</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../influential/kmeans_clustering/01_intro.html">K-Means</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../influential/kmeans_clustering/02_concept.html">Concept: K-Means Clustering</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../influential/kmeans_clustering/03_implementation.html">Implementation: K-Means (Lloyd)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../influential/kmeans_clustering/04_image_segmentation.html">Application: Image Compression and Segmentation</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Playbook</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../playbook/how_to_calculate_flops_in_transformer_based_models.html">How to Calculate the Number of FLOPs in Transformer Based Models?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../playbook/how_to_inspect_function_and_class_signatures.html">How to Inspect Function and Class Signatures in Python?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../playbook/why_cosine_annealing_warmup_stabilize_training.html">Why Does Cosine Annealing With Warmup Stabilize Training?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../playbook/why_softmax_preserves_order_translation_invariant_not_invariant_scaling.html">Softmax Preserves Order, Is Translation Invariant But Not Invariant Under Scaling.</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../playbook/how_to_finetune_decoder_with_last_token_pooling.html">How To Fine-Tune Decoder-Only Models For Sequence Classification Using Last Token Pooling?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../playbook/how_to_finetune_decoder_with_cross_attention.html">How To Fine-Tune Decoder-Only Models For Sequence Classification With Cross-Attention?</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Operations</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../operations/machine_learning_lifecycle/00_intro.html">The Lifecycle of an AIOps System</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../operations/machine_learning_lifecycle/01_problem_formulation.html">Stage 1. Problem Formulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../operations/machine_learning_lifecycle/02_project_scoping.html">Stage 2. Project Scoping And Framing The Problem</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../operations/machine_learning_lifecycle/03_dataops_pipeline/03_dataops_pipeline.html">Stage 3. Data Pipeline (Data Engineering and DataOps)</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../operations/machine_learning_lifecycle/03_dataops_pipeline/031_data_source_and_format.html">Stage 3.1. Data Source and Formats</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../operations/machine_learning_lifecycle/03_dataops_pipeline/032_data_model_and_storage.html">Stage 3.2. Data Model and Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../operations/machine_learning_lifecycle/03_dataops_pipeline/033_etl.html">Stage 3.3. Extract, Transform, Load (ETL)</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../../operations/machine_learning_lifecycle/04_mlops_data_pipeline.html">Stage 4. Data Extraction (MLOps), Data Analysis (Data Science), Data Preparation (Data Science)</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../operations/machine_learning_lifecycle/05_model_development_selection_and_training/05_ml_training_pipeline.html">Stage 5. Model Development and Training (MLOps)</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../operations/machine_learning_lifecycle/05_model_development_selection_and_training/051_model_selection.html">Stage 5.1. Model Selection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../operations/machine_learning_lifecycle/05_model_development_selection_and_training/052_metric_selection.html">Stage 5.2. Metric Selection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../operations/machine_learning_lifecycle/05_model_development_selection_and_training/053_experiment_tracking.html">Stage 5.3. Experiment Tracking And Versioning</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../operations/machine_learning_lifecycle/05_model_development_selection_and_training/054_model_testing.html">Stage 5.4. Model Testing</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../operations/distributed/intro.html">Distributed Systems</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../operations/distributed/01_notations.html">Notations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../operations/distributed/02_basics.html">Basics Of Distributed Data Parallelism</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../operations/distributed/03_how_to_setup_slurm_in_aws.html">How to Setup SLURM and ParallelCluster in AWS</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Software Engineering</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../software_engineering/config_management/concept.html">Configuration Management</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../software_engineering/config_management/01-pydra.html">Pydantic And Hydra</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../software_engineering/config_management/02-state.html">State And Metadata Management</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../software_engineering/devops/continuous-integration/concept.html">Continuous Integration (CI) Workflow</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../software_engineering/devops/continuous-integration/styling.html">Styling, Formatting, and Linting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../software_engineering/devops/continuous-integration/testing.html">Testing</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../software_engineering/design_patterns/dependency-inversion-principle.html">Dependency Inversion Principle</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../software_engineering/concurrency_parallelism_asynchronous/intro.html">Concurrency, Parallelism and Asynchronous Programming</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../software_engineering/concurrency_parallelism_asynchronous/generator_yield.html">A Rudimentary Introduction to Generator and Yield in Python</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../software_engineering/serving/restful_api/intro.html">RESTful API</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../software_engineering/serving/restful_api/application_banking.html">Application: Designing a RESTful Banking API with FastAPI and SQLAlchemy</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Computer Science</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="intro.html">Type Theory, A Very Rudimentary Introduction</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="01-subtypes.html">Subtypes</a></li>
<li class="toctree-l2"><a class="reference internal" href="02-type-safety.html">Type Safety</a></li>
<li class="toctree-l2"><a class="reference internal" href="03-subsumption.html">Subsumption</a></li>
<li class="toctree-l2"><a class="reference internal" href="04-generics.html">Generics and Type Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="05-typevar-bound-constraints.html">Bound and Constraint in Generics and Type Variables</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Invariance, Covariance and Contravariance</a></li>
<li class="toctree-l2"><a class="reference internal" href="07-pep-3124-overloading.html">Function Overloading</a></li>
<li class="toctree-l2"><a class="reference internal" href="08-pep-661-sentinel-values.html">Sentinel Types</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Data Structures and Algorithms</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../dsa/complexity_analysis/intro.html">Complexity Analysis</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../dsa/complexity_analysis/master_theorem.html">Master Theorem </a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../dsa/stack/intro.html">Stack</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../dsa/stack/concept.html">Concept</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../dsa/searching_algorithms/linear_search/intro.html">Linear Search</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../dsa/searching_algorithms/linear_search/concept.html">Concept</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../dsa/searching_algorithms/binary_search/intro.html">Binary Search</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../dsa/searching_algorithms/binary_search/concept.html">Concept</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dsa/searching_algorithms/binary_search/problems/875-koko-eating-bananas.html">Koko Eating Bananas</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Linear Algebra</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../linear_algebra/01_preliminaries/intro.html">Preliminaries</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../linear_algebra/01_preliminaries/01-fields.html">Fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../linear_algebra/01_preliminaries/02-systems-of-linear-equations.html">Systems of Linear Equations</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../linear_algebra/02_vectors/intro.html">Vectors</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../linear_algebra/02_vectors/01-vector-definition.html">Vector and Its Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../linear_algebra/02_vectors/02-vector-operation.html">Vector and Its Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../linear_algebra/02_vectors/03-vector-norm.html">Vector Norm and Distance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../linear_algebra/02_vectors/04-vector-products.html">A First Look at Vector Products</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">References, Resources and Roadmap</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../bibliography.html">Bibliography</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../citations.html">IEEE (Style) Citations</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../api/reproducibility.html">API Reference</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/gao-hongnan/omniverse/blob/main/omniverse/computer_science/type_theory/06-invariance-covariance-contravariance.md" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/gao-hongnan/omniverse" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/gao-hongnan/omniverse/issues/new?title=Issue%20on%20page%20%2Fcomputer_science/type_theory/06-invariance-covariance-contravariance.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/computer_science/type_theory/06-invariance-covariance-contravariance.ipynb" target="_blank"
   class="btn btn-sm btn-download-notebook-button dropdown-item"
   title="Download notebook file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-code"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li><a href="../../_sources/computer_science/type_theory/06-invariance-covariance-contravariance.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Invariance, Covariance and Contravariance</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-motivation">The Motivation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-definitions">The Definitions</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#covariance">Covariance</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#contravariance">Contravariance</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#invariance">Invariance</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#list-is-invariant">List is Invariant</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Covariance</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Contravariance</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Invariance</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-connection-of-mutability-and-variance">The Connection of Mutability and Variance</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#list-vs-immutable-list">List vs Immutable List</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#drawing-some-connection-to-ordinary-functions">Drawing Some Connection to Ordinary Functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#contravariant-and-callable-types">Contravariant and Callable Types</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#callable-return-types-covariance">Callable Return Types (Covariance)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#callable-argument-types-contravariance">Callable Argument Types (Contravariance)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#real-world-examples-of-covariance-and-contravariance">Real World Examples of Covariance and Contravariance</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references-and-further-readings">References and Further Readings</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="invariance-covariance-and-contravariance">
<h1>Invariance, Covariance and Contravariance<a class="headerlink" href="#invariance-covariance-and-contravariance" title="Link to this heading">#</a></h1>
<p><a class="reference external" href="https://twitter.com/gaohongnan"><img alt="Twitter Handle" src="https://img.shields.io/badge/Twitter-&#64;gaohongnan-blue?style=social&amp;logo=twitter" /></a>
<a class="reference external" href="https://linkedin.com/in/gao-hongnan"><img alt="LinkedIn Profile" src="https://img.shields.io/badge/&#64;gaohongnan-blue?style=social&amp;logo=linkedin" /></a>
<a class="reference external" href="https://github.com/gao-hongnan"><img alt="GitHub Profile" src="https://img.shields.io/badge/GitHub-gao--hongnan-lightgrey?style=social&amp;logo=github" /></a>
<img alt="Tag" src="https://img.shields.io/badge/Tag-Brain_Dump-red" />
<img alt="Tag" src="https://img.shields.io/badge/Level-Beginner-green" /></p>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#the-motivation" id="id4">The Motivation</a></p></li>
<li><p><a class="reference internal" href="#the-definitions" id="id5">The Definitions</a></p>
<ul>
<li><p><a class="reference internal" href="#covariance" id="id6">Covariance</a></p></li>
<li><p><a class="reference internal" href="#contravariance" id="id7">Contravariance</a></p></li>
<li><p><a class="reference internal" href="#invariance" id="id8">Invariance</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#list-is-invariant" id="id9">List is Invariant</a></p>
<ul>
<li><p><a class="reference internal" href="#id1" id="id10">Covariance</a></p></li>
<li><p><a class="reference internal" href="#id2" id="id11">Contravariance</a></p></li>
<li><p><a class="reference internal" href="#id3" id="id12">Invariance</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#the-connection-of-mutability-and-variance" id="id13">The Connection of Mutability and Variance</a></p>
<ul>
<li><p><a class="reference internal" href="#list-vs-immutable-list" id="id14">List vs Immutable List</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#drawing-some-connection-to-ordinary-functions" id="id15">Drawing Some Connection to Ordinary Functions</a></p></li>
<li><p><a class="reference internal" href="#contravariant-and-callable-types" id="id16">Contravariant and Callable Types</a></p>
<ul>
<li><p><a class="reference internal" href="#callable-return-types-covariance" id="id17">Callable Return Types (Covariance)</a></p></li>
<li><p><a class="reference internal" href="#callable-argument-types-contravariance" id="id18">Callable Argument Types (Contravariance)</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#real-world-examples-of-covariance-and-contravariance" id="id19">Real World Examples of Covariance and Contravariance</a></p></li>
<li><p><a class="reference internal" href="#references-and-further-readings" id="id20">References and Further Readings</a></p></li>
</ul>
</nav>
<section id="the-motivation">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">The Motivation</a><a class="headerlink" href="#the-motivation" title="Link to this heading">#</a></h2>
<p>This section is not particulary easy. So let’s open with an example, a classic
one written by the author of Python, Guido van Rossum.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">def</span> <span class="nf">append_pi</span><span class="p">(</span><span class="n">lst</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">2</span>    <span class="n">lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">3.14</span><span class="p">)</span> <span class="c1"># original is lst += [3.14]</span>
<span class="linenos">3</span>
<span class="linenos">4</span><span class="n">my_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>  <span class="c1"># type: List[int]</span>
<span class="linenos">5</span>
<span class="linenos">6</span><span class="n">_</span> <span class="o">=</span> <span class="n">append_pi</span><span class="p">(</span><span class="n">my_list</span><span class="p">)</span>   <span class="c1"># Naively, this should be safe..</span>
<span class="linenos">7</span><span class="n">pprint</span><span class="p">(</span><span class="n">my_list</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.14</span><span style="font-weight: bold">]</span>
</pre>
</div></div>
</div>
<p>The function <code class="docutils literal notranslate"><span class="pre">append_pi</span></code> is supposed to append the value of <span class="math notranslate nohighlight">\(\pi\)</span> to the list
<code class="docutils literal notranslate"><span class="pre">lst</span></code>. However, the type of <code class="docutils literal notranslate"><span class="pre">lst</span></code> is <code class="docutils literal notranslate"><span class="pre">List[float]</span></code>, and the type of <code class="docutils literal notranslate"><span class="pre">my_list</span></code> is
<code class="docutils literal notranslate"><span class="pre">List[int]</span></code>. The function <code class="docutils literal notranslate"><span class="pre">append_pi</span></code> is supposed to be safe, but it is not. Why
not? Isn’t <code class="docutils literal notranslate"><span class="pre">int</span></code> (integers <span class="math notranslate nohighlight">\(\mathbb{Z}\)</span>) a subtype of <code class="docutils literal notranslate"><span class="pre">float</span></code> (real numbers
<span class="math notranslate nohighlight">\(\mathbb{R}\)</span>)? Did we not establish this in the section on subsumption?</p>
<p>Yes, we did. However, <code class="docutils literal notranslate"><span class="pre">int</span></code> being a subtype of <code class="docutils literal notranslate"><span class="pre">float</span></code> does not imply that
<code class="docutils literal notranslate"><span class="pre">List[int]</span></code> is a subtype of <code class="docutils literal notranslate"><span class="pre">List[float]</span></code>. Upon reflection, this makes sense,
because the above code would break the second criterion of subtyping (
<a class="reference internal" href="03-subsumption.html#type-theory-subtype-criterion">Criterion 3</a>). The second criterion states that the
if the type <span class="math notranslate nohighlight">\(S\)</span> is a subtype of <span class="math notranslate nohighlight">\(T\)</span>, then if <span class="math notranslate nohighlight">\(T\)</span> has <span class="math notranslate nohighlight">\(N\)</span> methods, then <span class="math notranslate nohighlight">\(S\)</span> must
have at least the same set of <span class="math notranslate nohighlight">\(N\)</span> methods. Furthermore, it must preserve the
semantics of the functions. Let’s build a mental model to understand why this is
the case. Consider the python implementation of <code class="docutils literal notranslate"><span class="pre">List</span></code>,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">_T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;_T&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">list</span><span class="p">(</span><span class="n">MutableSequence</span><span class="p">[</span><span class="n">_T</span><span class="p">]):</span>
    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>
    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__iterable</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">_T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>
    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">_T</span><span class="p">]:</span> <span class="o">...</span>
    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__object</span><span class="p">:</span> <span class="n">_T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>
    <span class="k">def</span> <span class="nf">extend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__iterable</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">_T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>
    <span class="k">def</span> <span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__index</span><span class="p">:</span> <span class="n">SupportsIndex</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="p">:</span> <span class="o">...</span>
    <span class="c1"># Signature of `list.index` should be kept in line with `collections.UserList.index()`</span>
    <span class="c1"># and multiprocessing.managers.ListProxy.index()</span>
    <span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__value</span><span class="p">:</span> <span class="n">_T</span><span class="p">,</span> <span class="n">__start</span><span class="p">:</span> <span class="n">SupportsIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">__stop</span><span class="p">:</span> <span class="n">SupportsIndex</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span> <span class="o">...</span>
    <span class="k">def</span> <span class="nf">count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__value</span><span class="p">:</span> <span class="n">_T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span> <span class="o">...</span>
    <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__index</span><span class="p">:</span> <span class="n">SupportsIndex</span><span class="p">,</span> <span class="n">__object</span><span class="p">:</span> <span class="n">_T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>
    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__value</span><span class="p">:</span> <span class="n">_T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>
    <span class="c1"># Signature of `list.sort` should be kept inline with `collections.UserList.sort()`</span>
    <span class="c1"># and multiprocessing.managers.ListProxy.sort()</span>
    <span class="c1">#</span>
    <span class="c1"># Use list[SupportsRichComparisonT] for the first overload rather than [SupportsRichComparison]</span>
    <span class="c1"># to work around invariance</span>
    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="nf">sort</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">SupportsRichComparisonT</span><span class="p">],</span> <span class="o">*</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">reverse</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>
    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="nf">sort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">_T</span><span class="p">],</span> <span class="n">SupportsRichComparison</span><span class="p">],</span> <span class="n">reverse</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>
    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span> <span class="o">...</span>
    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">_T</span><span class="p">]:</span> <span class="o">...</span>
    <span class="fm">__hash__</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span>  <span class="c1"># type: ignore[assignment]</span>
    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__i</span><span class="p">:</span> <span class="n">SupportsIndex</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="p">:</span> <span class="o">...</span>
    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__s</span><span class="p">:</span> <span class="nb">slice</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">_T</span><span class="p">]:</span> <span class="o">...</span>
    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__key</span><span class="p">:</span> <span class="n">SupportsIndex</span><span class="p">,</span> <span class="n">__value</span><span class="p">:</span> <span class="n">_T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>
    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__key</span><span class="p">:</span> <span class="nb">slice</span><span class="p">,</span> <span class="n">__value</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">_T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>
    <span class="k">def</span> <span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__key</span><span class="p">:</span> <span class="n">SupportsIndex</span> <span class="o">|</span> <span class="nb">slice</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>
    <span class="c1"># Overloading looks unnecessary, but is needed to work around complex mypy problems</span>
    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__value</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">_T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">_T</span><span class="p">]:</span> <span class="o">...</span>
    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__value</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">_S</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">_S</span> <span class="o">|</span> <span class="n">_T</span><span class="p">]:</span> <span class="o">...</span>
    <span class="k">def</span> <span class="fm">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__value</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">_T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span> <span class="o">...</span>  <span class="c1"># type: ignore[misc]</span>
    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__value</span><span class="p">:</span> <span class="n">SupportsIndex</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">_T</span><span class="p">]:</span> <span class="o">...</span>
    <span class="k">def</span> <span class="fm">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__value</span><span class="p">:</span> <span class="n">SupportsIndex</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">_T</span><span class="p">]:</span> <span class="o">...</span>
    <span class="k">def</span> <span class="fm">__imul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__value</span><span class="p">:</span> <span class="n">SupportsIndex</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span> <span class="o">...</span>
    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__key</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span> <span class="o">...</span>
    <span class="k">def</span> <span class="fm">__reversed__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">_T</span><span class="p">]:</span> <span class="o">...</span>
    <span class="k">def</span> <span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__value</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">_T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span> <span class="o">...</span>
    <span class="k">def</span> <span class="fm">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__value</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">_T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span> <span class="o">...</span>
    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__value</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">_T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span> <span class="o">...</span>
    <span class="k">def</span> <span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__value</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">_T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span> <span class="o">...</span>
    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__value</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span> <span class="o">...</span>
    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">9</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">__class_getitem__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">__item</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GenericAlias</span><span class="p">:</span> <span class="o">...</span>
</pre></div>
</div>
<p>and now consider the following code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">append_pi</span><span class="p">(</span><span class="n">lst</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">3.14</span><span class="p">)</span>
</pre></div>
</div>
<p>And since we parametrized the generic <code class="docutils literal notranslate"><span class="pre">_T</span></code> in <code class="docutils literal notranslate"><span class="pre">List</span></code> with <code class="docutils literal notranslate"><span class="pre">float</span></code>, the type
append method <code class="docutils literal notranslate"><span class="pre">append</span></code> is now <code class="docutils literal notranslate"><span class="pre">append(self,</span> <span class="pre">__object:</span> <span class="pre">float)</span> <span class="pre">-&gt;</span> <span class="pre">None</span></code> instead of
<code class="docutils literal notranslate"><span class="pre">append(self,</span> <span class="pre">__object:</span> <span class="pre">_T)</span> <span class="pre">-&gt;</span> <span class="pre">None</span></code>. And since <code class="docutils literal notranslate"><span class="pre">my_list</span></code> is of type
<code class="docutils literal notranslate"><span class="pre">List[int]</span></code>, the corresponding method <code class="docutils literal notranslate"><span class="pre">append</span></code> should be
<code class="docutils literal notranslate"><span class="pre">append(self,</span> <span class="pre">__object:</span> <span class="pre">int)</span> <span class="pre">-&gt;</span> <span class="pre">None</span></code>. If we were to append a <code class="docutils literal notranslate"><span class="pre">float</span></code> to
<code class="docutils literal notranslate"><span class="pre">my_list</span></code>, the method <code class="docutils literal notranslate"><span class="pre">append</span></code> would break the second criterion of subtyping
(and also Liskov’s substitution principle). Furthermore, when we pass <code class="docutils literal notranslate"><span class="pre">my_list</span></code>
to <code class="docutils literal notranslate"><span class="pre">append_pi</span></code>, we are essentially <strong>assigning</strong> <code class="docutils literal notranslate"><span class="pre">my_list:</span> <span class="pre">List[int]</span></code> to
<code class="docutils literal notranslate"><span class="pre">lst:</span> <span class="pre">List[float]</span></code>. This is not a safe operation because their signature in
<code class="docutils literal notranslate"><span class="pre">append</span></code> are different. So even though both have the same method name <code class="docutils literal notranslate"><span class="pre">append</span></code>,
they are not the same method.</p>
<p>And indeed running through this piece of code via a static type checker like
<code class="docutils literal notranslate"><span class="pre">mypy</span></code> will raise an error.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="m">6</span>:<span class="w"> </span>error:<span class="w"> </span>Argument<span class="w"> </span><span class="m">1</span><span class="w"> </span>to<span class="w"> </span><span class="s2">&quot;append_pi&quot;</span><span class="w"> </span>has<span class="w"> </span>incompatible<span class="w"> </span><span class="nb">type</span><span class="w"> </span><span class="s2">&quot;list[int]&quot;</span><span class="p">;</span><span class="w"> </span>expected<span class="w"> </span><span class="s2">&quot;list[float]&quot;</span><span class="w">  </span><span class="o">[</span>arg-type<span class="o">]</span>
<span class="w">    </span>append_pi<span class="o">(</span>my_list<span class="o">)</span><span class="w">   </span><span class="c1"># Naively, this should be safe..</span>
<span class="w">              </span>^~~~~~~
<span class="m">6</span>:<span class="w"> </span>note:<span class="w"> </span><span class="s2">&quot;List&quot;</span><span class="w"> </span>is<span class="w"> </span>invariant<span class="w"> </span>--<span class="w"> </span>see<span class="w"> </span>https://mypy.readthedocs.io/en/stable/common_issues.html#variance
<span class="m">6</span>:<span class="w"> </span>note:<span class="w"> </span>Consider<span class="w"> </span>using<span class="w"> </span><span class="s2">&quot;Sequence&quot;</span><span class="w"> </span>instead,<span class="w"> </span>which<span class="w"> </span>is<span class="w"> </span>covariant
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">mypy</span></code> error message even gave you some suggestion that <code class="docutils literal notranslate"><span class="pre">List</span></code> is
<strong>invariant</strong>.</p>
</section>
<section id="the-definitions">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">The Definitions</a><a class="headerlink" href="#the-definitions" title="Link to this heading">#</a></h2>
<p>Let <span class="math notranslate nohighlight">\(S\)</span> and <span class="math notranslate nohighlight">\(T\)</span> be two types, and <span class="math notranslate nohighlight">\(C[U]\)</span> denotes a generic class and an
application of a
<a class="reference external" href="https://en.wikipedia.org/wiki/Type_constructor">type constructor</a> <span class="math notranslate nohighlight">\(C\)</span>
parameterized by a type <span class="math notranslate nohighlight">\(U\)</span>.</p>
<p>It is helpful for one to think of type constructors as classes. For example,
<code class="docutils literal notranslate"><span class="pre">List</span></code> is a type constructor, and <code class="docutils literal notranslate"><span class="pre">List[int]</span></code> is an application of the type.</p>
<section id="covariance">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">Covariance</a><a class="headerlink" href="#covariance" title="Link to this heading">#</a></h3>
<div class="proof definition admonition" id="computer-science-type-theory-covariance">
<p class="admonition-title"><span class="caption-number">Definition 30 </span> (Covariance)</p>
<section class="definition-content" id="proof-content">
<p>Within the context of type theory, we say that the type constructor <span class="math notranslate nohighlight">\(C\)</span> is
<strong>covariant</strong> if for any types <span class="math notranslate nohighlight">\(S\)</span> and <span class="math notranslate nohighlight">\(T\)</span>, if <span class="math notranslate nohighlight">\(S\)</span> is a subtype of <span class="math notranslate nohighlight">\(T\)</span>, then
<span class="math notranslate nohighlight">\(C[S]\)</span> is a subtype of <span class="math notranslate nohighlight">\(C[T]\)</span>.</p>
<div class="math notranslate nohighlight">
\[
S \leq T \implies C[S] \leq C[T]
\]</div>
<p>This behaviour preserves the
<a class="reference external" href="https://en.wikipedia.org/wiki/Subtyping">ordering of types</a>, which orders types
from more specific to more generic.</p>
</section>
</div></section>
<section id="contravariance">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">Contravariance</a><a class="headerlink" href="#contravariance" title="Link to this heading">#</a></h3>
<div class="proof definition admonition" id="computer-science-type-theory-contravariance">
<p class="admonition-title"><span class="caption-number">Definition 31 </span> (Contravariance)</p>
<section class="definition-content" id="proof-content">
<p>Within the context of type theory, a type constructor <span class="math notranslate nohighlight">\(C\)</span> is <strong>contravariant</strong>
if for any types <span class="math notranslate nohighlight">\(S\)</span> and <span class="math notranslate nohighlight">\(T\)</span>, if <span class="math notranslate nohighlight">\(S\)</span> is a subtype of <span class="math notranslate nohighlight">\(T\)</span>, then <span class="math notranslate nohighlight">\(C[T]\)</span> is a
subtype of <span class="math notranslate nohighlight">\(C[S]\)</span>.</p>
<div class="math notranslate nohighlight">
\[
S \leq T \implies C[T] \leq C[S]
\]</div>
<p>This behaviour reverses the
<a class="reference external" href="https://en.wikipedia.org/wiki/Subtyping">ordering of types</a>, moving from more
generic to more specific. Contravariance is typically relevant in scenarios
where the type constructor represents a producer or consumer that operates
contrarily to the direction of subtype relationships in covariance.</p>
</section>
</div></section>
<section id="invariance">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">Invariance</a><a class="headerlink" href="#invariance" title="Link to this heading">#</a></h3>
<div class="proof definition admonition" id="computer-science-type-theory-invariance">
<p class="admonition-title"><span class="caption-number">Definition 32 </span> (Invariance)</p>
<section class="definition-content" id="proof-content">
<p>Invariance means that if you have a type constructor <span class="math notranslate nohighlight">\(C\)</span> and two types <span class="math notranslate nohighlight">\(S\)</span> and
<span class="math notranslate nohighlight">\(T\)</span>, then <span class="math notranslate nohighlight">\(C[S]\)</span> is neither a subtype nor a supertype of <span class="math notranslate nohighlight">\(C[T]\)</span> unless <span class="math notranslate nohighlight">\(S\)</span> and
<span class="math notranslate nohighlight">\(T\)</span> are the same.</p>
<p>Equivalently, for any types <span class="math notranslate nohighlight">\(S\)</span> and <span class="math notranslate nohighlight">\(T\)</span>, <span class="math notranslate nohighlight">\(C[S]\)</span> and <span class="math notranslate nohighlight">\(C[T]\)</span> are considered
compatible or equivalent only if <span class="math notranslate nohighlight">\(S = T\)</span>.</p>
<p>Mathematically, this concept does not have a direct inequality representation
like covariance or contravariance because it states a condition of equality
rather than a relational order. However, it implies:</p>
<div class="math notranslate nohighlight">
\[
(S \neq T) \implies (C[S] \nleq C[T] \text{ and } C[T] \nleq C[S])
\]</div>
<p>And conversely:</p>
<div class="math notranslate nohighlight">
\[
(S = T) \implies (C[S] = C[T])
\]</div>
<p>This means for invariance, the specific type instantiation of <span class="math notranslate nohighlight">\(C\)</span> with <span class="math notranslate nohighlight">\(S\)</span> can
only be used in contexts expecting exactly <span class="math notranslate nohighlight">\(C[S]\)</span>, not <span class="math notranslate nohighlight">\(C[T]\)</span> where <span class="math notranslate nohighlight">\(T\)</span> is
different from <span class="math notranslate nohighlight">\(S\)</span>, regardless of whether <span class="math notranslate nohighlight">\(T\)</span> is a subtype or supertype of <span class="math notranslate nohighlight">\(S\)</span>.</p>
</section>
</div></section>
</section>
<section id="list-is-invariant">
<h2><a class="toc-backref" href="#id9" role="doc-backlink">List is Invariant</a><a class="headerlink" href="#list-is-invariant" title="Link to this heading">#</a></h2>
<p>Let’s connect back to our earlier example on why <code class="docutils literal notranslate"><span class="pre">List</span></code> is invariant. We will
now use backticks instead of latex symbols to denote types and type
constructors.</p>
<section id="id1">
<h3><a class="toc-backref" href="#id10" role="doc-backlink">Covariance</a><a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<p>Covariance describes a relationship between types where a type <code class="docutils literal notranslate"><span class="pre">T</span></code> is considered
a subtype of a type <code class="docutils literal notranslate"><span class="pre">U</span></code> (written as <code class="docutils literal notranslate"><span class="pre">T</span> <span class="pre">≤</span> <span class="pre">U</span></code>) if and only if a container of <code class="docutils literal notranslate"><span class="pre">T</span></code>
(<code class="docutils literal notranslate"><span class="pre">Container[T]</span></code>) is considered a subtype of a container of <code class="docutils literal notranslate"><span class="pre">U</span></code> (<code class="docutils literal notranslate"><span class="pre">Container[U]</span></code>).
This is natural for operations that produce or return values of the generic type
(e.g., getters). In the context of our example, <code class="docutils literal notranslate"><span class="pre">List[int]</span> <span class="pre">≤</span> <span class="pre">List[float]</span></code> would
hold true if <code class="docutils literal notranslate"><span class="pre">List[T]</span></code> were covariant, meaning that a list of integers could be
used wherever a list of floats is expected, because every integer can be
considered a float.</p>
<p>However, this relationship does not hold because the <code class="docutils literal notranslate"><span class="pre">append</span></code> method of a
<code class="docutils literal notranslate"><span class="pre">List[float]</span></code> can accept any <code class="docutils literal notranslate"><span class="pre">float</span></code> as an argument, while <code class="docutils literal notranslate"><span class="pre">append</span></code> for a
<code class="docutils literal notranslate"><span class="pre">List[int]</span></code> can only accept <code class="docutils literal notranslate"><span class="pre">int</span></code> values. Since appending a <code class="docutils literal notranslate"><span class="pre">float</span></code> to a
<code class="docutils literal notranslate"><span class="pre">List[int]</span></code> is not type-safe (a float is not necessarily an int), the <code class="docutils literal notranslate"><span class="pre">List</span></code>
type cannot be considered covariant. More concretely, if we assume that
<code class="docutils literal notranslate"><span class="pre">List[int]</span></code> is indeed a subtype of <code class="docutils literal notranslate"><span class="pre">List[float]</span></code>, then the append method of
<code class="docutils literal notranslate"><span class="pre">List[int]</span></code> should do <strong><em>exactly</em></strong> the same thing as the append method of
<code class="docutils literal notranslate"><span class="pre">List[float]</span></code>. But this is not the case.</p>
</section>
<section id="id2">
<h3><a class="toc-backref" href="#id11" role="doc-backlink">Contravariance</a><a class="headerlink" href="#id2" title="Link to this heading">#</a></h3>
<p>Contravariance is the opposite: <code class="docutils literal notranslate"><span class="pre">T</span> <span class="pre">≤</span> <span class="pre">U</span></code> implies <code class="docutils literal notranslate"><span class="pre">Container[U]</span> <span class="pre">≤</span> <span class="pre">Container[T]</span></code>.
This makes sense for containers that consume or operate on the generic type
(e.g., setters). Using our example, <code class="docutils literal notranslate"><span class="pre">List[float]</span> <span class="pre">≤</span> <span class="pre">List[int]</span></code> would be true if
<code class="docutils literal notranslate"><span class="pre">List[T]</span></code> were contravariant, meaning you could use a list expecting floats
where a list of integers is required. This is because it’s safe to pass an
integer where a float is expected, not the other way around.</p>
<p>The example illustrates that this relationship also doesn’t hold because the
<code class="docutils literal notranslate"><span class="pre">pop</span></code> method returns a more specific type (<code class="docutils literal notranslate"><span class="pre">int</span></code>) in <code class="docutils literal notranslate"><span class="pre">List[int]</span></code> than in
<code class="docutils literal notranslate"><span class="pre">List[float]</span></code> (which returns <code class="docutils literal notranslate"><span class="pre">float</span></code>). If <code class="docutils literal notranslate"><span class="pre">List[T]</span></code> were contravariant, we would
expect operations that work on <code class="docutils literal notranslate"><span class="pre">List[int]</span></code> to work on <code class="docutils literal notranslate"><span class="pre">List[float]</span></code>, but the
narrower return type of <code class="docutils literal notranslate"><span class="pre">pop()</span></code> in <code class="docutils literal notranslate"><span class="pre">List[int]</span></code> contradicts this, making it not
contravariant.</p>
</section>
<section id="id3">
<h3><a class="toc-backref" href="#id12" role="doc-backlink">Invariance</a><a class="headerlink" href="#id3" title="Link to this heading">#</a></h3>
<p>Given that the <code class="docutils literal notranslate"><span class="pre">List</span></code> type is neither covariant nor contravariant as
demonstrated, it is termed invariant. Invariance means that you cannot
substitute <code class="docutils literal notranslate"><span class="pre">List[T]</span></code> with <code class="docutils literal notranslate"><span class="pre">List[U]</span></code> or vice versa unless <code class="docutils literal notranslate"><span class="pre">T</span></code> and <code class="docutils literal notranslate"><span class="pre">U</span></code> are exactly
the same type. In practical terms, a <code class="docutils literal notranslate"><span class="pre">List[int]</span></code> is only a <code class="docutils literal notranslate"><span class="pre">List[int]</span></code> and
cannot be treated as a <code class="docutils literal notranslate"><span class="pre">List[float]</span></code>, and vice versa.</p>
</section>
</section>
<section id="the-connection-of-mutability-and-variance">
<h2><a class="toc-backref" href="#id13" role="doc-backlink">The Connection of Mutability and Variance</a><a class="headerlink" href="#the-connection-of-mutability-and-variance" title="Link to this heading">#</a></h2>
<p>Covariance, by definition, allows a type <code class="docutils literal notranslate"><span class="pre">C[Derived]</span></code> to be treated as <code class="docutils literal notranslate"><span class="pre">C[Base]</span></code>
if <code class="docutils literal notranslate"><span class="pre">Derived</span></code> is a subtype of <code class="docutils literal notranslate"><span class="pre">Base</span></code>. This implies that wherever a <code class="docutils literal notranslate"><span class="pre">Base</span></code> is
expected, a <code class="docutils literal notranslate"><span class="pre">Derived</span></code> can be used without issue, preserving the “is-a”
relationship and ensuring that any operation that expects <code class="docutils literal notranslate"><span class="pre">Base</span></code> can work with
<code class="docutils literal notranslate"><span class="pre">Derived</span></code>.</p>
<p>When dealing with immutable structures, the operations you can perform on them
are <strong>read-only</strong>. Since you cannot modify an immutable structure, you can’t
perform any operation that might violate the type constraints that covariance
imposes.</p>
<ol class="arabic simple">
<li><p><strong>No Mutation Means No Type Violations</strong>: Since you cannot add, remove, or
change the elements of an immutable structure, there’s no risk of inserting
an element of an incorrect type that might violate the expected type of the
container.</p></li>
<li><p><strong>Read-Only Operations Are Safe</strong>: Operations on immutable structures are
limited to reading or deriving new structures without altering the original.
This means any operation that works on <code class="docutils literal notranslate"><span class="pre">C[Base]</span></code> will also work on
<code class="docutils literal notranslate"><span class="pre">C[Derived]</span></code> because it only relies on the presence of <code class="docutils literal notranslate"><span class="pre">Base</span></code> type behaviors
in <code class="docutils literal notranslate"><span class="pre">Derived</span></code>.</p></li>
<li><p><strong>Substitution Principle Is Preserved</strong>: The Liskov Substitution Principle,
which is central to understanding subtype relationships, states that objects
of a superclass should be replaceable with objects of a subclass without
affecting the correctness of the program. Immutability ensures that this
principle is not violated since the operations allowed on an immutable
<code class="docutils literal notranslate"><span class="pre">C[Derived]</span></code> would not behave any differently if <code class="docutils literal notranslate"><span class="pre">C[Derived]</span></code> were replaced
with <code class="docutils literal notranslate"><span class="pre">C[Base]</span></code>.</p></li>
</ol>
<p>For mutable structures, the same logic does not apply because the ability to
modify the structure (e.g., adding or removing elements) introduces the
possibility of violating type constraints. If you were allowed to treat a
mutable container of <code class="docutils literal notranslate"><span class="pre">Derived</span></code> as a mutable container of <code class="docutils literal notranslate"><span class="pre">Base</span></code> (covariance),
you could insert a <code class="docutils literal notranslate"><span class="pre">Base</span></code> instance into what is actually a container of
<code class="docutils literal notranslate"><span class="pre">Derived</span></code>, breaking the type safety of the container.</p>
<section id="list-vs-immutable-list">
<h3><a class="toc-backref" href="#id14" role="doc-backlink">List vs Immutable List</a><a class="headerlink" href="#list-vs-immutable-list" title="Link to this heading">#</a></h3>
<p>Consider the below example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">class</span> <span class="nc">Employee</span><span class="p">:</span>
<span class="linenos"> 2</span>    <span class="k">def</span> <span class="nf">work</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="k">class</span> <span class="nc">Manager</span><span class="p">(</span><span class="n">Employee</span><span class="p">):</span>
<span class="linenos"> 5</span>    <span class="k">def</span> <span class="nf">manage</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="c1"># Hypothetical scenario where List is treated as covariant</span>
<span class="linenos"> 8</span><span class="k">def</span> <span class="nf">add_new_employee_using_list</span><span class="p">(</span><span class="n">employees</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Employee</span><span class="p">],</span> <span class="n">employee</span><span class="p">:</span> <span class="n">Employee</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 9</span>    <span class="c1"># Adding an Employee to what was originally a List[Manager]</span>
<span class="linenos">10</span>    <span class="n">employees</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">employee</span><span class="p">)</span>  <span class="c1"># This is where type safety is compromised</span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="c1"># Assume that List[Manager] &lt;: List[Employee]</span>
<span class="linenos">13</span><span class="n">managers</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Manager</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">Manager</span><span class="p">(),</span> <span class="n">Manager</span><span class="p">()]</span>
<span class="linenos">14</span><span class="n">add_new_employee_using_list</span><span class="p">(</span><span class="n">managers</span><span class="p">,</span> <span class="n">employee</span><span class="o">=</span><span class="n">Employee</span><span class="p">())</span>  <span class="c1"># Assuming managers is treated as List[Employee]</span>
<span class="linenos">15</span>
<span class="linenos">16</span><span class="c1"># Now, assuming we want to treat all elements in &#39;managers&#39; as Managers and call Manager-specific methods:</span>
<span class="linenos">17</span><span class="k">try</span><span class="p">:</span>
<span class="linenos">18</span>    <span class="k">for</span> <span class="n">manager</span> <span class="ow">in</span> <span class="n">managers</span><span class="p">:</span>
<span class="linenos">19</span>        <span class="n">manager</span><span class="o">.</span><span class="n">manage</span><span class="p">()</span>
<span class="linenos">20</span><span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
<span class="linenos">21</span>    <span class="nb">print</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;Employee&#39; object has no attribute &#39;manage&#39;
</pre></div>
</div>
</div>
</div>
<p>If we naively treat <code class="docutils literal notranslate"><span class="pre">List</span></code> as covariant, we would be able to pass a
<code class="docutils literal notranslate"><span class="pre">List[Manager]</span></code> to a function that expects a <code class="docutils literal notranslate"><span class="pre">List[Employee]</span></code> since
<code class="docutils literal notranslate"><span class="pre">List[Manager]</span></code> is a subtype of <code class="docutils literal notranslate"><span class="pre">List[Employee]</span></code>. In the above example, our
<code class="docutils literal notranslate"><span class="pre">add_new_employee_using_list</span></code> would then be able to accept a list of managers.
However, this would break the type safety of the list, as we would be able to
append an <code class="docutils literal notranslate"><span class="pre">Employee</span></code> into a list of <code class="docutils literal notranslate"><span class="pre">Manager</span></code>s. Then downstream, when we try to
treat the elements in the list as <code class="docutils literal notranslate"><span class="pre">Manager</span></code>s, we would get an <code class="docutils literal notranslate"><span class="pre">AttributeError</span></code>
because the elements are actually <code class="docutils literal notranslate"><span class="pre">[Manager,</span> <span class="pre">Manager,</span> <span class="pre">Employee]</span></code> and <code class="docutils literal notranslate"><span class="pre">Employee</span></code>
does not have the <code class="docutils literal notranslate"><span class="pre">manage</span></code> method.</p>
<p>But if we were to use an immutable list, the type safety would be preserved
because we would not be able to modify the list in a way that would break the
type constraints. This is because the operations that are allowed on an
immutable list are read-only, and the substitution principle is preserved.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="n">_T_co</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;_T_co&quot;</span><span class="p">,</span> <span class="n">covariant</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="k">class</span> <span class="nc">ImmutableList</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">_T_co</span><span class="p">]):</span>
<span class="linenos"> 4</span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">items</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">_T_co</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 5</span>        <span class="bp">self</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="n">items</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span>    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">_T_co</span><span class="p">]:</span>
<span class="linenos"> 8</span>        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">)</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span>
<span class="linenos">11</span><span class="k">def</span> <span class="nf">loop_employees</span><span class="p">(</span><span class="n">employees</span><span class="p">:</span> <span class="n">ImmutableList</span><span class="p">[</span><span class="n">Employee</span><span class="p">],</span> <span class="n">employee</span><span class="p">:</span> <span class="n">Employee</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">12</span>    <span class="k">for</span> <span class="n">employee</span> <span class="ow">in</span> <span class="n">employees</span><span class="p">:</span>
<span class="linenos">13</span>        <span class="n">employee</span><span class="o">.</span><span class="n">work</span><span class="p">()</span>
<span class="linenos">14</span>
<span class="linenos">15</span><span class="c1"># Assume that List[Manager] &lt;: List[Employee]</span>
<span class="linenos">16</span><span class="n">managers</span><span class="p">:</span> <span class="n">ImmutableList</span><span class="p">[</span><span class="n">Manager</span><span class="p">]</span> <span class="o">=</span> <span class="n">ImmutableList</span><span class="p">([</span><span class="n">Manager</span><span class="p">(),</span> <span class="n">Manager</span><span class="p">()])</span>
<span class="linenos">17</span><span class="n">loop_employees</span><span class="p">(</span><span class="n">managers</span><span class="p">,</span> <span class="n">employee</span><span class="o">=</span><span class="n">Employee</span><span class="p">())</span>  <span class="c1"># Assuming managers is treated as List[Employee]</span>
</pre></div>
</div>
</div>
</div>
<p>In a similar fashion, using a list here would yield mypy error because they
really aren’t sure what operations you would do on the list within the function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">def</span> <span class="nf">loop_employees_using_list</span><span class="p">(</span><span class="n">employees</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Employee</span><span class="p">],</span> <span class="n">employee</span><span class="p">:</span> <span class="n">Employee</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">2</span>    <span class="k">for</span> <span class="n">employee</span> <span class="ow">in</span> <span class="n">employees</span><span class="p">:</span>
<span class="linenos">3</span>        <span class="n">employee</span><span class="o">.</span><span class="n">work</span><span class="p">()</span>
<span class="linenos">4</span>
<span class="linenos">5</span><span class="n">managers</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Manager</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">Manager</span><span class="p">(),</span> <span class="n">Manager</span><span class="p">()]</span>
<span class="linenos">6</span><span class="n">loop_employees_using_list</span><span class="p">(</span><span class="n">managers</span><span class="p">,</span> <span class="n">employee</span><span class="o">=</span><span class="n">Employee</span><span class="p">())</span>  <span class="c1"># Assuming managers is treated as List[Employee]</span>
</pre></div>
</div>
</div>
</div>
<p>will result in:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="m">6</span>:<span class="w"> </span>error:<span class="w"> </span>Argument<span class="w"> </span><span class="m">1</span><span class="w"> </span>to<span class="w"> </span><span class="s2">&quot;loop_employees_using_list&quot;</span><span class="w"> </span>has<span class="w"> </span>incompatible<span class="w"> </span><span class="nb">type</span><span class="w"> </span><span class="s2">&quot;list[Manager]&quot;</span><span class="p">;</span><span class="w"> </span>expected<span class="w"> </span><span class="s2">&quot;list[Employee]&quot;</span><span class="w">  </span><span class="o">[</span>arg-type<span class="o">]</span>
<span class="w">    </span>loop_employees_using_list<span class="o">(</span>managers,<span class="w"> </span><span class="nv">employee</span><span class="o">=</span>Employee<span class="o">())</span><span class="w">  </span><span class="c1"># Assuming managers is treated as List[Employee]</span>
<span class="w">                              </span>^~~~~~~~
<span class="m">6</span>:<span class="w"> </span>note:<span class="w"> </span><span class="s2">&quot;List&quot;</span><span class="w"> </span>is<span class="w"> </span>invariant<span class="w"> </span>--<span class="w"> </span>see<span class="w"> </span>https://mypy.readthedocs.io/en/stable/common_issues.html#variance
<span class="m">6</span>:<span class="w"> </span>note:<span class="w"> </span>Consider<span class="w"> </span>using<span class="w"> </span><span class="s2">&quot;Sequence&quot;</span><span class="w"> </span>instead,<span class="w"> </span>which<span class="w"> </span>is<span class="w"> </span>covariant
</pre></div>
</div>
</section>
</section>
<section id="drawing-some-connection-to-ordinary-functions">
<h2><a class="toc-backref" href="#id15" role="doc-backlink">Drawing Some Connection to Ordinary Functions</a><a class="headerlink" href="#drawing-some-connection-to-ordinary-functions" title="Link to this heading">#</a></h2>
<p>Before we tackle the less intuitive concept of contravariance, it is good to
look at an analogy.</p>
<p>Consider the below 3 functions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">def</span> <span class="nf">covariant</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="linenos">2</span>    <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span>
<span class="linenos">3</span>
<span class="linenos">4</span><span class="k">def</span> <span class="nf">contravariant</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="linenos">5</span>    <span class="k">return</span> <span class="o">-</span><span class="n">x</span>
<span class="linenos">6</span>
<span class="linenos">7</span><span class="k">def</span> <span class="nf">invariant</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="linenos">8</span>    <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span>
</pre></div>
</div>
</div>
</div>
<ol class="arabic">
<li><p><strong>Covariant Function</strong></p>
<p>The <code class="docutils literal notranslate"><span class="pre">covariant</span></code> function doubles its input value.</p>
<div class="math notranslate nohighlight">
\[
    f(x) = 2x
    \]</div>
<p>It is now fairly obvious if we understand covariant via
<a class="reference external" href="https://en.wikipedia.org/wiki/Monotonic_function"><strong>monotonically increasing function</strong></a>
where if <span class="math notranslate nohighlight">\(x_1 &lt;= x_2\)</span>, then we <em>must</em> have <span class="math notranslate nohighlight">\(f(x_1) &lt;= f(x_2)\)</span>. And this
holds true for <span class="math notranslate nohighlight">\(f(x) = 2x\)</span> because if <span class="math notranslate nohighlight">\(x_1 &lt;= x_2\)</span>, then <span class="math notranslate nohighlight">\(2x_1 &lt;= 2x_2\)</span>.</p>
</li>
<li><p><strong>Contravariant Function</strong></p>
<p>The <code class="docutils literal notranslate"><span class="pre">contravariant</span></code> function negates its input value.</p>
<div class="math notranslate nohighlight">
\[
    g(x) = -x
    \]</div>
<p>Similarly, if we understand contravariant via
<a class="reference external" href="https://en.wikipedia.org/wiki/Monotonic_function"><strong>monotonically decreasing function</strong></a>
where if <span class="math notranslate nohighlight">\(x_1 &lt;= x_2\)</span>, then we <em>must</em> have <span class="math notranslate nohighlight">\(g(x_2) &lt;= g(x_1)\)</span>. And this
holds true for <span class="math notranslate nohighlight">\(g(x) = -x\)</span> because if <span class="math notranslate nohighlight">\(x_1 &lt;= x_2\)</span>, then <span class="math notranslate nohighlight">\(-x_2 &lt;= -x_1\)</span>.</p>
</li>
<li><p><strong>Invariant Function</strong></p>
<p>The <code class="docutils literal notranslate"><span class="pre">invariant</span></code> function squares its input value.</p>
<div class="math notranslate nohighlight">
\[
    h(x) = x^2
    \]</div>
<p>Here it more of a <strong>idempotent</strong> or just non-monotonic function. It does not
preserve the ordering of the input value.</p>
</li>
</ol>
</section>
<section id="contravariant-and-callable-types">
<h2><a class="toc-backref" href="#id16" role="doc-backlink">Contravariant and Callable Types</a><a class="headerlink" href="#contravariant-and-callable-types" title="Link to this heading">#</a></h2>
<p>Functions, as we know it, is a first class citizens in Python. This means that
functions can be passed around as arguments, returned from other functions, and
assigned to variables. This is why we can use the <code class="docutils literal notranslate"><span class="pre">Callable</span></code> type to represent
functions.</p>
<section id="callable-return-types-covariance">
<h3><a class="toc-backref" href="#id17" role="doc-backlink">Callable Return Types (Covariance)</a><a class="headerlink" href="#callable-return-types-covariance" title="Link to this heading">#</a></h3>
<p>When we talk about the return type of a callable (e.g., a function) being
covariant, we mean that a function’s return type can be substituted with its
subtype without affecting the correctness of the program. This is
straightforward and intuitive:</p>
<ul class="simple">
<li><p>If you have a function expected to return an <code class="docutils literal notranslate"><span class="pre">Employee</span></code>, a function that
returns a <code class="docutils literal notranslate"><span class="pre">Manager</span></code> (assuming <code class="docutils literal notranslate"><span class="pre">Manager</span></code> is a subclass of <code class="docutils literal notranslate"><span class="pre">Employee</span></code>) can be
used instead because every <code class="docutils literal notranslate"><span class="pre">Manager</span></code> is an <code class="docutils literal notranslate"><span class="pre">Employee</span></code>. This substitution
follows the intuitive direction of the subtype relationship.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Callable[[],</span> <span class="pre">Manager]</span></code> is a subtype of <code class="docutils literal notranslate"><span class="pre">Callable[[],</span> <span class="pre">Employee]</span></code> because the
function’s return value (a <code class="docutils literal notranslate"><span class="pre">Manager</span></code>) can be used in any context that
expects an <code class="docutils literal notranslate"><span class="pre">Employee</span></code>, following the principle that a subclass instance can
be used wherever a superclass instance is expected.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">def</span> <span class="nf">process_employee</span><span class="p">(</span><span class="n">get_employee</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="n">Employee</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 2</span>    <span class="n">employee</span> <span class="o">=</span> <span class="n">get_employee</span><span class="p">()</span>
<span class="linenos"> 3</span>    <span class="nb">print</span><span class="p">(</span><span class="n">employee</span><span class="o">.</span><span class="n">work</span><span class="p">())</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="c1"># A function that returns an Employee instance</span>
<span class="linenos"> 6</span><span class="k">def</span> <span class="nf">get_employee</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Employee</span><span class="p">:</span>
<span class="linenos"> 7</span>    <span class="k">return</span> <span class="n">Employee</span><span class="p">()</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="c1"># A function that returns a Manager instance</span>
<span class="linenos">10</span><span class="k">def</span> <span class="nf">get_manager</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Manager</span><span class="p">:</span>
<span class="linenos">11</span>    <span class="k">return</span> <span class="n">Manager</span><span class="p">()</span>
<span class="linenos">12</span>
<span class="linenos">13</span><span class="n">process_employee</span><span class="p">(</span><span class="n">get_employee</span><span class="p">)</span>
<span class="linenos">14</span><span class="n">process_employee</span><span class="p">(</span><span class="n">get_manager</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>None
None
</pre></div>
</div>
</div>
</div>
<p>Consequently, <code class="docutils literal notranslate"><span class="pre">Callable</span></code> is <strong>covariant in its return type</strong>.</p>
</section>
<section id="callable-argument-types-contravariance">
<h3><a class="toc-backref" href="#id18" role="doc-backlink">Callable Argument Types (Contravariance)</a><a class="headerlink" href="#callable-argument-types-contravariance" title="Link to this heading">#</a></h3>
<p>Contravariance for argument types in callable types is where it gets
counterintuitive for many. If a callable is contravariant in its argument type,
it means that you can pass a callable that accepts a more general type in place
of one that accepts a more specific type. This might seem backward at first, but
it makes sense when you consider the principle of substitutability (LSP) from
the caller’s perspective:</p>
<ul class="simple">
<li><p>If a function is designed to handle a <code class="docutils literal notranslate"><span class="pre">Manager</span></code> as its input, you can safely
replace it with a function designed to handle any <code class="docutils literal notranslate"><span class="pre">Employee</span></code>, because the
latter can deal with <code class="docutils literal notranslate"><span class="pre">Manager</span></code> instances (being a specific kind of
<code class="docutils literal notranslate"><span class="pre">Employee</span></code>) and more.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Callable[[Employee],</span> <span class="pre">None]</span></code> is a subtype of <code class="docutils literal notranslate"><span class="pre">Callable[[Manager],</span> <span class="pre">None]</span></code>.
This is because a function capable of dealing with any <code class="docutils literal notranslate"><span class="pre">Employee</span></code> can, by
definition, deal with a <code class="docutils literal notranslate"><span class="pre">Manager</span></code> (a specific kind of <code class="docutils literal notranslate"><span class="pre">Employee</span></code>).</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">class</span> <span class="nc">CEO</span><span class="p">(</span><span class="n">Employee</span><span class="p">):</span>
<span class="linenos"> 2</span>    <span class="k">def</span> <span class="nf">manage</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>
<span class="linenos"> 3</span>    <span class="k">def</span> <span class="nf">fire</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="k">def</span> <span class="nf">process_employee</span><span class="p">(</span><span class="n">employee</span><span class="p">:</span> <span class="n">Employee</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 6</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;This function has type `Callable[[Employee], None]`.&quot;&quot;&quot;</span>
<span class="linenos"> 7</span>    <span class="n">employee</span><span class="o">.</span><span class="n">work</span><span class="p">()</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="k">def</span> <span class="nf">process_manager</span><span class="p">(</span><span class="n">manager</span><span class="p">:</span> <span class="n">Manager</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">10</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;This function has type `Callable[[Manager], None]`.&quot;&quot;&quot;</span>
<span class="linenos">11</span>    <span class="n">manager</span><span class="o">.</span><span class="n">work</span><span class="p">()</span>
<span class="linenos">12</span>    <span class="n">manager</span><span class="o">.</span><span class="n">manage</span><span class="p">()</span>
<span class="linenos">13</span>
<span class="linenos">14</span><span class="k">def</span> <span class="nf">process_ceo</span><span class="p">(</span><span class="n">ceo</span><span class="p">:</span> <span class="n">CEO</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">15</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;This function has type `Callable[[CEO], None]`.&quot;&quot;&quot;</span>
<span class="linenos">16</span>    <span class="n">ceo</span><span class="o">.</span><span class="n">work</span><span class="p">()</span>
<span class="linenos">17</span>    <span class="n">ceo</span><span class="o">.</span><span class="n">manage</span><span class="p">()</span>
<span class="linenos">18</span>    <span class="n">ceo</span><span class="o">.</span><span class="n">fire</span><span class="p">()</span>
<span class="linenos">19</span>
<span class="linenos">20</span><span class="k">def</span> <span class="nf">assign_project</span><span class="p">(</span><span class="n">employee</span><span class="p">:</span> <span class="n">Employee</span><span class="p">,</span> <span class="n">process</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Employee</span><span class="p">],</span> <span class="kc">None</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">21</span>    <span class="n">process</span><span class="p">(</span><span class="n">employee</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now we ask if we can assign <code class="docutils literal notranslate"><span class="pre">process_manager</span></code> of type
<code class="docutils literal notranslate"><span class="pre">Callable[[Manager],</span> <span class="pre">None]</span></code> to <code class="docutils literal notranslate"><span class="pre">process_employee</span></code> of type
<code class="docutils literal notranslate"><span class="pre">Callable[[Employee],</span> <span class="pre">None]</span></code> (i.e. <code class="docutils literal notranslate"><span class="pre">process_employee</span> <span class="pre">=</span> <span class="pre">process_manager</span></code>)? Can we
safely substitute <code class="docutils literal notranslate"><span class="pre">process_employee</span></code> with <code class="docutils literal notranslate"><span class="pre">process_manager</span></code>? If we can do that,
then <code class="docutils literal notranslate"><span class="pre">Callable[[Manager],</span> <span class="pre">None]</span></code> is a subtype of <code class="docutils literal notranslate"><span class="pre">Callable[[Employee],</span> <span class="pre">None]</span></code>.
We cannot do this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">my_good_employee</span><span class="p">:</span> <span class="n">Employee</span> <span class="o">=</span> <span class="n">Employee</span><span class="p">()</span>
<span class="linenos">2</span><span class="k">try</span><span class="p">:</span>
<span class="linenos">3</span>    <span class="n">assign_project</span><span class="p">(</span><span class="n">employee</span><span class="o">=</span><span class="n">my_good_employee</span><span class="p">,</span> <span class="n">process</span><span class="o">=</span><span class="n">process_manager</span><span class="p">)</span>
<span class="linenos">4</span><span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
<span class="linenos">5</span>    <span class="nb">print</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;Employee&#39; object has no attribute &#39;manage&#39;
</pre></div>
</div>
</div>
</div>
<p>This is because <code class="docutils literal notranslate"><span class="pre">process_manager</span></code> expects a <code class="docutils literal notranslate"><span class="pre">Manager</span></code> and not just any
<code class="docutils literal notranslate"><span class="pre">Employee</span></code>. This is where contravariance comes into play. It allows us to safely
substitute a function that expects a more specific type with one that expects a
more general type. This is because the function that expects a more general type
can handle the more specific type and more.</p>
<p>More concretely, can we assign <code class="docutils literal notranslate"><span class="pre">process_employee</span></code> to <code class="docutils literal notranslate"><span class="pre">process_manager</span></code>? This is
counterintuitive because we are more used to a subtype <span class="math notranslate nohighlight">\(S\)</span> being able to replace
a supertype <span class="math notranslate nohighlight">\(T\)</span> and not the other way around.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">def</span> <span class="nf">assign_project</span><span class="p">(</span><span class="n">manager</span><span class="p">:</span> <span class="n">Manager</span><span class="p">,</span> <span class="n">process</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Manager</span><span class="p">],</span> <span class="kc">None</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">2</span>    <span class="n">process</span><span class="p">(</span><span class="n">manager</span><span class="p">)</span>
<span class="linenos">3</span>
<span class="linenos">4</span><span class="n">my_manager</span><span class="p">:</span> <span class="n">Manager</span> <span class="o">=</span> <span class="n">Manager</span><span class="p">()</span>
<span class="linenos">5</span><span class="n">assign_project</span><span class="p">(</span><span class="n">manager</span><span class="o">=</span><span class="n">my_manager</span><span class="p">,</span> <span class="n">process</span><span class="o">=</span><span class="n">process_employee</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>This will be fine because <code class="docutils literal notranslate"><span class="pre">process_employee</span></code> can handle a <code class="docutils literal notranslate"><span class="pre">Manager</span></code> instance
since <code class="docutils literal notranslate"><span class="pre">Manager</span></code> is a subclass of <code class="docutils literal notranslate"><span class="pre">Employee</span></code>. More verbosely, in
<code class="docutils literal notranslate"><span class="pre">process_employee</span></code>, we accept an <code class="docutils literal notranslate"><span class="pre">Employee</span></code> instance that may have <span class="math notranslate nohighlight">\(N\)</span>
functions/methods, but we know for a fact any subclass of <code class="docutils literal notranslate"><span class="pre">Employee</span></code> will have
at least the same <span class="math notranslate nohighlight">\(N\)</span> functions/methods. So we can safely pass a <code class="docutils literal notranslate"><span class="pre">Manager</span></code>
instance to <code class="docutils literal notranslate"><span class="pre">process_employee</span></code>. Consequently, <code class="docutils literal notranslate"><span class="pre">Callable</span></code> is <strong>contravariant in
its argument type</strong>.</p>
<p>One more good example from
<a class="reference external" href="https://peps.python.org/pep-0483/#covariance-and-contravariance">PEP 483</a>:</p>
<p>In the salary calculation example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">decimal</span> <span class="kn">import</span> <span class="n">Decimal</span>

<span class="k">def</span> <span class="nf">calculate_all</span><span class="p">(</span><span class="n">lst</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Manager</span><span class="p">],</span> <span class="n">salary</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Manager</span><span class="p">],</span> <span class="n">Decimal</span><span class="p">]):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>A <code class="docutils literal notranslate"><span class="pre">Callable[[Employee],</span> <span class="pre">Decimal]</span></code> can indeed replace a
<code class="docutils literal notranslate"><span class="pre">Callable[[Manager],</span> <span class="pre">Decimal]</span></code> because the former can handle not just <code class="docutils literal notranslate"><span class="pre">Manager</span></code>
instances but any <code class="docutils literal notranslate"><span class="pre">Employee</span></code>, making it a safe and more general substitution.
This adheres to the principle that functions that operate on broader types can
replace those that operate on more specific types within the context of function
arguments.</p>
</section>
</section>
<section id="real-world-examples-of-covariance-and-contravariance">
<h2><a class="toc-backref" href="#id19" role="doc-backlink">Real World Examples of Covariance and Contravariance</a><a class="headerlink" href="#real-world-examples-of-covariance-and-contravariance" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Here is how
<a class="reference external" href="https://github.com/chroma-core/chroma/blob/d9a8c28055ca1aa4c602560c0117f7608858d3f0/chromadb/api/types.py#L146">ChromaDB uses contravariant</a>
on <code class="docutils literal notranslate"><span class="pre">Embeddable</span></code>.</p></li>
<li><p>Here is how
<a class="reference external" href="https://github.com/chroma-core/chroma/blob/d9a8c28055ca1aa4c602560c0117f7608858d3f0/chromadb/api/types.py#L150">ChromaDB uses covariance</a>.</p>
<ul>
<li><p>On a side note, <code class="docutils literal notranslate"><span class="pre">DataLoader</span></code> from PyTorch also uses covariance.</p></li>
</ul>
</li>
</ul>
</section>
<section id="references-and-further-readings">
<h2><a class="toc-backref" href="#id20" role="doc-backlink">References and Further Readings</a><a class="headerlink" href="#references-and-further-readings" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://peps.python.org/pep-0483/#covariance-and-contravariance">PEP 483 - The Theory of Type Hints</a></p></li>
<li><p><a class="reference external" href="https://peps.python.org/pep-0484/#covariance-and-contravariance">PEP 484 - Type Hints</a></p></li>
<li><p><a class="reference external" href="https://www.playfulpython.com/type-hinting-covariance-contra-variance/">Type Hinting: Covariance &amp; Contra-Variance</a></p></li>
<li><p><a class="reference external" href="https://nus-cs2030s.github.io/2021-s2/18-variance.html">CS2030S: Variance</a></p></li>
<li><p><a class="reference external" href="https://mypy.readthedocs.io/en/stable/generics.html#variance-of-generics">Variance of generics in mypy</a></p></li>
<li><p><a class="reference external" href="https://blog.daftcode.pl/covariance-contravariance-and-invariance-the-ultimate-python-guide-8fabc0c24278">Covariance, Contravariance, and Invariance - The Ultimate Python Guide</a></p></li>
<li><p><a class="reference external" href="https://eli.thegreenplace.net/2018/covariance-and-contravariance-in-subtyping/">Covariance and contravariance in subtyping</a></p></li>
<li><p><a class="reference external" href="https://stackoverflow.com/questions/61568462/python-typing-what-does-typevara-b-covariant-true-mean">Python typing: What does TypeVar(‘A’, ‘B’, covariant=True) mean?</a></p></li>
<li><p><a class="reference external" href="https://stackoverflow.com/questions/6684493/why-are-arrays-invariant-but-lists-covariant">Why are arrays invariant but lists covariant?</a></p></li>
<li><p><a class="reference external" href="https://stackoverflow.com/questions/1163465/what-is-the-difference-between-covariance-and-contra-variance-in-programming-lan">What is the difference between covariance and contra-variance in programming languages?</a></p></li>
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Covariance_and_contravariance_(computer_science)">Covariance and contravariance (computer science) - Wikipedia</a></p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./computer_science/type_theory"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="05-typevar-bound-constraints.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Bound and Constraint in Generics and Type Variables</p>
      </div>
    </a>
    <a class="right-next"
       href="07-pep-3124-overloading.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Function Overloading</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-motivation">The Motivation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-definitions">The Definitions</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#covariance">Covariance</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#contravariance">Contravariance</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#invariance">Invariance</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#list-is-invariant">List is Invariant</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Covariance</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Contravariance</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Invariance</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-connection-of-mutability-and-variance">The Connection of Mutability and Variance</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#list-vs-immutable-list">List vs Immutable List</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#drawing-some-connection-to-ordinary-functions">Drawing Some Connection to Ordinary Functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#contravariant-and-callable-types">Contravariant and Callable Types</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#callable-return-types-covariance">Callable Return Types (Covariance)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#callable-argument-types-contravariance">Callable Argument Types (Contravariance)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#real-world-examples-of-covariance-and-contravariance">Real World Examples of Covariance and Contravariance</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references-and-further-readings">References and Further Readings</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Gao Hongnan
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>