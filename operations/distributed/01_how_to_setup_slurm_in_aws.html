
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>How to Setup SLURM and ParallelCluster in AWS &#8212; Omniverse</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css?v=4c969af8" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=bb35926c" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script src="../../_static/tabs.js?v=3ee01567"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=36754332"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-MYW5YKC2WF"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-MYW5YKC2WF');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-MYW5YKC2WF');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'operations/distributed/01_how_to_setup_slurm_in_aws';</script>
    <link rel="canonical" href="https://www.gaohongnan.com/operations/distributed/01_how_to_setup_slurm_in_aws.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Bibliography" href="../../bibliography.html" />
    <link rel="prev" title="Distributed Training in Deep Learning" href="notations.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo.png" class="logo__image only-light" alt="Omniverse - Home"/>
    <script>document.write(`<img src="../../_static/logo.png" class="logo__image only-dark" alt="Omniverse - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    üåå Omniverse: A Journey Through Knowledge
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Notations</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../notations/machine_learning.html">Machine Learning Notations</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Influential Ideas and Papers</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../influential/generative_pretrained_transformer/01_intro.html">Generative Pre-trained Transformers</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../influential/generative_pretrained_transformer/02_notations.html">Notations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../influential/generative_pretrained_transformer/03_concept.html">The Concept of Generative Pre-trained Transformers (GPT)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../influential/generative_pretrained_transformer/04_implementation.html">The Implementation of Generative Pre-trained Transformers (GPT)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../influential/generative_pretrained_transformer/05_adder.html">Training a Mini-GPT to Learn Two-Digit Addition</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Playbook</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../playbook/how_to_calculate_flops_in_gpt2.html">How to Calculate the Number of FLOPs in GPT-2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../playbook/how_to_inspect_function_and_class_signatures.html">How to Inspect Function and Class Signatures in Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../playbook/why_cosine_annealing_warmup_stabilize_training.html">Why Does Cosine Annealing With Warmup Stabilize Training?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../playbook/why_softmax_preserves_order_translation_invariant_not_invariant_scaling.html">Softmax Preserves Order, Is Translation Invariant But Not Invariant Under Scaling</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Deep Learning</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../deep_learning/training_chronicles/intro.html">Training Chronicles</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../deep_learning/training_chronicles/loss.html">The Loss Landscape</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Software Engineering</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../software_engineering/devops/continuous-integration/concept.html">Continuous Integration (CI) Workflow</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../software_engineering/devops/continuous-integration/styling.html">Styling, Formatting, and Linting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../software_engineering/devops/continuous-integration/testing.html">Testing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../software_engineering/design_patterns/dependency-inversion-principle.html">Dependency Inversion Principle</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../software_engineering/concurrency_parallelism_asynchronous/intro.html">Concurrency, Parallelism and Asynchronous Programming</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../software_engineering/concurrency_parallelism_asynchronous/generator_yield.html">A Rudimentary Introduction to Generator and Yield in Python</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../software_engineering/serving/restful_api/intro.html">RESTful API</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../software_engineering/serving/restful_api/application_banking.html">Application: Designing a RESTful Banking API with FastAPI and SQLAlchemy</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Computer Science</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../computer_science/type_theory/intro.html">Type Theory, A Very Rudimentary Introduction</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../computer_science/type_theory/01-subtypes.html">Subtypes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../computer_science/type_theory/02-type-safety.html">Type Safety</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../computer_science/type_theory/03-subsumption.html">Subsumption</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../computer_science/type_theory/04-generics.html">Generics and Type Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../computer_science/type_theory/05-typevar-bound-constraints.html">Bound and Constraint in Generics and Type Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../computer_science/type_theory/06-invariance-covariance-contravariance.html">Invariance, Covariance and Contravariance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../computer_science/type_theory/07-pep-3124-overloading.html">Function Overloading</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../computer_science/type_theory/08-pep-661-sentinel-values.html">Sentinel Types</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Data Structures and Algorithms</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../dsa/complexity_analysis/intro.html">Complexity Analysis</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../dsa/complexity_analysis/master_theorem.html">Master Theorem </a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../dsa/stack/intro.html">Stack</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../dsa/stack/concept.html">Concept</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../dsa/searching_algorithms/linear_search/intro.html">Linear Search</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../dsa/searching_algorithms/linear_search/concept.html">Concept</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../dsa/searching_algorithms/binary_search/intro.html">Binary Search</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../dsa/searching_algorithms/binary_search/concept.html">Concept</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dsa/searching_algorithms/binary_search/problems/875-koko-eating-bananas.html">Koko Eating Bananas</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Linear Algebra</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../linear_algebra/01_preliminaries/intro.html">Preliminaries</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-11"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../linear_algebra/01_preliminaries/01-fields.html">Fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../linear_algebra/01_preliminaries/02-systems-of-linear-equations.html">Systems of Linear Equations</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../linear_algebra/02_vectors/intro.html">Vectors</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-12"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../linear_algebra/02_vectors/01-vector-definition.html">Vector and Its Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../linear_algebra/02_vectors/02-vector-operation.html">Vector and Its Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../linear_algebra/02_vectors/03-vector-norm.html">Vector Norm and Distance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../linear_algebra/02_vectors/04-vector-products.html">A First Look at Vector Products</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Operations</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../machine_learning_lifecycle/00_intro.html">The Lifecycle of an AIOps System</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-13"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../machine_learning_lifecycle/01_problem_formulation.html">Stage 1. Problem Formulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../machine_learning_lifecycle/02_project_scoping.html">Stage 2. Project Scoping And Framing The Problem</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../machine_learning_lifecycle/03_dataops_pipeline.html">Stage 3. Data Pipeline (Data Engineering and DataOps)</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-14"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../machine_learning_lifecycle/031_data_source_and_format.html">Stage 3.1. Data Source and Formats</a></li>
<li class="toctree-l3"><a class="reference internal" href="../machine_learning_lifecycle/032_data_model_and_storage.html">Stage 3.2. Data Model and Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../machine_learning_lifecycle/033_etl.html">Stage 3.3. Extract, Transform, Load (ETL)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../machine_learning_lifecycle/04_mlops_data_pipeline.html">Stage 4. Data Extraction (MLOps), Data Analysis (Data Science), Data Preparation (Data Science)</a></li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="intro.html">Distributed Systems</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-15"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="notations.html">Distributed Training in Deep Learning</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">How to Setup SLURM and ParallelCluster in AWS</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">References, Resources and Roadmap</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../bibliography.html">Bibliography</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../citations.html">IEEE (Style) Citations</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../api/reproducibility.html">API Reference</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/gao-hongnan/omniverse" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/gao-hongnan/omniverse/issues/new?title=Issue%20on%20page%20%2Foperations/distributed/01_how_to_setup_slurm_in_aws.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/operations/distributed/01_how_to_setup_slurm_in_aws.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>How to Setup SLURM and ParallelCluster in AWS</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-up-identity-and-access-management-iam-role">Setting Up Identity and Access Management (IAM) Role</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#configure-aws-cli">Configure AWS CLI</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-ec2-key-pair">Create EC2 Key Pair</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#configure-aws-parallelcluster">Configure AWS ParallelCluster</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#review-the-configuration-file">1. Review the Configuration File</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#create-the-cluster">2. Create the Cluster</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#monitor-the-cluster-creation">3. Monitor the Cluster Creation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#shared-file-system">Shared File System</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#logging-into-the-head-node">Logging into the Head Node</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#compute-node">Compute Node</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#slurm-status">SLURM Status</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setup-python-environment">Setup Python Environment</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sample-run">Sample Run</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#remember-the-logs-are-in-compute-nodes">Remember The Logs Are In Compute Nodes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#delete-cluster">Delete Cluster</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#delete-parallelcluster">Delete ParallelCluster</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#delete-network-resources">Delete Network Resources</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#troubleshooting">Troubleshooting</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#failurecode-is-headnodebootstrapfailure-with-failurereason-cluster-creation-timed-out">failureCode is HeadNodeBootstrapFailure with failureReason Cluster creation timed out</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#some-useful-commands">Some Useful Commands</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#slurm-commands">Slurm Commands</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#how-many-gpus">How Many GPUs?</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#find-the-instance-id">Find the Instance ID</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#stop-ec2-instances">Stop EC2 Instances</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="how-to-setup-slurm-and-parallelcluster-in-aws">
<h1>How to Setup SLURM and ParallelCluster in AWS<a class="headerlink" href="#how-to-setup-slurm-and-parallelcluster-in-aws" title="Link to this heading">#</a></h1>
<p><a class="reference external" href="https://twitter.com/gaohongnan"><img alt="Twitter Handle" src="https://img.shields.io/badge/Twitter-&#64;gaohongnan-blue?style=social&amp;logo=twitter" /></a>
<a class="reference external" href="https://linkedin.com/in/gao-hongnan"><img alt="LinkedIn Profile" src="https://img.shields.io/badge/&#64;gaohongnan-blue?style=social&amp;logo=linkedin" /></a>
<a class="reference external" href="https://github.com/gao-hongnan"><img alt="GitHub Profile" src="https://img.shields.io/badge/GitHub-gao--hongnan-lightgrey?style=social&amp;logo=github" /></a>
<img alt="Tag" src="https://img.shields.io/badge/Tag-Brain_Dump-red" />
<img alt="Tag" src="https://img.shields.io/badge/Level-Beginner-green" /></p>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#setting-up-identity-and-access-management-iam-role" id="id1">Setting Up Identity and Access Management (IAM) Role</a></p></li>
<li><p><a class="reference internal" href="#configure-aws-cli" id="id2">Configure AWS CLI</a></p></li>
<li><p><a class="reference internal" href="#create-ec2-key-pair" id="id3">Create EC2 Key Pair</a></p></li>
<li><p><a class="reference internal" href="#configure-aws-parallelcluster" id="id4">Configure AWS ParallelCluster</a></p>
<ul>
<li><p><a class="reference internal" href="#review-the-configuration-file" id="id5">1. Review the Configuration File</a></p></li>
<li><p><a class="reference internal" href="#create-the-cluster" id="id6">2. Create the Cluster</a></p></li>
<li><p><a class="reference internal" href="#monitor-the-cluster-creation" id="id7">3. Monitor the Cluster Creation</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#shared-file-system" id="id8">Shared File System</a></p></li>
<li><p><a class="reference internal" href="#logging-into-the-head-node" id="id9">Logging into the Head Node</a></p>
<ul>
<li><p><a class="reference internal" href="#compute-node" id="id10">Compute Node</a></p></li>
<li><p><a class="reference internal" href="#slurm-status" id="id11">SLURM Status</a></p></li>
<li><p><a class="reference internal" href="#setup-python-environment" id="id12">Setup Python Environment</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#sample-run" id="id13">Sample Run</a></p></li>
<li><p><a class="reference internal" href="#remember-the-logs-are-in-compute-nodes" id="id14">Remember The Logs Are In Compute Nodes</a></p></li>
<li><p><a class="reference internal" href="#delete-cluster" id="id15">Delete Cluster</a></p>
<ul>
<li><p><a class="reference internal" href="#delete-parallelcluster" id="id16">Delete ParallelCluster</a></p></li>
<li><p><a class="reference internal" href="#delete-network-resources" id="id17">Delete Network Resources</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#troubleshooting" id="id18">Troubleshooting</a></p>
<ul>
<li><p><a class="reference internal" href="#failurecode-is-headnodebootstrapfailure-with-failurereason-cluster-creation-timed-out" id="id19">failureCode is HeadNodeBootstrapFailure with failureReason Cluster creation timed out</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#some-useful-commands" id="id20">Some Useful Commands</a></p>
<ul>
<li><p><a class="reference internal" href="#slurm-commands" id="id21">Slurm Commands</a></p>
<ul>
<li><p><a class="reference internal" href="#how-many-gpus" id="id22">How Many GPUs?</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#find-the-instance-id" id="id23">Find the Instance ID</a></p></li>
<li><p><a class="reference internal" href="#stop-ec2-instances" id="id24">Stop EC2 Instances</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#references" id="id25">References</a></p></li>
</ul>
</nav>
<p>This guide will help you set up your AWS environment and install AWS CLI and AWS
ParallelCluster</p>
<section id="setting-up-identity-and-access-management-iam-role">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Setting Up Identity and Access Management (IAM) Role</a><a class="headerlink" href="#setting-up-identity-and-access-management-iam-role" title="Link to this heading">#</a></h2>
<p>Before deploying AWS ParallelCluster, it‚Äôs essential to configure an IAM role
with appropriate permissions. This role ensures that AWS ParallelCluster has the
necessary permissions to manage AWS resources on your behalf, such as EC2
instances, networking components, and storage systems.</p>
<p>The rough steps are as follows:</p>
<ul class="simple">
<li><p>Navigate to the <a class="reference external" href="https://console.aws.amazon.com/iam/">IAM console</a> in AWS.</p></li>
<li><p>Create a new IAM user or use an existing one.</p></li>
<li><p>Ensure the user has an IAM role with <code class="docutils literal notranslate"><span class="pre">AdministratorAccess</span></code> or attach the
<code class="docutils literal notranslate"><span class="pre">AdministratorAccess</span></code> policy directly. While convenient, using
<code class="docutils literal notranslate"><span class="pre">AdministratorAccess</span></code> can pose security risks if not managed carefully. It‚Äôs
recommended to scope down the permissions to least privilege principles if
you are working in a team or production environment. For educational
purposes, it‚Äôs fine to use <code class="docutils literal notranslate"><span class="pre">AdministratorAccess</span></code>.</p></li>
<li><p>Generate an <strong>AWS Access Key ID</strong> and <strong>AWS Secret Access Key</strong> for
command-line access - you can find them in the user‚Äôs security credentials
tab in the IAM console.</p></li>
</ul>
</section>
<section id="configure-aws-cli">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Configure AWS CLI</a><a class="headerlink" href="#configure-aws-cli" title="Link to this heading">#</a></h2>
<p>First we install the python package <code class="docutils literal notranslate"><span class="pre">awscli</span></code> using <code class="docutils literal notranslate"><span class="pre">pip</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>‚ùØ<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>--upgrade<span class="w"> </span>awscli
</pre></div>
</div>
<p>Then we configure the AWS CLI:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>‚ùØ<span class="w"> </span>aws<span class="w"> </span>configure
AWS<span class="w"> </span>Access<span class="w"> </span>Key<span class="w"> </span>ID<span class="w"> </span><span class="o">[</span>None<span class="o">]</span>:<span class="w"> </span>&lt;AWS_ACCESS_KEY&gt;
AWS<span class="w"> </span>Secret<span class="w"> </span>Access<span class="w"> </span>Key<span class="w"> </span><span class="o">[</span>None<span class="o">]</span>:<span class="w"> </span>&lt;AWS_SECRET_KEY&gt;
Default<span class="w"> </span>region<span class="w"> </span>name<span class="w"> </span><span class="o">[</span>None<span class="o">]</span>:<span class="w"> </span>ap-southeast-1
Default<span class="w"> </span>output<span class="w"> </span>format<span class="w"> </span><span class="o">[</span>None<span class="o">]</span>:<span class="w"> </span>json
</pre></div>
</div>
<p>Replace <code class="docutils literal notranslate"><span class="pre">&lt;AWS_ACCESS_KEY&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;AWS_SECRET_KEY&gt;</span></code> with your actual AWS
credentials. And since we want a region close to home we set <code class="docutils literal notranslate"><span class="pre">ap-southeast-1</span></code> as
the default region - it is also recommended to set up the region close to you to
reduce latency.</p>
</section>
<section id="create-ec2-key-pair">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Create EC2 Key Pair</a><a class="headerlink" href="#create-ec2-key-pair" title="Link to this heading">#</a></h2>
<p>To set up the SLURM cluster, we need to create an EC2 key pair. This key pair
can be viewed as a secure SSH access to the cluster‚Äôs head and compute nodes
where authorized users can log in to train models, run experiments, and manage
the cluster.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>‚ùØ<span class="w">  </span>aws<span class="w"> </span>ec2<span class="w"> </span>create-key-pair<span class="w"> </span>--key-name<span class="w"> </span>&lt;YourKeyName&gt;<span class="w"> </span>--query<span class="w"> </span><span class="s1">&#39;KeyMaterial&#39;</span><span class="w"> </span>--output<span class="w"> </span>text<span class="w"> </span>&gt;<span class="w"> </span>~/.ssh/&lt;YourKeyName&gt;.pem
</pre></div>
</div>
<p>We also set the permissions of the key pair file to <code class="docutils literal notranslate"><span class="pre">600</span></code> to ensure that only
the owner can read and write to the file.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>‚ùØ<span class="w"> </span>chmod<span class="w"> </span><span class="m">600</span><span class="w"> </span>~/.ssh/&lt;YourKeyName&gt;.pem
</pre></div>
</div>
</section>
<section id="configure-aws-parallelcluster">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Configure AWS ParallelCluster</a><a class="headerlink" href="#configure-aws-parallelcluster" title="Link to this heading">#</a></h2>
<p>First, we install the <code class="docutils literal notranslate"><span class="pre">aws-parallelcluster</span></code> package using <code class="docutils literal notranslate"><span class="pre">pip</span></code> so that we can
use the <code class="docutils literal notranslate"><span class="pre">pcluster</span></code> command.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>‚ùØ<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-U<span class="w"> </span>aws-parallelcluster
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>‚ùØ<span class="w"> </span>pcluster<span class="w"> </span>configure<span class="w"> </span>--config<span class="w"> </span>config.yaml
</pre></div>
</div>
<section id="review-the-configuration-file">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">1. Review the Configuration File</a><a class="headerlink" href="#review-the-configuration-file" title="Link to this heading">#</a></h3>
<p>Before proceeding, it‚Äôs a good idea to double-check your <code class="docutils literal notranslate"><span class="pre">config.yaml</span></code> file.
Make sure that all settings such as instance types, network configurations,
placement groups, and other parameters accurately meet your needs. Adjust any
settings if necessary. For example, I expected the <code class="docutils literal notranslate"><span class="pre">HeadNode</span></code> to be <code class="docutils literal notranslate"><span class="pre">t2.small</span></code>
and indeed it was.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">HeadNode</span><span class="p">:</span>
<span class="w">    </span><span class="nt">InstanceType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">t2.small</span>
</pre></div>
</div>
</section>
<section id="create-the-cluster">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">2. Create the Cluster</a><a class="headerlink" href="#create-the-cluster" title="Link to this heading">#</a></h3>
<p>Run the following command to create the cluster. Replace <code class="docutils literal notranslate"><span class="pre">cluster-name</span></code> with
your desired name for the cluster:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>‚ùØ<span class="w"> </span>pcluster<span class="w"> </span>create-cluster<span class="w"> </span>--cluster-configuration<span class="w"> </span>config.yaml<span class="w"> </span>--cluster-name<span class="w"> </span>&lt;YOUR-CLUSTER-NAME&gt;<span class="w"> </span>--region<span class="w"> </span>&lt;REGION&gt;
</pre></div>
</div>
<p>This command specifies the cluster configuration file (<code class="docutils literal notranslate"><span class="pre">config.yaml</span></code>), the name
of the cluster, and the AWS region where you want the cluster to be deployed.</p>
</section>
<section id="monitor-the-cluster-creation">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">3. Monitor the Cluster Creation</a><a class="headerlink" href="#monitor-the-cluster-creation" title="Link to this heading">#</a></h3>
<p>The cluster creation process may take some time. You can monitor the progress by
running the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>‚ùØ<span class="w"> </span>pcluster<span class="w"> </span>describe-cluster<span class="w"> </span>--cluster-name<span class="w"> </span>&lt;YOUR-CLUSTER-NAME&gt;<span class="w"> </span>--region<span class="w"> </span>ap-southeast-1
</pre></div>
</div>
</section>
</section>
<section id="shared-file-system">
<h2><a class="toc-backref" href="#id8" role="doc-backlink">Shared File System</a><a class="headerlink" href="#shared-file-system" title="Link to this heading">#</a></h2>
<p>Put your code or data in the shared file system, if not your compute nodes will
not be able to access them and have a copy of what you installed in the head
node. This means if you need to write or read data from the compute nodes, you
need to put them in the shared file system.</p>
<p>Thinks like FSx, EFS, or S3 can be used as shared file system but for a poor
man‚Äôs way and lazy way we can use <code class="docutils literal notranslate"><span class="pre">/home</span></code> as shared file system. Do not do this
in production. Remember to change to something like <code class="docutils literal notranslate"><span class="pre">777</span></code> for the shared
directory so that all nodes can access it.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>‚ùØ<span class="w"> </span>sudo<span class="w"> </span>chmod<span class="w"> </span>-R<span class="w"> </span><span class="m">777</span><span class="w"> </span>/home/multi_gpu_training
</pre></div>
</div>
<p>Alternatively, you can also mount an EFS volume to the head node and then share
it with the compute nodes. For example, you can add the below configuration to
the <code class="docutils literal notranslate"><span class="pre">config.yaml</span></code> file:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">SharedStorage</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">MountDir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/shared</span>
<span class="w">      </span><span class="nt">Name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-efs</span>
<span class="w">      </span><span class="nt">StorageType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Efs</span>
<span class="w">      </span><span class="nt">EfsSettings</span><span class="p">:</span>
<span class="w">          </span><span class="nt">PerformanceMode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">generalPurpose</span>
<span class="w">          </span><span class="nt">ThroughputMode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bursting</span>
</pre></div>
</div>
<p>EFS is cheap and can be used as a shared file system but if you want things like
FSx, which is for high performance computing, you can refer to a sample
<a class="reference external" href="https://github.com/pytorch/examples/blob/main/distributed/minGPT-ddp/mingpt/slurm/config.yaml.template">template from PyTorch</a>.</p>
</section>
<section id="logging-into-the-head-node">
<h2><a class="toc-backref" href="#id9" role="doc-backlink">Logging into the Head Node</a><a class="headerlink" href="#logging-into-the-head-node" title="Link to this heading">#</a></h2>
<p>During creation of the cluster, you can ssh into the head node using the
following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>‚ùØ<span class="w"> </span>pcluster<span class="w"> </span>ssh<span class="w"> </span>--cluster-name<span class="w"> </span>&lt;YOUR-CLUSTER-NAME&gt;<span class="w"> </span>-i<span class="w"> </span>&lt;path-to-your-key.pem&gt;<span class="w"> </span>--region<span class="w"> </span>&lt;REGION&gt;
</pre></div>
</div>
<p>Alternatively you can use normal ssh to login into the head node as well which
is useful if you are using vscode remote to login. First, get the public DNS of
the head node:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>‚ùØ<span class="w"> </span>aws<span class="w"> </span>ec2<span class="w"> </span>describe-instances<span class="w"> </span>--instance-ids<span class="w"> </span>&lt;INSTANCE-ID&gt;<span class="w"> </span>--query<span class="w"> </span><span class="s2">&quot;Reservations[*].Instances[*].PublicDnsName&quot;</span><span class="w"> </span>--output<span class="w"> </span>text
</pre></div>
</div>
<p>where the output of the previous command is the <code class="docutils literal notranslate"><span class="pre">&lt;public-dns&gt;</span></code>.</p>
<p>Then the ssh command is:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>‚ùØ<span class="w"> </span>ssh<span class="w"> </span>-i<span class="w"> </span>&lt;/path/to/your-key.pem&gt;<span class="w"> </span>&lt;username&gt;@&lt;public-dns&gt;
</pre></div>
</div>
<p>For <code class="docutils literal notranslate"><span class="pre">username</span></code> it defaults to <code class="docutils literal notranslate"><span class="pre">ubuntu</span></code> for Ubuntu AMIs.</p>
<section id="compute-node">
<h3><a class="toc-backref" href="#id10" role="doc-backlink">Compute Node</a><a class="headerlink" href="#compute-node" title="Link to this heading">#</a></h3>
<p>Due to quota limit, our compute node is <code class="docutils literal notranslate"><span class="pre">g4dn.xlarge</span></code> and has only 1 GPU per
node.</p>
</section>
<section id="slurm-status">
<h3><a class="toc-backref" href="#id11" role="doc-backlink">SLURM Status</a><a class="headerlink" href="#slurm-status" title="Link to this heading">#</a></h3>
<p>We can check status of the slurm cluster:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>‚ùØ<span class="w"> </span>sinfo

PARTITION<span class="w">          </span>AVAIL<span class="w">  </span>TIMELIMIT<span class="w">  </span>NODES<span class="w">  </span>STATE<span class="w"> </span>NODELIST
distributed-queue*<span class="w">    </span>up<span class="w">   </span>infinite<span class="w">      </span><span class="m">2</span><span class="w">   </span>idle<span class="w"> </span>distributed-queue-st-g4dnxlarge-<span class="o">[</span><span class="m">1</span>-2<span class="o">]</span>
</pre></div>
</div>
<p>And we can see the nodes are up and running. We can use <code class="docutils literal notranslate"><span class="pre">srun</span></code> to see if the
nodes are working:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>‚ùØ<span class="w"> </span>srun<span class="w"> </span>-N<span class="si">${</span><span class="nv">NUM_NODES</span><span class="si">}</span><span class="w"> </span>hostname
</pre></div>
</div>
</section>
<section id="setup-python-environment">
<h3><a class="toc-backref" href="#id12" role="doc-backlink">Setup Python Environment</a><a class="headerlink" href="#setup-python-environment" title="Link to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt-get<span class="w"> </span>update
sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>python3-venv
python3<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>/shared/venv/
<span class="nb">source</span><span class="w"> </span>/shared/venv/bin/activate
pip<span class="w"> </span>install<span class="w"> </span>wheel
<span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;source /shared/venv/bin/activate&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.bashrc
</pre></div>
</div>
<p>or with conda:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>wget<span class="w"> </span>https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh
bash<span class="w"> </span>Miniconda3-latest-Linux-x86_64.sh
<span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;&lt;/path/to/miniconda3&gt;/bin:</span><span class="nv">$PATH</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p>To add miniconda to module:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>/usr/share/modules/modulefiles
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>nano<span class="w"> </span>miniconda3
</pre></div>
</div>
<p>Add these to nano</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">#%Module1.0</span>
proc<span class="w"> </span>ModulesHelp<span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="o">}</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span>puts<span class="w"> </span>stderr<span class="w"> </span><span class="s2">&quot;Adds Miniconda3 to your environment variables.&quot;</span>
<span class="o">}</span>
module-whatis<span class="w"> </span><span class="s2">&quot;Loads Miniconda3 Environment.&quot;</span>
<span class="nb">set</span><span class="w"> </span>root<span class="w"> </span>/home/ubuntu/miniconda3
prepend-path<span class="w"> </span>PATH<span class="w"> </span><span class="nv">$root</span>/bin
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>module<span class="w"> </span>use<span class="w"> </span>/usr/share/modules/modulefiles
</pre></div>
</div>
</section>
</section>
<section id="sample-run">
<h2><a class="toc-backref" href="#id13" role="doc-backlink">Sample Run</a><a class="headerlink" href="#sample-run" title="Link to this heading">#</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda<span class="w"> </span>create<span class="w"> </span>-n<span class="w"> </span>ddp<span class="w"> </span><span class="nv">python</span><span class="o">=</span><span class="m">3</span>.8
pip<span class="w"> </span>install<span class="w"> </span>torch<span class="w"> </span>torchvision<span class="w"> </span>numpy
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>/
sudo<span class="w"> </span>mkdir<span class="w"> </span>shared
sudo<span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/PrincetonUniversity/multi_gpu_training.git
</pre></div>
</div>
<div class="highlight-slurm notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="kp">#SBATCH --job-name=ddp-torch     # create a short name for your job</span>
<span class="kp">#SBATCH --nodes=2                # node count</span>
<span class="kp">#SBATCH --ntasks-per-node=1      # total number of tasks per node</span>
<span class="kp">#SBATCH --cpus-per-task=4        # cpu-cores per task (&gt;1 if multi-threaded tasks)</span>
<span class="kp">#SBATCH --mem=15G                # total memory per node (match to the instance type)</span>
<span class="kp">#SBATCH --gres=gpu:1             # number of allocated GPUs per node</span>
<span class="kp">#SBATCH --time=00:01:00          # total run time limit (HH:MM:SS)</span>
<span class="kp">#SBATCH --output=job_%j.out      # Specify the file name for standard output</span>
<span class="kp">#SBATCH --error=job_%j.err       # Specify the file name for standard error</span>

<span class="c1"># Find a free port</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">MASTER_PORT</span><span class="o">=</span><span class="k">$(</span>shuf<span class="w"> </span>-i<span class="w"> </span><span class="m">6000</span>-9999<span class="w"> </span>-n<span class="w"> </span><span class="m">1</span><span class="k">)</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">WORLD_SIZE</span><span class="o">=</span><span class="k">$((</span><span class="nv">$SLURM_NNODES</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nv">$SLURM_NTASKS_PER_NODE</span><span class="k">))</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;WORLD_SIZE=&quot;</span><span class="nv">$WORLD_SIZE</span>

<span class="c1"># Define master address</span>
<span class="nv">master_addr</span><span class="o">=</span><span class="k">$(</span>scontrol<span class="w"> </span>show<span class="w"> </span>hostnames<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$SLURM_JOB_NODELIST</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-n<span class="w"> </span><span class="m">1</span><span class="k">)</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">MASTER_ADDR</span><span class="o">=</span><span class="nv">$master_addr</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;MASTER_ADDR=&quot;</span><span class="nv">$MASTER_ADDR</span>

<span class="c1"># Load modules and activate environment</span>
module<span class="w"> </span>purge
module<span class="w"> </span>load<span class="w"> </span>miniconda3
conda<span class="w"> </span>activate<span class="w"> </span>ddp

<span class="c1"># Run the distributed PyTorch program</span>
<span class="nb">srun</span><span class="w"> </span>python<span class="w"> </span>simple_dpp.py
</pre></div>
</div>
</section>
<section id="remember-the-logs-are-in-compute-nodes">
<h2><a class="toc-backref" href="#id14" role="doc-backlink">Remember The Logs Are In Compute Nodes</a><a class="headerlink" href="#remember-the-logs-are-in-compute-nodes" title="Link to this heading">#</a></h2>
<p>You can check the logs in the compute nodes. For example, you can ssh into the
compute node and check the logs.</p>
</section>
<section id="delete-cluster">
<h2><a class="toc-backref" href="#id15" role="doc-backlink">Delete Cluster</a><a class="headerlink" href="#delete-cluster" title="Link to this heading">#</a></h2>
<section id="delete-parallelcluster">
<h3><a class="toc-backref" href="#id16" role="doc-backlink">Delete ParallelCluster</a><a class="headerlink" href="#delete-parallelcluster" title="Link to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pcluster<span class="w"> </span>delete-cluster<span class="w"> </span>--cluster-name<span class="w"> </span>&lt;YOUR-CLUSTER-NAME&gt;<span class="w"> </span>--region<span class="w"> </span>&lt;REGION&gt;
</pre></div>
</div>
<p>and verify deletion:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pcluster<span class="w"> </span>list-clusters<span class="w"> </span>--region<span class="w"> </span>&lt;REGION&gt;
</pre></div>
</div>
</section>
<section id="delete-network-resources">
<h3><a class="toc-backref" href="#id17" role="doc-backlink">Delete Network Resources</a><a class="headerlink" href="#delete-network-resources" title="Link to this heading">#</a></h3>
<p>You also need to delete your lingering VPCs, subnets etc. First, we idenfity all
the network resources associated with the cluster including VPC, subnets etc. Go
<a class="reference external" href="https://ap-southeast-1.console.aws.amazon.com/vpcconsole/home?region=ap-southeast-1#Home:">here</a>
to see existing resources.</p>
<p>First get your subnet id from <code class="docutils literal notranslate"><span class="pre">config.yaml</span></code>.</p>
<p>Now we first delete NAT.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>aws<span class="w"> </span>ec2<span class="w"> </span>describe-subnets<span class="w"> </span>--subnet-ids<span class="w"> </span>&lt;subnet-XXX&gt;<span class="w"> </span>--query<span class="w"> </span><span class="s1">&#39;Subnets[0].VpcId&#39;</span><span class="w"> </span>--output<span class="w"> </span>text<span class="w"> </span><span class="c1"># get the VPC ID</span>
aws<span class="w"> </span>ec2<span class="w"> </span>describe-nat-gateways<span class="w"> </span>--filter<span class="w"> </span><span class="s2">&quot;Name=vpc-id,Values=&lt;vpc-XXX&gt;&quot;</span><span class="w"> </span><span class="c1"># get nat id in the form of nat-xxx</span>
aws<span class="w"> </span>ec2<span class="w"> </span>delete-nat-gateway<span class="w"> </span>--nat-gateway-id<span class="w"> </span>&lt;nat-XXX&gt;<span class="w"> </span><span class="c1"># delete the nat gateway</span>
aws<span class="w"> </span>ec2<span class="w"> </span>describe-nat-gateways<span class="w"> </span>--nat-gateway-ids<span class="w"> </span>&lt;nat-XXX&gt;<span class="w"> </span><span class="c1"># check if it is deleted</span>
</pre></div>
</div>
<p>Then we detach and delete network interfaces.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Detach network interfaces</span>
aws<span class="w"> </span>ec2<span class="w"> </span>describe-network-interfaces<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--filters<span class="w"> </span><span class="s2">&quot;Name=vpc-id,Values=&lt;vpc-XXX&gt;&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--query<span class="w"> </span><span class="s1">&#39;NetworkInterfaces[*].[NetworkInterfaceId,Attachment.AttachmentId]&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--output<span class="w"> </span>text<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>-r<span class="w"> </span>interface_id<span class="w"> </span>attachment_id<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>!<span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$attachment_id</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span>aws<span class="w"> </span>ec2<span class="w"> </span>detach-network-interface<span class="w"> </span>--attachment-id<span class="w"> </span><span class="nv">$attachment_id</span>
<span class="w">      </span><span class="k">fi</span>
<span class="w">    </span><span class="k">done</span>

<span class="c1"># Delete network interfaces</span>
aws<span class="w"> </span>ec2<span class="w"> </span>describe-network-interfaces<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--filters<span class="w"> </span><span class="s2">&quot;Name=vpc-id,Values=&lt;vpc-XXX&gt;&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--query<span class="w"> </span><span class="s1">&#39;NetworkInterfaces[*].NetworkInterfaceId&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--output<span class="w"> </span>text<span class="w"> </span><span class="p">|</span><span class="w"> </span>xargs<span class="w"> </span>-I<span class="w"> </span><span class="o">{}</span><span class="w"> </span>aws<span class="w"> </span>ec2<span class="w"> </span>delete-network-interface<span class="w"> </span>--network-interface-id<span class="w"> </span><span class="o">{}</span>

<span class="c1"># Run again to see if deleted or not</span>
aws<span class="w"> </span>ec2<span class="w"> </span>describe-network-interfaces<span class="w"> </span>--filters<span class="w"> </span><span class="s2">&quot;Name=vpc-id,Values=&lt;vpc-XXX&gt;&quot;</span>
</pre></div>
</div>
<p>Next, delete subnets</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>aws<span class="w"> </span>ec2<span class="w"> </span>describe-subnets<span class="w"> </span>--filters<span class="w"> </span><span class="s2">&quot;Name=vpc-id,Values=&lt;vpc-XXX&gt;&quot;</span><span class="w"> </span>--query<span class="w"> </span><span class="s1">&#39;Subnets[*].SubnetId&#39;</span><span class="w"> </span>--output<span class="w"> </span>text<span class="w"> </span><span class="p">|</span><span class="w"> </span>xargs<span class="w"> </span>-n<span class="w"> </span><span class="m">1</span><span class="w"> </span>-I<span class="w"> </span><span class="o">{}</span><span class="w"> </span>aws<span class="w"> </span>ec2<span class="w"> </span>delete-subnet<span class="w"> </span>--subnet-id<span class="w"> </span><span class="o">{}</span>
<span class="c1"># Check if deleted</span>
aws<span class="w"> </span>ec2<span class="w"> </span>describe-subnets<span class="w"> </span>--filters<span class="w"> </span><span class="s2">&quot;Name=vpc-id,Values=&lt;vpc-XXX&gt;&quot;</span><span class="w"> </span>--query<span class="w"> </span><span class="s1">&#39;Subnets[*].SubnetId&#39;</span><span class="w"> </span>--output<span class="w"> </span>text
</pre></div>
</div>
<p>Next, delete route tables</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>aws<span class="w"> </span>ec2<span class="w"> </span>describe-route-tables<span class="w"> </span>--filters<span class="w"> </span><span class="s2">&quot;Name=vpc-id,Values=&lt;vpc-XXX&gt;&quot;</span><span class="w"> </span>--query<span class="w"> </span><span class="s1">&#39;RouteTables[?Associations==`[]`].RouteTableId&#39;</span><span class="w"> </span>--output<span class="w"> </span>text<span class="w"> </span><span class="p">|</span><span class="w"> </span>xargs<span class="w"> </span>-n<span class="w"> </span><span class="m">1</span><span class="w"> </span>-I<span class="w"> </span><span class="o">{}</span><span class="w"> </span>aws<span class="w"> </span>ec2<span class="w"> </span>delete-route-table<span class="w"> </span>--route-table-id<span class="w"> </span><span class="o">{}</span>
</pre></div>
</div>
<p>Now delete the internet gateway</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># list the internet gateways</span>
aws<span class="w"> </span>ec2<span class="w"> </span>describe-internet-gateways<span class="w"> </span>--filters<span class="w"> </span><span class="s2">&quot;Name=attachment.vpc-id,Values=&lt;vpc-XXX&gt;&quot;</span><span class="w"> </span>--query<span class="w"> </span><span class="s1">&#39;InternetGateways[*].InternetGatewayId&#39;</span><span class="w"> </span>--output<span class="w"> </span>text

aws<span class="w"> </span>ec2<span class="w"> </span>detach-internet-gateway<span class="w"> </span>--internet-gateway-id<span class="w"> </span>&lt;igw-XXX&gt;<span class="w"> </span>--vpc-id<span class="w"> </span>&lt;vpc-XXX&gt;
aws<span class="w"> </span>ec2<span class="w"> </span>delete-internet-gateway<span class="w"> </span>--internet-gateway-id<span class="w"> </span>&lt;igw-XXX&gt;
</pre></div>
</div>
<p>Lastly, delete the VPC</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>aws<span class="w"> </span>ec2<span class="w"> </span>delete-vpc<span class="w"> </span>--vpc-id<span class="w"> </span>&lt;vpc-XXX&gt;
<span class="c1"># check if deleted</span>
aws<span class="w"> </span>ec2<span class="w"> </span>describe-vpcs<span class="w"> </span>--vpc-ids<span class="w"> </span>&lt;vpc-XXX&gt;
</pre></div>
</div>
</section>
</section>
<section id="troubleshooting">
<h2><a class="toc-backref" href="#id18" role="doc-backlink">Troubleshooting</a><a class="headerlink" href="#troubleshooting" title="Link to this heading">#</a></h2>
<p>Usually at this stage if you face slurm creation failure, we need to inspect the
logs. Usually during creation one can ssh into head node, and you can list out
<code class="docutils literal notranslate"><span class="pre">ls</span> <span class="pre">/var/log</span></code> to see a wide range of logs. Or you can just follow
<a class="reference external" href="https://docs.aws.amazon.com/parallelcluster/latest/ug/troubleshooting-v3-scaling-issues.html#troubleshooting-v3-key-logs">AWS‚Äôs documentation</a>
to see what logs they recommend. They have a comprehensive
<a class="reference external" href="https://docs.aws.amazon.com/parallelcluster/latest/ug/troubleshooting-fc-v3-create-cluster.html">guide</a>
on troubleshooting.</p>
<ol class="arabic">
<li><p>Check the system log from the head node (can be done in the AWS console):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>aws<span class="w"> </span>ec2<span class="w"> </span>get-console-output<span class="w"> </span>--instance-id<span class="w"> </span>&lt;instance-id&gt;<span class="w"> </span>--region<span class="w"> </span>ap-southeast-1<span class="w"> </span>--output<span class="w"> </span>text
</pre></div>
</div>
</li>
<li><p>You can also check relevant logs like:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>/var/log/cloud-init.log
cat<span class="w"> </span>/var/log/cloud-init-output.log
cat<span class="w"> </span>/var/log/cfn-init.log
cat<span class="w"> </span>/var/log/chef-client.log
cat<span class="w"> </span>slurmctld.log
cat<span class="w"> </span>parallelcluster/clusterstatusmgtd
</pre></div>
</div>
</li>
</ol>
<p>See a sample log that an user reported
<a class="reference external" href="https://github.com/aws/aws-parallelcluster/issues/5690">here</a>.</p>
<section id="failurecode-is-headnodebootstrapfailure-with-failurereason-cluster-creation-timed-out">
<h3><a class="toc-backref" href="#id19" role="doc-backlink">failureCode is HeadNodeBootstrapFailure with failureReason Cluster creation timed out</a><a class="headerlink" href="#failurecode-is-headnodebootstrapfailure-with-failurereason-cluster-creation-timed-out" title="Link to this heading">#</a></h3>
<p>For example, I faced the
<code class="docutils literal notranslate"><span class="pre">failureCode</span> <span class="pre">is</span> <span class="pre">HeadNodeBootstrapFailure</span> <span class="pre">with</span> <span class="pre">failureReason</span> <span class="pre">Cluster</span> <span class="pre">creation</span> <span class="pre">timed</span> <span class="pre">out</span></code>
but AWS has good guide to troubleshoot
<a class="reference external" href="https://docs.aws.amazon.com/parallelcluster/latest/ug/troubleshooting-fc-v3-create-cluster.html#create-cluster-head-node-bootstrap-timeout-failure-v3">here</a>.</p>
<p>Sometimes it is simply because your AWS account has not enough quotas. For me
the concrete error for this can be found in
<code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">cat</span> <span class="pre">/var/log/parallelcluster/clustermgtd.events</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">{</span><span class="s2">&quot;datetime&quot;</span>:<span class="w"> </span><span class="s2">&quot;2024-05-05T07:59:58.279+00:00&quot;</span>,<span class="w"> </span><span class="s2">&quot;version&quot;</span>:<span class="w"> </span><span class="m">0</span>,<span class="w"> </span><span class="s2">&quot;scheduler&quot;</span>:<span class="w"> </span><span class="s2">&quot;slurm&quot;</span>,<span class="w"> </span><span class="s2">&quot;cluster-name&quot;</span>:<span class="w"> </span><span class="s2">&quot;distributed-training&quot;</span>,<span class="w"> </span><span class="s2">&quot;node-role&quot;</span>:<span class="w"> </span><span class="s2">&quot;HeadNode&quot;</span>,<span class="w"> </span><span class="s2">&quot;component&quot;</span>:<span class="w"> </span><span class="s2">&quot;clustermgtd&quot;</span>,<span class="w"> </span><span class="s2">&quot;level&quot;</span>:<span class="w"> </span><span class="s2">&quot;WARNING&quot;</span>,<span class="w"> </span><span class="s2">&quot;instance-id&quot;</span>:<span class="w"> </span><span class="s2">&quot;i-08d41f68bf12ca54b&quot;</span>,<span class="w"> </span><span class="s2">&quot;event-type&quot;</span>:<span class="w"> </span><span class="s2">&quot;node-launch-failure-count&quot;</span>,<span class="w"> </span><span class="s2">&quot;message&quot;</span>:<span class="w"> </span><span class="s2">&quot;Number of static nodes that failed to launch a backing instance after node maintenance&quot;</span>,<span class="w"> </span><span class="s2">&quot;detail&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;failure-type&quot;</span>:<span class="w"> </span><span class="s2">&quot;vcpu-limit-failures&quot;</span>,<span class="w"> </span><span class="s2">&quot;count&quot;</span>:<span class="w"> </span><span class="m">1</span>,<span class="w"> </span><span class="s2">&quot;error-details&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;VcpuLimitExceeded&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;count&quot;</span>:<span class="w"> </span><span class="m">1</span>,<span class="w"> </span><span class="s2">&quot;nodes&quot;</span>:<span class="w"> </span><span class="o">[{</span><span class="s2">&quot;name&quot;</span>:<span class="w"> </span><span class="s2">&quot;distributed-queue-st-g4dn12xlarge-2&quot;</span><span class="o">}]}}}}</span>
</pre></div>
</div>
</section>
</section>
<section id="some-useful-commands">
<h2><a class="toc-backref" href="#id20" role="doc-backlink">Some Useful Commands</a><a class="headerlink" href="#some-useful-commands" title="Link to this heading">#</a></h2>
<section id="slurm-commands">
<h3><a class="toc-backref" href="#id21" role="doc-backlink">Slurm Commands</a><a class="headerlink" href="#slurm-commands" title="Link to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sinfo<span class="w"> </span><span class="c1"># show information about nodes</span>
squeue<span class="w"> </span><span class="c1"># show the queue</span>
</pre></div>
</div>
<p>Useful command to check if the nodes are working and returning the hostname:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>srun<span class="w"> </span>-N2<span class="w"> </span>hostname<span class="w"> </span><span class="c1"># run a command on 2 nodes to see if they are working, returns the hostname</span>
</pre></div>
</div>
<section id="how-many-gpus">
<h4><a class="toc-backref" href="#id22" role="doc-backlink">How Many GPUs?</a><a class="headerlink" href="#how-many-gpus" title="Link to this heading">#</a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>scontrol<span class="w"> </span>show<span class="w"> </span>nodes<span class="w"> </span><span class="c1"># show more detailed information about nodes</span>
sinfo<span class="w"> </span>-N<span class="w"> </span>-o<span class="w"> </span><span class="s2">&quot;%N %G&quot;</span><span class="w"> </span><span class="c1"># show the number of GPUs</span>
</pre></div>
</div>
</section>
</section>
<section id="find-the-instance-id">
<h3><a class="toc-backref" href="#id23" role="doc-backlink">Find the Instance ID</a><a class="headerlink" href="#find-the-instance-id" title="Link to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>aws<span class="w"> </span>ec2<span class="w"> </span>describe-instances<span class="w"> </span>--query<span class="w"> </span><span class="s2">&quot;Reservations[*].Instances[*].{InstanceID: InstanceId, PublicDNS: PublicDnsName, State: State.Name, Tags: Tags}&quot;</span><span class="w"> </span>--output<span class="w"> </span>table
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">table</span></code> format gives error like <code class="docutils literal notranslate"><span class="pre">list</span> <span class="pre">index</span> <span class="pre">out</span> <span class="pre">of</span> <span class="pre">range</span></code>, you can replace
<code class="docutils literal notranslate"><span class="pre">table</span></code> with <code class="docutils literal notranslate"><span class="pre">json</span></code> to slowly filter out.</p>
</section>
<section id="stop-ec2-instances">
<h3><a class="toc-backref" href="#id24" role="doc-backlink">Stop EC2 Instances</a><a class="headerlink" href="#stop-ec2-instances" title="Link to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>aws<span class="w"> </span>ec2<span class="w"> </span>stop-instances<span class="w"> </span>--instance-ids<span class="w"> </span>i-1234567890abcdef0<span class="w"> </span>i-abcdef1234567890
</pre></div>
</div>
</section>
</section>
<section id="references">
<h2><a class="toc-backref" href="#id25" role="doc-backlink">References</a><a class="headerlink" href="#references" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://www.hpcworkshops.com/index.html">https://www.hpcworkshops.com/index.html</a></p></li>
<li><p><a class="reference external" href="https://qywu.github.io/2020/12/09/aws-slumr-pytorch.html">https://qywu.github.io/2020/12/09/aws-slumr-pytorch.html</a></p></li>
<li><p><a class="reference external" href="https://aws-parallelcluster.readthedocs.io/en/latest/configuration.html">https://aws-parallelcluster.readthedocs.io/en/latest/configuration.html</a></p></li>
<li><p><a class="github reference external" href="https://github.com/pytorch/examples/blob/main/distributed/minGPT-ddp/mingpt/slurm/config.yaml.template">pytorch/examples</a></p></li>
<li><p><a class="github reference external" href="https://github.com/PrincetonUniversity/multi_gpu_training/tree/main">PrincetonUniversity/multi_gpu_training</a></p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./operations/distributed"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="notations.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Distributed Training in Deep Learning</p>
      </div>
    </a>
    <a class="right-next"
       href="../../bibliography.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Bibliography</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-up-identity-and-access-management-iam-role">Setting Up Identity and Access Management (IAM) Role</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#configure-aws-cli">Configure AWS CLI</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-ec2-key-pair">Create EC2 Key Pair</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#configure-aws-parallelcluster">Configure AWS ParallelCluster</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#review-the-configuration-file">1. Review the Configuration File</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#create-the-cluster">2. Create the Cluster</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#monitor-the-cluster-creation">3. Monitor the Cluster Creation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#shared-file-system">Shared File System</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#logging-into-the-head-node">Logging into the Head Node</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#compute-node">Compute Node</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#slurm-status">SLURM Status</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setup-python-environment">Setup Python Environment</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sample-run">Sample Run</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#remember-the-logs-are-in-compute-nodes">Remember The Logs Are In Compute Nodes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#delete-cluster">Delete Cluster</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#delete-parallelcluster">Delete ParallelCluster</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#delete-network-resources">Delete Network Resources</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#troubleshooting">Troubleshooting</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#failurecode-is-headnodebootstrapfailure-with-failurereason-cluster-creation-timed-out">failureCode is HeadNodeBootstrapFailure with failureReason Cluster creation timed out</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#some-useful-commands">Some Useful Commands</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#slurm-commands">Slurm Commands</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#how-many-gpus">How Many GPUs?</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#find-the-instance-id">Find the Instance ID</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#stop-ec2-instances">Stop EC2 Instances</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Gao Hongnan
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      ¬© Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>