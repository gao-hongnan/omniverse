
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>How to Setup SLURM and ParallelCluster in AWS &#8212; Omniverse</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css?v=4c969af8" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=bb35926c" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script src="../../_static/tabs.js?v=3ee01567"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-MYW5YKC2WF"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-MYW5YKC2WF');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-MYW5YKC2WF');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'operations/distributed/03_how_to_setup_slurm_in_aws';</script>
    <link rel="canonical" href="https://www.gaohongnan.com/operations/distributed/03_how_to_setup_slurm_in_aws.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Ablations" href="04_ablation.html" />
    <link rel="prev" title="Basics Of Distributed Data Parallelism" href="02_basics.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo.png" class="logo__image only-light" alt="Omniverse - Home"/>
    <script>document.write(`<img src="../../_static/logo.png" class="logo__image only-dark" alt="Omniverse - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    Omniverse
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Notations</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../notations/machine_learning.html">Machine Learning Notations</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Influential Ideas and Papers</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../influential/generative_pretrained_transformer/01_intro.html">Generative Pre-trained Transformers</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../influential/generative_pretrained_transformer/02_notations.html">Notations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../influential/generative_pretrained_transformer/03_concept.html">The Concept of Generative Pre-trained Transformers (GPT)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../influential/generative_pretrained_transformer/04_implementation.html">The Implementation of Generative Pre-trained Transformers (GPT)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../influential/generative_pretrained_transformer/05_adder.html">Training a Mini-GPT to Learn Two-Digit Addition</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../influential/low_rank_adaptation/01_intro.html">Low-Rank Adaptation Of Large Language Models</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../influential/low_rank_adaptation/02_concept.html">Concept</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../influential/low_rank_adaptation/03_implementation.html">Implementation</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../influential/empirical_risk_minimization/01_intro.html">Empirical Risk Minimization</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../influential/empirical_risk_minimization/02_concept.html">Concept: Empirical Risk Minimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../influential/empirical_risk_minimization/03_bayes_optimal_classifier.html">Bayes Optimal Classifier</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../influential/learning_theory/01_intro.html">Is The Learning Problem Solvable?</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../influential/learning_theory/02_concept.html">Concept: Learning Theory</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../influential/kmeans_clustering/01_intro.html">Lloyd’s K-Means Clustering Algorithm</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../influential/kmeans_clustering/02_concept.html">Concept: K-Means Clustering</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../influential/kmeans_clustering/03_implementation.html">Implementation: K-Means (Lloyd)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../influential/kmeans_clustering/04_image_segmentation.html">Application: Image Compression and Segmentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../influential/kmeans_clustering/05_conceptual_questions.html">Conceptual Questions</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../influential/naive_bayes/01_intro.html">Naive Bayes</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../influential/naive_bayes/02_concept.html">Concept</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../influential/naive_bayes/03_implementation.html">Naives Bayes Implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../influential/naive_bayes/04_example_penguins.html">Naive Bayes Application: Penguins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../influential/naive_bayes/05_application_mnist.html">Naive Bayes Application (MNIST)</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../influential/gaussian_mixture_models/01_intro.html">Mixture Models</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../influential/gaussian_mixture_models/02_concept.html">Concept</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../influential/gaussian_mixture_models/03_implementation.html">Gaussian Mixture Models Implementation</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../influential/linear_regression/01_intro.html">Linear Regression</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../influential/linear_regression/02_concept.html">Concept</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../influential/linear_regression/03_implementation.html">Implementation</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Playbook</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../playbook/training/intro.html">Training Dynamics And Tricks</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../playbook/training/how_to_calculate_flops_in_transformer_based_models.html">How to Calculate the Number of FLOPs in Transformer Based Models?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../playbook/training/why_cosine_annealing_warmup_stabilize_training.html">Why Does Cosine Annealing With Warmup Stabilize Training?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../playbook/training/how_to_finetune_decoder_with_last_token_pooling.html">How To Fine-Tune Decoder-Only Models For Sequence Classification Using Last Token Pooling?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../playbook/training/how_to_finetune_decoder_with_cross_attention.html">How To Fine-Tune Decoder-Only Models For Sequence Classification With Cross-Attention?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../playbook/training/how_to_teacher_student_knowledge_distillation.html">How To Do Teacher-Student Knowledge Distillation?</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../playbook/why_softmax_preserves_order_translation_invariant_not_invariant_scaling.html">Softmax Preserves Order, Is Translation Invariant But Not Invariant Under Scaling.</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../playbook/how_to_inspect_function_and_class_signatures.html">How to Inspect Function and Class Signatures in Python?</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Probability Theory</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../probability_theory/01_mathematical_preliminaries/intro.html">Chapter 1. Mathematical Preliminaries</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../probability_theory/01_mathematical_preliminaries/01_combinatorics.html">Permutations and Combinations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../probability_theory/01_mathematical_preliminaries/02_calculus.html">Calculus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../probability_theory/01_mathematical_preliminaries/03_contours.html">Contour Maps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../probability_theory/01_mathematical_preliminaries/exercises.html">Exercises</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../probability_theory/02_probability/intro.html">Chapter 2. Probability</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../probability_theory/02_probability/0202_probability_space.html">Probability Space</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../probability_theory/02_probability/0203_probability_axioms.html">Probability Axioms</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../probability_theory/02_probability/0204_conditional_probability.html">Conditional Probability</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../probability_theory/02_probability/0205_independence.html">Independence</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../probability_theory/02_probability/0206_bayes_theorem.html">Baye’s Theorem and the Law of Total Probability</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../probability_theory/02_probability/summary.html">Summary</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../probability_theory/03_discrete_random_variables/intro.html">Chapter 3. Discrete Random Variables</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../probability_theory/03_discrete_random_variables/0301_random_variables.html">Random Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../probability_theory/03_discrete_random_variables/0302_discrete_random_variables.html">Discrete Random Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../probability_theory/03_discrete_random_variables/0303_probability_mass_function.html">Probability Mass Function</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../probability_theory/03_discrete_random_variables/0304_cumulative_distribution_function.html">Cumulative Distribution Function</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../probability_theory/03_discrete_random_variables/0305_expectation.html">Expectation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../probability_theory/03_discrete_random_variables/0306_moments_and_variance.html">Moments and Variance</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../probability_theory/03_discrete_random_variables/uniform/intro.html">Discrete Uniform Distribution</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../probability_theory/03_discrete_random_variables/uniform/0307_discrete_uniform_distribution_concept.html">Concept</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../probability_theory/03_discrete_random_variables/uniform/0307_discrete_uniform_distribution_application.html">Application</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../probability_theory/03_discrete_random_variables/bernoulli/intro.html">Bernoulli Distribution</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../probability_theory/03_discrete_random_variables/bernoulli/0308_bernoulli_distribution_concept.html">Concept</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../probability_theory/03_discrete_random_variables/bernoulli/0308_bernoulli_distribution_application.html">Application</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../../probability_theory/03_discrete_random_variables/iid.html">Independent and Identically Distributed (IID)</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../probability_theory/03_discrete_random_variables/binomial/intro.html">Binomial Distribution</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../probability_theory/03_discrete_random_variables/binomial/0309_binomial_distribution_concept.html">Concept</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../probability_theory/03_discrete_random_variables/binomial/0309_binomial_distribution_implementation.html">Implementation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../probability_theory/03_discrete_random_variables/binomial/0309_binomial_distribution_application.html">Real World Examples</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../probability_theory/03_discrete_random_variables/geometric/intro.html">Geometric Distribution</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../probability_theory/03_discrete_random_variables/geometric/0310_geometric_distribution_concept.html">Concept</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../probability_theory/03_discrete_random_variables/poisson/intro.html">Poisson Distribution</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../probability_theory/03_discrete_random_variables/poisson/0311_poisson_distribution_concept.html">Concept</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../probability_theory/03_discrete_random_variables/poisson/0311_poisson_distribution_implementation.html">Implementation</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../../probability_theory/03_discrete_random_variables/summary.html">Important</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../probability_theory/03_discrete_random_variables/exercises.html">Exercises</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../probability_theory/04_continuous_random_variables/intro.html">Chapter 4. Continuous Random Variables</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../probability_theory/04_continuous_random_variables/from_discrete_to_continuous.html">From Discrete to Continuous</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../probability_theory/04_continuous_random_variables/0401_continuous_random_variables.html">Continuous Random Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../probability_theory/04_continuous_random_variables/0402_probability_density_function.html">Probability Density Function</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../probability_theory/04_continuous_random_variables/0403_expectation.html">Expectation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../probability_theory/04_continuous_random_variables/0404_moments_and_variance.html">Moments and Variance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../probability_theory/04_continuous_random_variables/0405_cumulative_distribution_function.html">Cumulative Distribution Function</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../probability_theory/04_continuous_random_variables/0406_mean_median_mode.html">Mean, Median and Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../probability_theory/04_continuous_random_variables/0407_continuous_uniform_distribution.html">Continuous Uniform Distribution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../probability_theory/04_continuous_random_variables/0408_exponential_distribution.html">Exponential Distribution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../probability_theory/04_continuous_random_variables/0409_gaussian_distribution.html">Gaussian Distribution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../probability_theory/04_continuous_random_variables/0410_skewness_and_kurtosis.html">Skewness and Kurtosis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../probability_theory/04_continuous_random_variables/0411_convolve_and_sum_of_random_variables.html">Convolution and Sum of Random Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../probability_theory/04_continuous_random_variables/0412_functions_of_random_variables.html">Functions of Random Variables</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../probability_theory/05_joint_distributions/intro.html">Chapter 5. Joint Distributions</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../probability_theory/05_joint_distributions/from_single_variable_to_joint_distributions.html">From Single Variable to Joint Distributions</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../probability_theory/05_joint_distributions/0501_joint_pmf_pdf/intro.html">Joint PMF and PDF</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../probability_theory/05_joint_distributions/0501_joint_pmf_pdf/concept.html">Concept</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../probability_theory/05_joint_distributions/0502_joint_expectation_and_correlation/intro.html">Joint Expectation and Correlation</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../probability_theory/05_joint_distributions/0502_joint_expectation_and_correlation/concept.html">Concept</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../probability_theory/05_joint_distributions/0503_conditional_pmf_pdf/intro.html">Conditional PMF and PDF</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../probability_theory/05_joint_distributions/0503_conditional_pmf_pdf/concept.html">Concept</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../probability_theory/05_joint_distributions/0503_conditional_pmf_pdf/application.html">Application</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../probability_theory/05_joint_distributions/0504_conditional_expectation_variance/intro.html">Conditional Expectation and Variance</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../probability_theory/05_joint_distributions/0504_conditional_expectation_variance/concept.html">Concept</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../probability_theory/05_joint_distributions/0504_conditional_expectation_variance/exercises.html">Exercises</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../probability_theory/05_joint_distributions/0505_sum_of_random_variables/intro.html">Sum of Random Variables</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../probability_theory/05_joint_distributions/0505_sum_of_random_variables/concept.html">Concept</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../probability_theory/05_joint_distributions/0506_random_vectors/intro.html">Random Vectors</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../probability_theory/05_joint_distributions/0506_random_vectors/concept.html">Concept</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../probability_theory/05_joint_distributions/0507_multivariate_gaussian/intro.html">Multivariate Gaussian Distribution</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../probability_theory/05_joint_distributions/0507_multivariate_gaussian/concept.html">Concept</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../probability_theory/05_joint_distributions/0507_multivariate_gaussian/application_transformation.html">Application: Plots and Transformations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../probability_theory/05_joint_distributions/0507_multivariate_gaussian/psd.html">Covariance Matrix is Positive Semi-Definite</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../probability_theory/05_joint_distributions/0507_multivariate_gaussian/eigendecomposition.html">Eigendecomposition and Covariance Matrix</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../probability_theory/05_joint_distributions/0507_multivariate_gaussian/geometry_of_multivariate_gaussian.html">The Geometry of Multivariate Gaussians</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../probability_theory/06_sample_statistics/intro.html">Chapter 6. Sample Statistics</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../probability_theory/06_sample_statistics/0601_moment_generating_and_characteristic_functions/intro.html">Moment Generating and Characteristic Functions</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../probability_theory/06_sample_statistics/0601_moment_generating_and_characteristic_functions/moment_generating_function.html">Moment Generating Function</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../probability_theory/06_sample_statistics/0601_moment_generating_and_characteristic_functions/moment_generating_function_application_sum_of_rv.html">Application: Moment Generating Function and the Sum of Random Variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../probability_theory/06_sample_statistics/0601_moment_generating_and_characteristic_functions/characteristic_function.html">Characteristic Function</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../probability_theory/06_sample_statistics/0602_probability_inequalities/intro.html">Probability Inequalities</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../probability_theory/06_sample_statistics/0602_probability_inequalities/concept.html">Probability Inequalities</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../probability_theory/06_sample_statistics/0602_probability_inequalities/application.html">Application: Learning Theory</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../probability_theory/06_sample_statistics/0603_law_of_large_numbers/intro.html">Law of Large Numbers</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../probability_theory/06_sample_statistics/0603_law_of_large_numbers/concept.html">Concept</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../probability_theory/06_sample_statistics/0603_law_of_large_numbers/convergence.html">Convergence of Sample Average</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../probability_theory/06_sample_statistics/0603_law_of_large_numbers/application.html">Application: Learning Theory</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../probability_theory/08_estimation_theory/intro.html">Chapter 8. Estimation Theory</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../probability_theory/08_estimation_theory/maximum_likelihood_estimation/intro.html">Maximum Likelihood Estimation</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../probability_theory/08_estimation_theory/maximum_likelihood_estimation/concept.html">Concept</a></li>
</ul>
</details></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Operations</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="intro.html">Distributed Systems</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="01_notations.html">Notations</a></li>
<li class="toctree-l2"><a class="reference internal" href="02_basics.html">Basics Of Distributed Data Parallelism</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">How to Setup SLURM and ParallelCluster in AWS</a></li>
<li class="toctree-l2"><a class="reference internal" href="04_ablation.html">Ablations</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../profiling/intro.html">Profiling</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../profiling/01_synchronize.html">Synchronize CUDA To Time CUDA Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../profiling/02_timeit.html">Profiling Code With Timeit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../profiling/03_time_profiler.html">PyTorch’s Event And Profiler</a></li>
<li class="toctree-l2"><a class="reference internal" href="../profiling/04_small_gpt_profile.html">Profile GPT Small Time And Memory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../profiling/05_memory_leak.html">CUDA Memory Allocations</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../machine_learning_lifecycle/00_intro.html">The Lifecycle of an AIOps System</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../machine_learning_lifecycle/01_problem_formulation.html">Stage 1. Problem Formulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../machine_learning_lifecycle/02_project_scoping.html">Stage 2. Project Scoping And Framing The Problem</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../machine_learning_lifecycle/03_dataops_pipeline/03_dataops_pipeline.html">Stage 3. Data Pipeline (Data Engineering and DataOps)</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../machine_learning_lifecycle/03_dataops_pipeline/031_data_source_and_format.html">Stage 3.1. Data Source and Formats</a></li>
<li class="toctree-l3"><a class="reference internal" href="../machine_learning_lifecycle/03_dataops_pipeline/032_data_model_and_storage.html">Stage 3.2. Data Model and Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../machine_learning_lifecycle/03_dataops_pipeline/033_etl.html">Stage 3.3. Extract, Transform, Load (ETL)</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../machine_learning_lifecycle/04_mlops_data_pipeline.html">Stage 4. Data Extraction (MLOps), Data Analysis (Data Science), Data Preparation (Data Science)</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../machine_learning_lifecycle/05_model_development_selection_and_training/05_ml_training_pipeline.html">Stage 5. Model Development and Training (MLOps)</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../machine_learning_lifecycle/05_model_development_selection_and_training/051_model_selection.html">Stage 5.1. Model Selection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../machine_learning_lifecycle/05_model_development_selection_and_training/052_metric_selection.html">Stage 5.2. Metric Selection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../machine_learning_lifecycle/05_model_development_selection_and_training/053_experiment_tracking.html">Stage 5.3. Experiment Tracking And Versioning</a></li>
<li class="toctree-l3"><a class="reference internal" href="../machine_learning_lifecycle/05_model_development_selection_and_training/054_model_testing.html">Stage 5.4. Model Testing</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../machine_learning_lifecycle/06_model_evaluation.html">Stage 6. Model Evaluation (MLOps)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../machine_learning_lifecycle/07_model_validation_registry_and_pushing_model_to_production.html">Stage 7. Model Validation, Registry and Pushing Model to Production (MLOps)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../machine_learning_lifecycle/08_model_deployment_and_serving.html">Stage 8. Model Serving (MLOps)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../machine_learning_lifecycle/09_model_monitoring.html">Stage 9. Model Monitoring (MLOps)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../machine_learning_lifecycle/010_continuous_integration_deployment_learning_and_training.html">Stage 10. Continuous Integration, Deployment, Learning and Training (DevOps, DataOps, MLOps)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../machine_learning_lifecycle/011_infrastructure_and_tooling_for_mlops.html">Stage 11. Infrastructure and Tooling for MLOps</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Software Engineering</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../software_engineering/config_management/intro.html">Config, State, Metadata Management</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../software_engineering/config_management/concept.html">Configuration Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../software_engineering/config_management/01-pydra.html">Pydantic And Hydra</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../software_engineering/config_management/02-state.html">State And Metadata Management</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../software_engineering/design_patterns/intro.html">Design Patterns</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../software_engineering/design_patterns/dependency_inversion_principle.html">Dependency Inversion Principle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../software_engineering/design_patterns/named_constructor.html">Named Constructor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../software_engineering/design_patterns/strategy.html">Strategy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../software_engineering/design_patterns/registry.html">Registry</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../software_engineering/design_patterns/god_object_pattern.html">Context Object Pattern (God Object)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../software_engineering/design_patterns/factory_method.html">Factory Method</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../software_engineering/python/intro.html">Python</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../software_engineering/python/iterator_protocol.html">The Iterator Protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../software_engineering/python/decorator.html">Decorator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../software_engineering/python/generators_over_lists.html">Generators Over Lists For Memory Efficiency</a></li>




<li class="toctree-l2"><a class="reference internal" href="../../software_engineering/python/pydantic.html">Pydantic Is All You Need - Jason Liu</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../software_engineering/concurrency_parallelism_asynchronous/intro.html">Concurrency, Parallelism and Asynchronous Programming</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../software_engineering/concurrency_parallelism_asynchronous/overview.html">Notations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../software_engineering/concurrency_parallelism_asynchronous/generator_yield.html">A Rudimentary Introduction to Generator and Yield in Python</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Computer Science</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../computer_science/type_theory/intro.html">Type Theory, A Very Rudimentary Introduction</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../computer_science/type_theory/01-subtypes.html">Subtypes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../computer_science/type_theory/02-type-safety.html">Type Safety</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../computer_science/type_theory/03-subsumption.html">Subsumption</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../computer_science/type_theory/04-generics.html">Generics and Type Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../computer_science/type_theory/05-typevar-bound-constraints.html">Bound and Constraint in Generics and Type Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../computer_science/type_theory/06-invariance-covariance-contravariance.html">Invariance, Covariance and Contravariance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../computer_science/type_theory/07-pep-3124-overloading.html">Function Overloading</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../computer_science/type_theory/08-pep-661-sentinel-values.html">Sentinel Types</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Data Structures and Algorithms</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../dsa/complexity_analysis/intro.html">Complexity Analysis</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../dsa/complexity_analysis/master_theorem.html">Master Theorem </a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../dsa/stack/intro.html">Stack</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../dsa/stack/concept.html">Concept</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../dsa/searching_algorithms/linear_search/intro.html">Linear Search</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../dsa/searching_algorithms/linear_search/concept.html">Concept</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../dsa/searching_algorithms/binary_search/intro.html">Binary Search</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../dsa/searching_algorithms/binary_search/concept.html">Concept</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dsa/searching_algorithms/binary_search/problems/875-koko-eating-bananas.html">Koko Eating Bananas</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Linear Algebra</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../linear_algebra/01_preliminaries/intro.html">Preliminaries</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../linear_algebra/01_preliminaries/01-fields.html">Fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../linear_algebra/01_preliminaries/02-systems-of-linear-equations.html">Systems of Linear Equations</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../linear_algebra/02_vectors/intro.html">Vectors</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../linear_algebra/02_vectors/01-vector-definition.html">Vector and Its Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../linear_algebra/02_vectors/02-vector-operation.html">Vector and Its Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../linear_algebra/02_vectors/03-vector-norm.html">Vector Norm and Distance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../linear_algebra/02_vectors/04-vector-products.html">A First Look at Vector Products</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">References, Resources and Roadmap</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../bibliography.html">Bibliography</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../citations.html">IEEE (Style) Citations</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/gao-hongnan/omniverse" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/gao-hongnan/omniverse/issues/new?title=Issue%20on%20page%20%2Foperations/distributed/03_how_to_setup_slurm_in_aws.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/operations/distributed/03_how_to_setup_slurm_in_aws.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>How to Setup SLURM and ParallelCluster in AWS</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-up-identity-and-access-management-iam-role">Setting Up Identity and Access Management (IAM) Role</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#configure-aws-cli">Configure AWS CLI</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-ec2-key-pair">Create EC2 Key Pair</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#configure-aws-parallelcluster">Configure AWS ParallelCluster</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#review-the-configuration-file">1. Review the Configuration File</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#create-the-cluster">2. Create the Cluster</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#monitor-the-cluster-creation">3. Monitor the Cluster Creation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#shared-file-system">Shared File System</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#logging-into-the-head-node">Logging into the Head Node</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#compute-node">Compute Node</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#slurm-status">SLURM Status</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setup-python-environment">Setup Python Environment</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#virtual-environment">Virtual Environment</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#miniconda">Miniconda</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sample-run">Sample Run</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#delete-cluster">Delete Cluster</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#delete-parallelcluster">Delete ParallelCluster</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#delete-network-resources">Delete Network Resources</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#consolidated-script">Consolidated Script</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#troubleshooting">Troubleshooting</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#failurecode-is-headnodebootstrapfailure-with-failurereason-cluster-creation-timed-out">failureCode is HeadNodeBootstrapFailure with failureReason Cluster creation timed out</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#some-useful-commands">Some Useful Commands</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#slurm-commands">Slurm Commands</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#how-many-gpus">How Many GPUs?</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#find-the-instance-id">Find the Instance ID</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#stop-ec2-instances">Stop EC2 Instances</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#singularity">Singularity</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="how-to-setup-slurm-and-parallelcluster-in-aws">
<h1>How to Setup SLURM and ParallelCluster in AWS<a class="headerlink" href="#how-to-setup-slurm-and-parallelcluster-in-aws" title="Link to this heading">#</a></h1>
<p><a class="reference external" href="https://twitter.com/gaohongnan"><img alt="Twitter Handle" src="https://img.shields.io/badge/Twitter-&#64;gaohongnan-blue?style=social&amp;logo=twitter" /></a>
<a class="reference external" href="https://linkedin.com/in/gao-hongnan"><img alt="LinkedIn Profile" src="https://img.shields.io/badge/&#64;gaohongnan-blue?style=social&amp;logo=linkedin" /></a>
<a class="reference external" href="https://github.com/gao-hongnan"><img alt="GitHub Profile" src="https://img.shields.io/badge/GitHub-gao--hongnan-lightgrey?style=social&amp;logo=github" /></a>
<img alt="Tag" src="https://img.shields.io/badge/Tag-Brain_Dump-red" />
<img alt="Tag" src="https://img.shields.io/badge/Level-Beginner-green" /></p>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#setting-up-identity-and-access-management-iam-role" id="id1">Setting Up Identity and Access Management (IAM) Role</a></p></li>
<li><p><a class="reference internal" href="#configure-aws-cli" id="id2">Configure AWS CLI</a></p></li>
<li><p><a class="reference internal" href="#create-ec2-key-pair" id="id3">Create EC2 Key Pair</a></p></li>
<li><p><a class="reference internal" href="#configure-aws-parallelcluster" id="id4">Configure AWS ParallelCluster</a></p>
<ul>
<li><p><a class="reference internal" href="#review-the-configuration-file" id="id5">1. Review the Configuration File</a></p></li>
<li><p><a class="reference internal" href="#create-the-cluster" id="id6">2. Create the Cluster</a></p></li>
<li><p><a class="reference internal" href="#monitor-the-cluster-creation" id="id7">3. Monitor the Cluster Creation</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#shared-file-system" id="id8">Shared File System</a></p></li>
<li><p><a class="reference internal" href="#logging-into-the-head-node" id="id9">Logging into the Head Node</a></p>
<ul>
<li><p><a class="reference internal" href="#compute-node" id="id10">Compute Node</a></p></li>
<li><p><a class="reference internal" href="#slurm-status" id="id11">SLURM Status</a></p></li>
<li><p><a class="reference internal" href="#setup-python-environment" id="id12">Setup Python Environment</a></p>
<ul>
<li><p><a class="reference internal" href="#virtual-environment" id="id13">Virtual Environment</a></p></li>
<li><p><a class="reference internal" href="#miniconda" id="id14">Miniconda</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#sample-run" id="id15">Sample Run</a></p></li>
<li><p><a class="reference internal" href="#delete-cluster" id="id16">Delete Cluster</a></p>
<ul>
<li><p><a class="reference internal" href="#delete-parallelcluster" id="id17">Delete ParallelCluster</a></p></li>
<li><p><a class="reference internal" href="#delete-network-resources" id="id18">Delete Network Resources</a></p></li>
<li><p><a class="reference internal" href="#consolidated-script" id="id19">Consolidated Script</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#troubleshooting" id="id20">Troubleshooting</a></p>
<ul>
<li><p><a class="reference internal" href="#failurecode-is-headnodebootstrapfailure-with-failurereason-cluster-creation-timed-out" id="id21">failureCode is HeadNodeBootstrapFailure with failureReason Cluster creation timed out</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#some-useful-commands" id="id22">Some Useful Commands</a></p>
<ul>
<li><p><a class="reference internal" href="#slurm-commands" id="id23">Slurm Commands</a></p>
<ul>
<li><p><a class="reference internal" href="#how-many-gpus" id="id24">How Many GPUs?</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#find-the-instance-id" id="id25">Find the Instance ID</a></p></li>
<li><p><a class="reference internal" href="#stop-ec2-instances" id="id26">Stop EC2 Instances</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#singularity" id="id27">Singularity</a></p></li>
<li><p><a class="reference internal" href="#references" id="id28">References</a></p></li>
</ul>
</nav>
<p>This guide will help you set up your AWS environment and install AWS CLI and AWS
ParallelCluster.</p>
<p>Note that the version of AWS that works as of writing is below:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>awscli<span class="w">                              </span><span class="m">1</span>.32.93
aws-parallelcluster<span class="w">                 </span><span class="m">3</span>.9.1
</pre></div>
</div>
<p>Some breaking updates may render current commands invalid.</p>
<section id="setting-up-identity-and-access-management-iam-role">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Setting Up Identity and Access Management (IAM) Role</a><a class="headerlink" href="#setting-up-identity-and-access-management-iam-role" title="Link to this heading">#</a></h2>
<p>Before deploying AWS ParallelCluster, it’s essential to configure an IAM role
with appropriate permissions. This role ensures that AWS ParallelCluster has the
necessary permissions to manage AWS resources on your behalf, such as EC2
instances, networking components, and storage systems.</p>
<p>The rough steps are as follows:</p>
<ul class="simple">
<li><p>Navigate to the <a class="reference external" href="https://console.aws.amazon.com/iam/">IAM console</a> in AWS.</p></li>
<li><p>Create a new IAM user or use an existing one.</p></li>
<li><p>Ensure the user has an IAM role with <code class="docutils literal notranslate"><span class="pre">AdministratorAccess</span></code> or attach the
<code class="docutils literal notranslate"><span class="pre">AdministratorAccess</span></code> policy directly. While convenient, using
<code class="docutils literal notranslate"><span class="pre">AdministratorAccess</span></code> can pose security risks if not managed carefully. It’s
recommended to scope down the permissions to least privilege principles if
you are working in a team or production environment. For educational
purposes, it’s fine to use <code class="docutils literal notranslate"><span class="pre">AdministratorAccess</span></code>.</p></li>
<li><p>Generate an <strong>AWS Access Key ID</strong> and <strong>AWS Secret Access Key</strong> for
command-line access - you can find them in the user’s security credentials
tab in the IAM console.</p></li>
</ul>
</section>
<section id="configure-aws-cli">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Configure AWS CLI</a><a class="headerlink" href="#configure-aws-cli" title="Link to this heading">#</a></h2>
<p>First we install the python package <code class="docutils literal notranslate"><span class="pre">awscli</span></code> using <code class="docutils literal notranslate"><span class="pre">pip</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>❯<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>--upgrade<span class="w"> </span>awscli
</pre></div>
</div>
<p>Then we configure the AWS CLI:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>❯<span class="w"> </span>aws<span class="w"> </span>configure
AWS<span class="w"> </span>Access<span class="w"> </span>Key<span class="w"> </span>ID<span class="w"> </span><span class="o">[</span>None<span class="o">]</span>:<span class="w"> </span>&lt;AWS_ACCESS_KEY&gt;
AWS<span class="w"> </span>Secret<span class="w"> </span>Access<span class="w"> </span>Key<span class="w"> </span><span class="o">[</span>None<span class="o">]</span>:<span class="w"> </span>&lt;AWS_SECRET_KEY&gt;
Default<span class="w"> </span>region<span class="w"> </span>name<span class="w"> </span><span class="o">[</span>None<span class="o">]</span>:<span class="w"> </span>ap-southeast-1
Default<span class="w"> </span>output<span class="w"> </span>format<span class="w"> </span><span class="o">[</span>None<span class="o">]</span>:<span class="w"> </span>json
</pre></div>
</div>
<p>Replace <code class="docutils literal notranslate"><span class="pre">&lt;AWS_ACCESS_KEY&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;AWS_SECRET_KEY&gt;</span></code> with your actual AWS
credentials. And since we want a region close to home we set <code class="docutils literal notranslate"><span class="pre">ap-southeast-1</span></code> as
the default region - it is also recommended to set up the region close to you to
reduce latency.</p>
</section>
<section id="create-ec2-key-pair">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Create EC2 Key Pair</a><a class="headerlink" href="#create-ec2-key-pair" title="Link to this heading">#</a></h2>
<p>To set up the SLURM cluster, we need to create an EC2 key pair. This key pair
can be viewed as a secure SSH access to the cluster’s head and compute nodes
where authorized users can log in to train models, run experiments, and manage
the cluster.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>❯<span class="w">  </span>aws<span class="w"> </span>ec2<span class="w"> </span>create-key-pair<span class="w"> </span>--key-name<span class="w"> </span>&lt;YourKeyName&gt;<span class="w"> </span>--query<span class="w"> </span><span class="s1">&#39;KeyMaterial&#39;</span><span class="w"> </span>--output<span class="w"> </span>text<span class="w"> </span>&gt;<span class="w"> </span>~/.ssh/&lt;YourKeyName&gt;.pem
</pre></div>
</div>
<p>We also set the permissions of the key pair file to <code class="docutils literal notranslate"><span class="pre">600</span></code> to ensure that only
the owner can read and write to the file.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>❯<span class="w"> </span>chmod<span class="w"> </span><span class="m">600</span><span class="w"> </span>~/.ssh/&lt;YourKeyName&gt;.pem
</pre></div>
</div>
</section>
<section id="configure-aws-parallelcluster">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Configure AWS ParallelCluster</a><a class="headerlink" href="#configure-aws-parallelcluster" title="Link to this heading">#</a></h2>
<p>First, we install the <code class="docutils literal notranslate"><span class="pre">aws-parallelcluster</span></code> package using <code class="docutils literal notranslate"><span class="pre">pip</span></code> so that we can
use the <code class="docutils literal notranslate"><span class="pre">pcluster</span></code> command.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>❯<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-U<span class="w"> </span>aws-parallelcluster
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>❯<span class="w"> </span>pcluster<span class="w"> </span>configure<span class="w"> </span>--config<span class="w"> </span>config.yaml
</pre></div>
</div>
<p>Then you would have some configuration like below:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">Region</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ap-southeast-1</span>
<span class="nt">Image</span><span class="p">:</span>
<span class="w">  </span><span class="nt">Os</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu2004</span>
<span class="nt">SharedStorage</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">MountDir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/shared</span>
<span class="w">    </span><span class="nt">Name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gaohn-efs</span>
<span class="w">    </span><span class="nt">StorageType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Efs</span>
<span class="w">    </span><span class="nt">EfsSettings</span><span class="p">:</span>
<span class="w">      </span><span class="nt">PerformanceMode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">generalPurpose</span>
<span class="w">      </span><span class="nt">ThroughputMode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bursting</span>
<span class="nt">HeadNode</span><span class="p">:</span>
<span class="w">  </span><span class="nt">InstanceType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">t2.small</span>
<span class="w">  </span><span class="nt">Networking</span><span class="p">:</span>
<span class="w">    </span><span class="nt">SubnetId</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">subnet-xxxxxxxxxxxxxxxxx</span>
<span class="w">  </span><span class="nt">Ssh</span><span class="p">:</span>
<span class="w">    </span><span class="nt">KeyName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">awsec2</span>
<span class="nt">Scheduling</span><span class="p">:</span>
<span class="w">  </span><span class="nt">Scheduler</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">slurm</span>
<span class="w">  </span><span class="nt">SlurmQueues</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">distributed-queue</span>
<span class="w">    </span><span class="nt">ComputeResources</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">g4dn12xlarge</span>
<span class="w">      </span><span class="nt">Instances</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">InstanceType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">g4dn.12xlarge</span>
<span class="w">      </span><span class="nt">MinCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">      </span><span class="nt">MaxCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">      </span><span class="nt">Efa</span><span class="p">:</span>
<span class="w">        </span><span class="nt">Enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">Networking</span><span class="p">:</span>
<span class="w">      </span><span class="nt">PlacementGroup</span><span class="p">:</span>
<span class="w">        </span><span class="nt">Enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">Networking</span><span class="p">:</span>
<span class="w">      </span><span class="nt">SubnetIds</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">subnet-xxxxxxxxxxxxxxxxx</span>
</pre></div>
</div>
<section id="review-the-configuration-file">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">1. Review the Configuration File</a><a class="headerlink" href="#review-the-configuration-file" title="Link to this heading">#</a></h3>
<p>Before proceeding, it’s a good idea to double-check your <code class="docutils literal notranslate"><span class="pre">config.yaml</span></code> file.
Make sure that all settings such as instance types, network configurations,
placement groups, and other parameters accurately meet your needs. Adjust any
settings if necessary. For example, I expected the <code class="docutils literal notranslate"><span class="pre">HeadNode</span></code> to be <code class="docutils literal notranslate"><span class="pre">t2.small</span></code>
and indeed it was.</p>
</section>
<section id="create-the-cluster">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">2. Create the Cluster</a><a class="headerlink" href="#create-the-cluster" title="Link to this heading">#</a></h3>
<p>Run the following command to create the cluster. Replace <code class="docutils literal notranslate"><span class="pre">cluster-name</span></code> with
your desired name for the cluster:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>❯<span class="w"> </span>pcluster<span class="w"> </span>create-cluster<span class="w"> </span>--cluster-configuration<span class="w"> </span>config.yaml<span class="w"> </span>--cluster-name<span class="w"> </span>&lt;YOUR-CLUSTER-NAME&gt;<span class="w"> </span>--region<span class="w"> </span>&lt;REGION&gt;
</pre></div>
</div>
<p>This command specifies the cluster configuration file (<code class="docutils literal notranslate"><span class="pre">config.yaml</span></code>), the name
of the cluster, and the AWS region where you want the cluster to be deployed.</p>
</section>
<section id="monitor-the-cluster-creation">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">3. Monitor the Cluster Creation</a><a class="headerlink" href="#monitor-the-cluster-creation" title="Link to this heading">#</a></h3>
<p>The cluster creation process may take some time. You can monitor the progress by
running the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>❯<span class="w"> </span>pcluster<span class="w"> </span>describe-cluster<span class="w"> </span>--cluster-name<span class="w"> </span>&lt;YOUR-CLUSTER-NAME&gt;<span class="w"> </span>--region<span class="w"> </span>&lt;REGION&gt;
</pre></div>
</div>
</section>
</section>
<section id="shared-file-system">
<h2><a class="toc-backref" href="#id8" role="doc-backlink">Shared File System</a><a class="headerlink" href="#shared-file-system" title="Link to this heading">#</a></h2>
<p>Put your code or data in the shared file system, if not your compute nodes will
not be able to access them and have a copy of what you installed in the head
node. This means if you need to write or read data from the compute nodes, you
need to put them in the shared file system.</p>
<p>Thinks like FSx, EFS, or S3 can be used as shared file system but for a poor
man’s way and lazy way we can use <code class="docutils literal notranslate"><span class="pre">/home</span></code> as shared file system. Do not do this
in production. Remember to change to something like <code class="docutils literal notranslate"><span class="pre">777</span></code> for the shared
directory so that all nodes can access it.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>❯<span class="w"> </span>sudo<span class="w"> </span>chmod<span class="w"> </span>-R<span class="w"> </span><span class="m">777</span><span class="w"> </span>/home/multi_gpu_training
</pre></div>
</div>
<p>Alternatively, you can also mount an EFS volume to the head node and then share
it with the compute nodes. For example, you can add the below configuration to
the <code class="docutils literal notranslate"><span class="pre">config.yaml</span></code> file:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">SharedStorage</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">MountDir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/shared</span>
<span class="w">      </span><span class="nt">Name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-efs</span>
<span class="w">      </span><span class="nt">StorageType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Efs</span>
<span class="w">      </span><span class="nt">EfsSettings</span><span class="p">:</span>
<span class="w">          </span><span class="nt">PerformanceMode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">generalPurpose</span>
<span class="w">          </span><span class="nt">ThroughputMode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bursting</span>
</pre></div>
</div>
<p>EFS is cheap and can be used as a shared file system but if you want things like
FSx, which is for high performance computing, you can refer to a sample
<a class="reference external" href="https://github.com/pytorch/examples/blob/main/distributed/minGPT-ddp/mingpt/slurm/config.yaml.template">template from PyTorch</a>.
So you will now have access to a <code class="docutils literal notranslate"><span class="pre">/shared</span></code> directory in the head node and all
compute nodes.</p>
</section>
<section id="logging-into-the-head-node">
<h2><a class="toc-backref" href="#id9" role="doc-backlink">Logging into the Head Node</a><a class="headerlink" href="#logging-into-the-head-node" title="Link to this heading">#</a></h2>
<p>During creation of the cluster, you can ssh into the head node using the
following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>❯<span class="w"> </span>pcluster<span class="w"> </span>ssh<span class="w"> </span>--cluster-name<span class="w"> </span>&lt;YOUR-CLUSTER-NAME&gt;<span class="w"> </span>-i<span class="w"> </span>&lt;path-to-your-key.pem&gt;<span class="w"> </span>--region<span class="w"> </span>&lt;REGION&gt;
</pre></div>
</div>
<p>Alternatively you can use normal ssh to login into the head node as well which
is useful if you are using vscode remote to login. First, get the public DNS of
the head node (you can just get the instance id from the AWS console and then
get the public DNS):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>❯<span class="w"> </span>aws<span class="w"> </span>ec2<span class="w"> </span>describe-instances<span class="w"> </span>--instance-ids<span class="w"> </span>&lt;INSTANCE-ID&gt;<span class="w"> </span>--query<span class="w"> </span><span class="s2">&quot;Reservations[*].Instances[*].PublicDnsName&quot;</span><span class="w"> </span>--output<span class="w"> </span>text
</pre></div>
</div>
<p>where the output of the previous command is the <code class="docutils literal notranslate"><span class="pre">&lt;public-dns&gt;</span></code>.</p>
<p>Then the ssh command is:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>❯<span class="w"> </span>ssh<span class="w"> </span>-i<span class="w"> </span>&lt;/path/to/your-key.pem&gt;<span class="w"> </span>&lt;username&gt;@&lt;public-dns&gt;
</pre></div>
</div>
<p>For <code class="docutils literal notranslate"><span class="pre">username</span></code> it defaults to <code class="docutils literal notranslate"><span class="pre">ubuntu</span></code> for Ubuntu AMIs.</p>
<section id="compute-node">
<h3><a class="toc-backref" href="#id10" role="doc-backlink">Compute Node</a><a class="headerlink" href="#compute-node" title="Link to this heading">#</a></h3>
<p>The compute nodes are what you will use to run your distributed training. You
set it to <code class="docutils literal notranslate"><span class="pre">g4dn.12xlarge</span></code> earlier, and with <code class="docutils literal notranslate"><span class="pre">MinCount</span></code> and <code class="docutils literal notranslate"><span class="pre">MaxCount</span></code> - these
fields specify the minimum and maximum number of instances of this type that can
be launched. Both <code class="docutils literal notranslate"><span class="pre">MinCount</span></code> and <code class="docutils literal notranslate"><span class="pre">MaxCount</span></code> are set to 2. This means that
exactly 2 instances of <code class="docutils literal notranslate"><span class="pre">g4dn.12xlarge</span></code> will be used.</p>
</section>
<section id="slurm-status">
<h3><a class="toc-backref" href="#id11" role="doc-backlink">SLURM Status</a><a class="headerlink" href="#slurm-status" title="Link to this heading">#</a></h3>
<p>We can check status of the slurm cluster:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>❯<span class="w"> </span>sinfo

PARTITION<span class="w">          </span>AVAIL<span class="w">  </span>TIMELIMIT<span class="w">  </span>NODES<span class="w">  </span>STATE<span class="w"> </span>NODELIST
distributed-queue*<span class="w">    </span>up<span class="w">   </span>infinite<span class="w">      </span><span class="m">2</span><span class="w">   </span>idle<span class="w"> </span>distributed-queue-st-g4dn2xlarge-<span class="o">[</span><span class="m">1</span>-2<span class="o">]</span>
</pre></div>
</div>
<p>And we can see the nodes are up and running. We can use <code class="docutils literal notranslate"><span class="pre">srun</span></code> to see if the
nodes are working:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>❯<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">NUM_NODES</span><span class="o">=</span><span class="m">2</span>
❯<span class="w"> </span>srun<span class="w"> </span>-N<span class="si">${</span><span class="nv">NUM_NODES</span><span class="si">}</span><span class="w"> </span>hostname
distributed-queue-st-g4dn2xlarge-1
distributed-queue-st-g4dn2xlarge-2
</pre></div>
</div>
</section>
<section id="setup-python-environment">
<h3><a class="toc-backref" href="#id12" role="doc-backlink">Setup Python Environment</a><a class="headerlink" href="#setup-python-environment" title="Link to this heading">#</a></h3>
<section id="virtual-environment">
<h4><a class="toc-backref" href="#id13" role="doc-backlink">Virtual Environment</a><a class="headerlink" href="#virtual-environment" title="Link to this heading">#</a></h4>
<p>We can do so via virtual environment:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env sh</span>
sudo<span class="w"> </span>apt-get<span class="w"> </span>update
sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>python3-venv
python3<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>/shared/venv/
<span class="nb">source</span><span class="w"> </span>/shared/venv/bin/activate
pip<span class="w"> </span>install<span class="w"> </span>wheel
<span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;source /shared/venv/bin/activate&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.bashrc
</pre></div>
</div>
</section>
<section id="miniconda">
<h4><a class="toc-backref" href="#id14" role="doc-backlink">Miniconda</a><a class="headerlink" href="#miniconda" title="Link to this heading">#</a></h4>
<p>Or with conda:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>wget<span class="w"> </span>https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh
bash<span class="w"> </span>Miniconda3-latest-Linux-x86_64.sh
<span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;&lt;/path/to/miniconda3&gt;/bin:</span><span class="nv">$PATH</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p>To add miniconda to module:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>/usr/share/modules/modulefiles
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>nano<span class="w"> </span>miniconda3
</pre></div>
</div>
<p>Add these into the file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">#%Module1.0</span>
proc<span class="w"> </span>ModulesHelp<span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="o">}</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span>puts<span class="w"> </span>stderr<span class="w"> </span><span class="s2">&quot;Adds Miniconda3 to your environment variables.&quot;</span>
<span class="o">}</span>
module-whatis<span class="w"> </span><span class="s2">&quot;Loads Miniconda3 Environment.&quot;</span>
<span class="nb">set</span><span class="w"> </span>root<span class="w"> </span>/home/ubuntu/miniconda3
prepend-path<span class="w"> </span>PATH<span class="w"> </span><span class="nv">$root</span>/bin
</pre></div>
</div>
<p>And if you don’t use it in script, you can just do the following.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span><span class="w"> </span>/etc/profile.d/modules.sh
module<span class="w"> </span>use<span class="w"> </span>/usr/share/modules/modulefiles
module<span class="w"> </span>load<span class="w"> </span>miniconda3
conda<span class="w"> </span>create<span class="w"> </span>-n<span class="w"> </span>ddp<span class="w"> </span><span class="nv">python</span><span class="o">=</span><span class="m">3</span>.9
<span class="nb">source</span><span class="w"> </span>~/.bashrc<span class="w"> </span><span class="c1"># so no need conda init</span>
conda<span class="w"> </span>activate<span class="w"> </span>ddp
</pre></div>
</div>
</section>
</section>
</section>
<section id="sample-run">
<h2><a class="toc-backref" href="#id15" role="doc-backlink">Sample Run</a><a class="headerlink" href="#sample-run" title="Link to this heading">#</a></h2>
<p>We use the example from PyTorch’s examples. But note very carefully you likely
need to use their <code class="docutils literal notranslate"><span class="pre">config</span></code> template and not the one I provided as they have
things like FSx and other things that are not in the default <code class="docutils literal notranslate"><span class="pre">config.yaml</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/pytorch/examples.git
<span class="nb">cd</span><span class="w"> </span>/shared/examples/distributed/minGPT-ddp/mingpt/slurm
nano<span class="w"> </span>sbatch_run.sh
</pre></div>
</div>
<p>We want to modify some things.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="ch">#!/bin/bash</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="c1">#SBATCH --job-name=multinode-example</span>
<span class="linenos"> 4</span><span class="c1">#SBATCH --nodes=2</span>
<span class="linenos"> 5</span><span class="c1">#SBATCH --ntasks=2</span>
<span class="linenos"> 6</span><span class="c1">#SBATCH --gpus-per-task=1</span>
<span class="linenos"> 7</span><span class="c1">#SBATCH --cpus-per-task=4</span>
<span class="hll"><span class="linenos"> 8</span><span class="c1">#SBATCH --output=train_gpt_%j.out</span>
</span><span class="hll"><span class="linenos"> 9</span><span class="c1">#SBATCH --error=train_gpt_%j.err</span>
</span><span class="linenos">10</span>
<span class="hll"><span class="linenos">11</span><span class="nb">source</span><span class="w"> </span><span class="k">$(</span>conda<span class="w"> </span>info<span class="w"> </span>--base<span class="k">)</span>/etc/profile.d/conda.sh
</span><span class="hll"><span class="linenos">12</span>conda<span class="w"> </span>activate<span class="w"> </span>ddp
</span><span class="linenos">13</span>
<span class="linenos">14</span><span class="nv">nodes</span><span class="o">=(</span><span class="w"> </span><span class="k">$(</span><span class="w"> </span>scontrol<span class="w"> </span>show<span class="w"> </span>hostnames<span class="w"> </span><span class="nv">$SLURM_JOB_NODELIST</span><span class="w"> </span><span class="k">)</span><span class="w"> </span><span class="o">)</span>
<span class="linenos">15</span><span class="nv">nodes_array</span><span class="o">=(</span><span class="nv">$nodes</span><span class="o">)</span>
<span class="linenos">16</span><span class="nv">head_node</span><span class="o">=</span><span class="si">${</span><span class="nv">nodes_array</span><span class="p">[0]</span><span class="si">}</span>
<span class="linenos">17</span><span class="nv">head_node_ip</span><span class="o">=</span><span class="k">$(</span>srun<span class="w"> </span>--nodes<span class="o">=</span><span class="m">1</span><span class="w"> </span>--ntasks<span class="o">=</span><span class="m">1</span><span class="w"> </span>-w<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$head_node</span><span class="s2">&quot;</span><span class="w"> </span>hostname<span class="w"> </span>--ip-address<span class="k">)</span>
<span class="linenos">18</span>
<span class="linenos">19</span><span class="nb">echo</span><span class="w"> </span>Node<span class="w"> </span>IP:<span class="w"> </span><span class="nv">$head_node_ip</span>
<span class="linenos">20</span><span class="nb">export</span><span class="w"> </span><span class="nv">LOGLEVEL</span><span class="o">=</span>INFO
<span class="linenos">21</span>
<span class="linenos">22</span>srun<span class="w"> </span>torchrun<span class="w"> </span><span class="se">\</span>
<span class="linenos">23</span>--nnodes<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="se">\</span>
<span class="linenos">24</span>--nproc_per_node<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="se">\</span>
<span class="linenos">25</span>--rdzv_id<span class="w"> </span><span class="nv">$RANDOM</span><span class="w"> </span><span class="se">\</span>
<span class="linenos">26</span>--rdzv_backend<span class="w"> </span>c10d<span class="w"> </span><span class="se">\</span>
<span class="linenos">27</span>--rdzv_endpoint<span class="w"> </span><span class="nv">$head_node_ip</span>:29500<span class="w"> </span><span class="se">\</span>
<span class="hll"><span class="linenos">28</span>/shared/examples/distributed/minGPT-ddp/mingpt/main.py
</span></pre></div>
</div>
<p>We change the last line from <code class="docutils literal notranslate"><span class="pre">/shared/examples/mingpt/main.py</span></code> to
<code class="docutils literal notranslate"><span class="pre">/shared/examples/distributed/minGPT-ddp/mingpt/main.py</span></code>. For the rest, is some
additional info like activating the conda environment.</p>
<p>Also now you can do the <code class="docutils literal notranslate"><span class="pre">sbatch</span></code> command to submit the job, and is typically
done in the head node.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>❯<span class="w"> </span>sbatch<span class="w"> </span>sbatch_run.sh
</pre></div>
</div>
</section>
<section id="delete-cluster">
<h2><a class="toc-backref" href="#id16" role="doc-backlink">Delete Cluster</a><a class="headerlink" href="#delete-cluster" title="Link to this heading">#</a></h2>
<section id="delete-parallelcluster">
<h3><a class="toc-backref" href="#id17" role="doc-backlink">Delete ParallelCluster</a><a class="headerlink" href="#delete-parallelcluster" title="Link to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pcluster<span class="w"> </span>delete-cluster<span class="w"> </span>--cluster-name<span class="w"> </span>&lt;YOUR-CLUSTER-NAME&gt;<span class="w"> </span>--region<span class="w"> </span>&lt;REGION&gt;
</pre></div>
</div>
<p>and verify deletion:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pcluster<span class="w"> </span>list-clusters<span class="w"> </span>--region<span class="w"> </span>&lt;REGION&gt;
</pre></div>
</div>
</section>
<section id="delete-network-resources">
<h3><a class="toc-backref" href="#id18" role="doc-backlink">Delete Network Resources</a><a class="headerlink" href="#delete-network-resources" title="Link to this heading">#</a></h3>
<p>You also need to delete your lingering VPCs, subnets etc. First, we idenfity all
the network resources associated with the cluster including VPC, subnets etc. Go
<a class="reference external" href="https://ap-southeast-1.console.aws.amazon.com/vpcconsole/home?region=ap-southeast-1#Home:">here</a>
to see existing resources.</p>
<p>First get your subnet id from <code class="docutils literal notranslate"><span class="pre">config.yaml</span></code>.</p>
<p>Now we first delete NAT.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>aws<span class="w"> </span>ec2<span class="w"> </span>describe-subnets<span class="w"> </span>--subnet-ids<span class="w"> </span>&lt;subnet-XXX&gt;<span class="w"> </span>--query<span class="w"> </span><span class="s1">&#39;Subnets[0].VpcId&#39;</span><span class="w"> </span>--output<span class="w"> </span>text<span class="w"> </span><span class="c1"># get the VPC ID</span>
aws<span class="w"> </span>ec2<span class="w"> </span>describe-nat-gateways<span class="w"> </span>--filter<span class="w"> </span><span class="s2">&quot;Name=vpc-id,Values=&lt;vpc-XXX&gt;&quot;</span><span class="w"> </span><span class="c1"># get nat id in the form of nat-xxx</span>
aws<span class="w"> </span>ec2<span class="w"> </span>delete-nat-gateway<span class="w"> </span>--nat-gateway-id<span class="w"> </span>&lt;nat-XXX&gt;<span class="w"> </span><span class="c1"># delete the nat gateway</span>
aws<span class="w"> </span>ec2<span class="w"> </span>describe-nat-gateways<span class="w"> </span>--nat-gateway-ids<span class="w"> </span>&lt;nat-XXX&gt;<span class="w"> </span><span class="c1"># check if it is deleted</span>
</pre></div>
</div>
<p>Then we detach and delete network interfaces.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Detach network interfaces</span>
aws<span class="w"> </span>ec2<span class="w"> </span>describe-network-interfaces<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--filters<span class="w"> </span><span class="s2">&quot;Name=vpc-id,Values=&lt;vpc-XXX&gt;&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--query<span class="w"> </span><span class="s1">&#39;NetworkInterfaces[*].[NetworkInterfaceId,Attachment.AttachmentId]&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--output<span class="w"> </span>text<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>-r<span class="w"> </span>interface_id<span class="w"> </span>attachment_id<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>!<span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$attachment_id</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span>aws<span class="w"> </span>ec2<span class="w"> </span>detach-network-interface<span class="w"> </span>--attachment-id<span class="w"> </span><span class="nv">$attachment_id</span>
<span class="w">      </span><span class="k">fi</span>
<span class="w">    </span><span class="k">done</span>

<span class="c1"># Delete network interfaces</span>
aws<span class="w"> </span>ec2<span class="w"> </span>describe-network-interfaces<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--filters<span class="w"> </span><span class="s2">&quot;Name=vpc-id,Values=&lt;vpc-XXX&gt;&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--query<span class="w"> </span><span class="s1">&#39;NetworkInterfaces[*].NetworkInterfaceId&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--output<span class="w"> </span>text<span class="w"> </span><span class="p">|</span><span class="w"> </span>xargs<span class="w"> </span>-I<span class="w"> </span><span class="o">{}</span><span class="w"> </span>aws<span class="w"> </span>ec2<span class="w"> </span>delete-network-interface<span class="w"> </span>--network-interface-id<span class="w"> </span><span class="o">{}</span>

<span class="c1"># Run again to see if deleted or not</span>
aws<span class="w"> </span>ec2<span class="w"> </span>describe-network-interfaces<span class="w"> </span>--filters<span class="w"> </span><span class="s2">&quot;Name=vpc-id,Values=&lt;vpc-XXX&gt;&quot;</span>
</pre></div>
</div>
<p>Next, delete subnets</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>aws<span class="w"> </span>ec2<span class="w"> </span>describe-subnets<span class="w"> </span>--filters<span class="w"> </span><span class="s2">&quot;Name=vpc-id,Values=&lt;vpc-XXX&gt;&quot;</span><span class="w"> </span>--query<span class="w"> </span><span class="s1">&#39;Subnets[*].SubnetId&#39;</span><span class="w"> </span>--output<span class="w"> </span>text<span class="w"> </span><span class="p">|</span><span class="w"> </span>xargs<span class="w"> </span>-n<span class="w"> </span><span class="m">1</span><span class="w"> </span>-I<span class="w"> </span><span class="o">{}</span><span class="w"> </span>aws<span class="w"> </span>ec2<span class="w"> </span>delete-subnet<span class="w"> </span>--subnet-id<span class="w"> </span><span class="o">{}</span>
<span class="c1"># Check if deleted</span>
aws<span class="w"> </span>ec2<span class="w"> </span>describe-subnets<span class="w"> </span>--filters<span class="w"> </span><span class="s2">&quot;Name=vpc-id,Values=&lt;vpc-XXX&gt;&quot;</span><span class="w"> </span>--query<span class="w"> </span><span class="s1">&#39;Subnets[*].SubnetId&#39;</span><span class="w"> </span>--output<span class="w"> </span>text
</pre></div>
</div>
<p>Next, delete route tables</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>aws<span class="w"> </span>ec2<span class="w"> </span>describe-route-tables<span class="w"> </span>--filters<span class="w"> </span><span class="s2">&quot;Name=vpc-id,Values=&lt;vpc-XXX&gt;&quot;</span><span class="w"> </span>--query<span class="w"> </span><span class="s1">&#39;RouteTables[?Associations==`[]`].RouteTableId&#39;</span><span class="w"> </span>--output<span class="w"> </span>text<span class="w"> </span><span class="p">|</span><span class="w"> </span>xargs<span class="w"> </span>-n<span class="w"> </span><span class="m">1</span><span class="w"> </span>-I<span class="w"> </span><span class="o">{}</span><span class="w"> </span>aws<span class="w"> </span>ec2<span class="w"> </span>delete-route-table<span class="w"> </span>--route-table-id<span class="w"> </span><span class="o">{}</span>
</pre></div>
</div>
<p>Now delete the internet gateway</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># list the internet gateways</span>
aws<span class="w"> </span>ec2<span class="w"> </span>describe-internet-gateways<span class="w"> </span>--filters<span class="w"> </span><span class="s2">&quot;Name=attachment.vpc-id,Values=&lt;vpc-XXX&gt;&quot;</span><span class="w"> </span>--query<span class="w"> </span><span class="s1">&#39;InternetGateways[*].InternetGatewayId&#39;</span><span class="w"> </span>--output<span class="w"> </span>text

aws<span class="w"> </span>ec2<span class="w"> </span>detach-internet-gateway<span class="w"> </span>--internet-gateway-id<span class="w"> </span>&lt;igw-XXX&gt;<span class="w"> </span>--vpc-id<span class="w"> </span>&lt;vpc-XXX&gt;
aws<span class="w"> </span>ec2<span class="w"> </span>delete-internet-gateway<span class="w"> </span>--internet-gateway-id<span class="w"> </span>&lt;igw-XXX&gt;
</pre></div>
</div>
<p>Lastly, delete the VPC</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>aws<span class="w"> </span>ec2<span class="w"> </span>delete-vpc<span class="w"> </span>--vpc-id<span class="w"> </span>&lt;vpc-XXX&gt;
<span class="c1"># check if deleted</span>
aws<span class="w"> </span>ec2<span class="w"> </span>describe-vpcs<span class="w"> </span>--vpc-ids<span class="w"> </span>&lt;vpc-XXX&gt;
</pre></div>
</div>
</section>
<section id="consolidated-script">
<h3><a class="toc-backref" href="#id19" role="doc-backlink">Consolidated Script</a><a class="headerlink" href="#consolidated-script" title="Link to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="c1"># Set variables</span>
<span class="nv">CLUSTER_NAME</span><span class="o">=</span><span class="s2">&quot;distributed-training&quot;</span>
<span class="nv">REGION</span><span class="o">=</span><span class="s2">&quot;ap-southeast-1&quot;</span>
<span class="nv">SUBNET_ID</span><span class="o">=</span><span class="s2">&quot;subnet-02cc9a3a21eecdc77&quot;</span><span class="w"> </span><span class="c1"># find from config.yaml</span>
<span class="nv">VPC_ID</span><span class="o">=</span><span class="s2">&quot;vpc-00635da5926ac5242&quot;</span><span class="w"> </span><span class="c1"># aws ec2 describe-subnets --subnet-ids &quot;subnet-02cc9a3a21eecdc77&quot; --query &#39;Subnets[0].VpcId&#39; --output text # get the VPC ID</span>

<span class="c1"># Delete ParallelCluster</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Deleting AWS ParallelCluster...&quot;</span>
pcluster<span class="w"> </span>delete-cluster<span class="w"> </span>--cluster-name<span class="w"> </span><span class="nv">$CLUSTER_NAME</span><span class="w"> </span>--region<span class="w"> </span><span class="nv">$REGION</span>

<span class="c1"># Wait and verify deletion</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Listing all clusters to verify deletion...&quot;</span>
pcluster<span class="w"> </span>list-clusters<span class="w"> </span>--region<span class="w"> </span><span class="nv">$REGION</span>

<span class="c1"># Describe NAT Gateway</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Fetching NAT Gateway ID...&quot;</span>
<span class="nv">NAT_ID</span><span class="o">=</span><span class="k">$(</span>aws<span class="w"> </span>ec2<span class="w"> </span>describe-nat-gateways<span class="w"> </span>--filter<span class="w"> </span><span class="s2">&quot;Name=vpc-id,Values=</span><span class="nv">$VPC_ID</span><span class="s2">&quot;</span><span class="w"> </span>--query<span class="w"> </span><span class="s1">&#39;NatGateways[0].NatGatewayId&#39;</span><span class="w"> </span>--output<span class="w"> </span>text<span class="k">)</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Deleting NAT Gateway...&quot;</span>
aws<span class="w"> </span>ec2<span class="w"> </span>delete-nat-gateway<span class="w"> </span>--nat-gateway-id<span class="w"> </span><span class="nv">$NAT_ID</span>
sleep<span class="w"> </span><span class="m">20</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Verifying NAT Gateway deletion...&quot;</span>
aws<span class="w"> </span>ec2<span class="w"> </span>describe-nat-gateways<span class="w"> </span>--nat-gateway-ids<span class="w"> </span><span class="nv">$NAT_ID</span>

<span class="c1"># Detach and delete network interfaces</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Detaching and deleting network interfaces...&quot;</span>
aws<span class="w"> </span>ec2<span class="w"> </span>describe-network-interfaces<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--filters<span class="w"> </span><span class="s2">&quot;Name=vpc-id,Values=</span><span class="nv">$VPC_ID</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--query<span class="w"> </span><span class="s1">&#39;NetworkInterfaces[*].[NetworkInterfaceId,Attachment.AttachmentId]&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--output<span class="w"> </span>text<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>-r<span class="w"> </span>interface_id<span class="w"> </span>attachment_id<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>!<span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$attachment_id</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span>aws<span class="w"> </span>ec2<span class="w"> </span>detach-network-interface<span class="w"> </span>--attachment-id<span class="w"> </span><span class="nv">$attachment_id</span>
<span class="w">      </span><span class="k">fi</span>
<span class="w">      </span>aws<span class="w"> </span>ec2<span class="w"> </span>delete-network-interface<span class="w"> </span>--network-interface-id<span class="w"> </span><span class="nv">$interface_id</span>
<span class="w">    </span><span class="k">done</span>

<span class="c1"># Delete subnets</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Deleting subnets...&quot;</span>
aws<span class="w"> </span>ec2<span class="w"> </span>describe-subnets<span class="w"> </span>--filters<span class="w"> </span><span class="s2">&quot;Name=vpc-id,Values=</span><span class="nv">$VPC_ID</span><span class="s2">&quot;</span><span class="w"> </span>--query<span class="w"> </span><span class="s1">&#39;Subnets[*].SubnetId&#39;</span><span class="w"> </span>--output<span class="w"> </span>text<span class="w"> </span><span class="p">|</span><span class="w"> </span>xargs<span class="w"> </span>-n<span class="w"> </span><span class="m">1</span><span class="w"> </span>-I<span class="w"> </span><span class="o">{}</span><span class="w"> </span>aws<span class="w"> </span>ec2<span class="w"> </span>delete-subnet<span class="w"> </span>--subnet-id<span class="w"> </span><span class="o">{}</span>
sleep<span class="w"> </span><span class="m">20</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Verifying subnet deletion...&quot;</span>
aws<span class="w"> </span>ec2<span class="w"> </span>describe-subnets<span class="w"> </span>--filters<span class="w"> </span><span class="s2">&quot;Name=vpc-id,Values=</span><span class="nv">$VPC_ID</span><span class="s2">&quot;</span>

<span class="c1"># Delete route tables</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Deleting route tables...&quot;</span>
aws<span class="w"> </span>ec2<span class="w"> </span>describe-route-tables<span class="w"> </span>--filters<span class="w"> </span><span class="s2">&quot;Name=vpc-id,Values=</span><span class="nv">$VPC_ID</span><span class="s2">&quot;</span><span class="w"> </span>--query<span class="w"> </span><span class="s1">&#39;RouteTables[?Associations==`[]`].RouteTableId&#39;</span><span class="w"> </span>--output<span class="w"> </span>text<span class="w"> </span><span class="p">|</span><span class="w"> </span>xargs<span class="w"> </span>-n<span class="w"> </span><span class="m">1</span><span class="w"> </span>-I<span class="w"> </span><span class="o">{}</span><span class="w"> </span>aws<span class="w"> </span>ec2<span class="w"> </span>delete-route-table<span class="w"> </span>--route-table-id<span class="w"> </span><span class="o">{}</span>
sleep<span class="w"> </span><span class="m">10</span>

<span class="c1"># Delete internet gateway</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Deleting internet gateway...&quot;</span>
<span class="nv">IGW_ID</span><span class="o">=</span><span class="k">$(</span>aws<span class="w"> </span>ec2<span class="w"> </span>describe-internet-gateways<span class="w"> </span>--filters<span class="w"> </span><span class="s2">&quot;Name=attachment.vpc-id,Values=</span><span class="nv">$VPC_ID</span><span class="s2">&quot;</span><span class="w"> </span>--query<span class="w"> </span><span class="s1">&#39;InternetGateways[*].InternetGatewayId&#39;</span><span class="w"> </span>--output<span class="w"> </span>text<span class="k">)</span>
aws<span class="w"> </span>ec2<span class="w"> </span>detach-internet-gateway<span class="w"> </span>--internet-gateway-id<span class="w"> </span><span class="nv">$IGW_ID</span><span class="w"> </span>--vpc-id<span class="w"> </span><span class="nv">$VPC_ID</span>
aws<span class="w"> </span>ec2<span class="w"> </span>delete-internet-gateway<span class="w"> </span>--internet-gateway-id<span class="w"> </span><span class="nv">$IGW_ID</span>

<span class="c1"># Delete the VPC</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Deleting VPC...&quot;</span>
aws<span class="w"> </span>ec2<span class="w"> </span>delete-vpc<span class="w"> </span>--vpc-id<span class="w"> </span><span class="nv">$VPC_ID</span>
sleep<span class="w"> </span><span class="m">20</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Verifying VPC deletion...&quot;</span>
aws<span class="w"> </span>ec2<span class="w"> </span>describe-vpcs<span class="w"> </span>--vpc-ids<span class="w"> </span><span class="nv">$VPC_ID</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;All resources have been deleted successfully.&quot;</span>
</pre></div>
</div>
</section>
</section>
<section id="troubleshooting">
<h2><a class="toc-backref" href="#id20" role="doc-backlink">Troubleshooting</a><a class="headerlink" href="#troubleshooting" title="Link to this heading">#</a></h2>
<p>Usually at this stage if you face slurm creation failure, we need to inspect the
logs. Usually during creation one can ssh into head node, and you can list out
<code class="docutils literal notranslate"><span class="pre">ls</span> <span class="pre">/var/log</span></code> to see a wide range of logs. Or you can just follow
<a class="reference external" href="https://docs.aws.amazon.com/parallelcluster/latest/ug/troubleshooting-v3-scaling-issues.html#troubleshooting-v3-key-logs">AWS’s documentation</a>
to see what logs they recommend. They have a comprehensive
<a class="reference external" href="https://docs.aws.amazon.com/parallelcluster/latest/ug/troubleshooting-fc-v3-create-cluster.html">guide</a>
on troubleshooting.</p>
<ol class="arabic">
<li><p>Check the system log from the head node (can be done in the AWS console):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>aws<span class="w"> </span>ec2<span class="w"> </span>get-console-output<span class="w"> </span>--instance-id<span class="w"> </span>&lt;instance-id&gt;<span class="w"> </span>--region<span class="w"> </span>ap-southeast-1<span class="w"> </span>--output<span class="w"> </span>text
</pre></div>
</div>
</li>
<li><p>You can also check relevant logs like:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>/var/log/cloud-init.log
cat<span class="w"> </span>/var/log/cloud-init-output.log
cat<span class="w"> </span>/var/log/cfn-init.log
cat<span class="w"> </span>/var/log/chef-client.log
cat<span class="w"> </span>slurmctld.log
cat<span class="w"> </span>parallelcluster/clusterstatusmgtd
</pre></div>
</div>
</li>
</ol>
<p>See a sample log that an user reported
<a class="reference external" href="https://github.com/aws/aws-parallelcluster/issues/5690">here</a>.</p>
<section id="failurecode-is-headnodebootstrapfailure-with-failurereason-cluster-creation-timed-out">
<h3><a class="toc-backref" href="#id21" role="doc-backlink">failureCode is HeadNodeBootstrapFailure with failureReason Cluster creation timed out</a><a class="headerlink" href="#failurecode-is-headnodebootstrapfailure-with-failurereason-cluster-creation-timed-out" title="Link to this heading">#</a></h3>
<p>For example, I faced the
<code class="docutils literal notranslate"><span class="pre">failureCode</span> <span class="pre">is</span> <span class="pre">HeadNodeBootstrapFailure</span> <span class="pre">with</span> <span class="pre">failureReason</span> <span class="pre">Cluster</span> <span class="pre">creation</span> <span class="pre">timed</span> <span class="pre">out</span></code>
but AWS has good guide to troubleshoot
<a class="reference external" href="https://docs.aws.amazon.com/parallelcluster/latest/ug/troubleshooting-fc-v3-create-cluster.html#create-cluster-head-node-bootstrap-timeout-failure-v3">here</a>.</p>
<p>Sometimes it is simply because your AWS account has not enough quotas. For me
the concrete error for this can be found in
<code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">cat</span> <span class="pre">/var/log/parallelcluster/clustermgtd.events</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">{</span><span class="s2">&quot;datetime&quot;</span>:<span class="w"> </span><span class="s2">&quot;2024-05-05T07:59:58.279+00:00&quot;</span>,<span class="w"> </span><span class="s2">&quot;version&quot;</span>:<span class="w"> </span><span class="m">0</span>,<span class="w"> </span><span class="s2">&quot;scheduler&quot;</span>:<span class="w"> </span><span class="s2">&quot;slurm&quot;</span>,<span class="w"> </span><span class="s2">&quot;cluster-name&quot;</span>:<span class="w"> </span><span class="s2">&quot;distributed-training&quot;</span>,<span class="w"> </span><span class="s2">&quot;node-role&quot;</span>:<span class="w"> </span><span class="s2">&quot;HeadNode&quot;</span>,<span class="w"> </span><span class="s2">&quot;component&quot;</span>:<span class="w"> </span><span class="s2">&quot;clustermgtd&quot;</span>,<span class="w"> </span><span class="s2">&quot;level&quot;</span>:<span class="w"> </span><span class="s2">&quot;WARNING&quot;</span>,<span class="w"> </span><span class="s2">&quot;instance-id&quot;</span>:<span class="w"> </span><span class="s2">&quot;i-08d41f68bf12ca54b&quot;</span>,<span class="w"> </span><span class="s2">&quot;event-type&quot;</span>:<span class="w"> </span><span class="s2">&quot;node-launch-failure-count&quot;</span>,<span class="w"> </span><span class="s2">&quot;message&quot;</span>:<span class="w"> </span><span class="s2">&quot;Number of static nodes that failed to launch a backing instance after node maintenance&quot;</span>,<span class="w"> </span><span class="s2">&quot;detail&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;failure-type&quot;</span>:<span class="w"> </span><span class="s2">&quot;vcpu-limit-failures&quot;</span>,<span class="w"> </span><span class="s2">&quot;count&quot;</span>:<span class="w"> </span><span class="m">1</span>,<span class="w"> </span><span class="s2">&quot;error-details&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;VcpuLimitExceeded&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;count&quot;</span>:<span class="w"> </span><span class="m">1</span>,<span class="w"> </span><span class="s2">&quot;nodes&quot;</span>:<span class="w"> </span><span class="o">[{</span><span class="s2">&quot;name&quot;</span>:<span class="w"> </span><span class="s2">&quot;distributed-queue-st-g4dn12xlarge-2&quot;</span><span class="o">}]}}}}</span>
</pre></div>
</div>
</section>
</section>
<section id="some-useful-commands">
<h2><a class="toc-backref" href="#id22" role="doc-backlink">Some Useful Commands</a><a class="headerlink" href="#some-useful-commands" title="Link to this heading">#</a></h2>
<section id="slurm-commands">
<h3><a class="toc-backref" href="#id23" role="doc-backlink">Slurm Commands</a><a class="headerlink" href="#slurm-commands" title="Link to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sinfo<span class="w"> </span><span class="c1"># show information about nodes</span>
squeue<span class="w"> </span><span class="c1"># show the queue</span>
</pre></div>
</div>
<p>Useful command to check if the nodes are working and returning the hostname:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>srun<span class="w"> </span>-N2<span class="w"> </span>hostname<span class="w"> </span><span class="c1"># run a command on 2 nodes to see if they are working, returns the hostname</span>
</pre></div>
</div>
<section id="how-many-gpus">
<h4><a class="toc-backref" href="#id24" role="doc-backlink">How Many GPUs?</a><a class="headerlink" href="#how-many-gpus" title="Link to this heading">#</a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>scontrol<span class="w"> </span>show<span class="w"> </span>nodes<span class="w"> </span><span class="c1"># show more detailed information about nodes</span>
sinfo<span class="w"> </span>-N<span class="w"> </span>-o<span class="w"> </span><span class="s2">&quot;%N %G&quot;</span><span class="w"> </span><span class="c1"># show the number of GPUs</span>
</pre></div>
</div>
</section>
</section>
<section id="find-the-instance-id">
<h3><a class="toc-backref" href="#id25" role="doc-backlink">Find the Instance ID</a><a class="headerlink" href="#find-the-instance-id" title="Link to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>aws<span class="w"> </span>ec2<span class="w"> </span>describe-instances<span class="w"> </span>--query<span class="w"> </span><span class="s2">&quot;Reservations[*].Instances[*].{InstanceID: InstanceId, PublicDNS: PublicDnsName, State: State.Name, Tags: Tags}&quot;</span><span class="w"> </span>--output<span class="w"> </span>table
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">table</span></code> format gives error like <code class="docutils literal notranslate"><span class="pre">list</span> <span class="pre">index</span> <span class="pre">out</span> <span class="pre">of</span> <span class="pre">range</span></code>, you can replace
<code class="docutils literal notranslate"><span class="pre">table</span></code> with <code class="docutils literal notranslate"><span class="pre">json</span></code> to slowly filter out.</p>
</section>
<section id="stop-ec2-instances">
<h3><a class="toc-backref" href="#id26" role="doc-backlink">Stop EC2 Instances</a><a class="headerlink" href="#stop-ec2-instances" title="Link to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>aws<span class="w"> </span>ec2<span class="w"> </span>stop-instances<span class="w"> </span>--instance-ids<span class="w"> </span>i-1234567890abcdef0<span class="w"> </span>i-abcdef1234567890
</pre></div>
</div>
</section>
</section>
<section id="singularity">
<h2><a class="toc-backref" href="#id27" role="doc-backlink">Singularity</a><a class="headerlink" href="#singularity" title="Link to this heading">#</a></h2>
<p>To learn how to set up Singularity in an HPC environment using SLURM for
distributed training, refer to
<a class="reference external" href="https://qywu.github.io/2020/12/09/aws-slumr-pytorch.html">this guide</a>.</p>
</section>
<section id="references">
<h2><a class="toc-backref" href="#id28" role="doc-backlink">References</a><a class="headerlink" href="#references" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://www.hpcworkshops.com/">HPC Workshops</a></p></li>
<li><p><a class="reference external" href="https://qywu.github.io/2020/12/09/aws-slumr-pytorch.html">AWS SLURM PyTorch</a></p></li>
<li><p><a class="reference external" href="https://aws-parallelcluster.readthedocs.io/en/latest/configuration.html">AWS ParallelCluster Documentation</a></p></li>
<li><p><a class="reference external" href="https://github.com/pytorch/examples/blob/main/distributed/minGPT-ddp/mingpt/slurm/config.yaml.template">PyTorch Examples - minGPT DDP Config Template</a></p></li>
<li><p><a class="reference external" href="https://github.com/PrincetonUniversity/multi_gpu_training/tree/main">Princeton University Multi GPU Training</a></p></li>
<li><p><a class="reference external" href="https://github.com/pytorch/examples/blob/main/distributed/minGPT-ddp/mingpt/slurm/setup_pcluster_slurm.md">PyTorch Examples - minGPT DDP SLURM Setup</a></p></li>
<li><p><a class="reference external" href="https://aws.amazon.com/blogs/opensource/aws-parallelcluster/">AWS Blog - AWS ParallelCluster</a></p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./operations/distributed"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="02_basics.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Basics Of Distributed Data Parallelism</p>
      </div>
    </a>
    <a class="right-next"
       href="04_ablation.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Ablations</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-up-identity-and-access-management-iam-role">Setting Up Identity and Access Management (IAM) Role</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#configure-aws-cli">Configure AWS CLI</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-ec2-key-pair">Create EC2 Key Pair</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#configure-aws-parallelcluster">Configure AWS ParallelCluster</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#review-the-configuration-file">1. Review the Configuration File</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#create-the-cluster">2. Create the Cluster</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#monitor-the-cluster-creation">3. Monitor the Cluster Creation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#shared-file-system">Shared File System</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#logging-into-the-head-node">Logging into the Head Node</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#compute-node">Compute Node</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#slurm-status">SLURM Status</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setup-python-environment">Setup Python Environment</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#virtual-environment">Virtual Environment</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#miniconda">Miniconda</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sample-run">Sample Run</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#delete-cluster">Delete Cluster</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#delete-parallelcluster">Delete ParallelCluster</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#delete-network-resources">Delete Network Resources</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#consolidated-script">Consolidated Script</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#troubleshooting">Troubleshooting</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#failurecode-is-headnodebootstrapfailure-with-failurereason-cluster-creation-timed-out">failureCode is HeadNodeBootstrapFailure with failureReason Cluster creation timed out</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#some-useful-commands">Some Useful Commands</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#slurm-commands">Slurm Commands</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#how-many-gpus">How Many GPUs?</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#find-the-instance-id">Find the Instance ID</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#stop-ec2-instances">Stop EC2 Instances</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#singularity">Singularity</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Gao Hongnan
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>